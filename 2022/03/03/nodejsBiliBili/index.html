

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <meta name="referrer" content="no-referrer" />
  <link rel="apple-touch-icon" sizes="76x76" href="/img/insert1.jfif">
  <link rel="icon" href="/img/insert2.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="description" content="node + express + koa + mysql + mongodb + 打包部署">
  <meta name="author" content="Mike Taylor">
  <meta name="keywords" content="我的博客">
  <meta name="description" content="node + express + koa + mysql + mongodb + 打包部署">
<meta property="og:type" content="article">
<meta property="og:title" content="Nodejs应用开发">
<meta property="og:url" content="https://github.com/zhangjialin996/zhangjialin996.github.io/2022/03/03/nodejsBiliBili/index.html">
<meta property="og:site_name" content="Mike Taylor">
<meta property="og:description" content="node + express + koa + mysql + mongodb + 打包部署">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://gitee.com/zhangjialin_zhulan/myimagerepo/raw/master/images/image-20220308224453666.png">
<meta property="og:image" content="https://gitee.com/zhangjialin_zhulan/myimagerepo/raw/master/images/image-20220308224552678.png">
<meta property="og:image" content="https://gitee.com/zhangjialin_zhulan/myimagerepo/raw/master/images/image-20220308235836033.png">
<meta property="og:image" content="https://gitee.com/zhangjialin_zhulan/myimagerepo/raw/master/images/image-20220309101058980.png">
<meta property="og:image" content="https://img-blog.csdnimg.cn/20190503145158255.jpg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2R1YW5zYW12ZQ==,size_16,color_FFFFFF,t_70">
<meta property="og:image" content="https://img-blog.csdnimg.cn/20190503170609761.png">
<meta property="og:image" content="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==">
<meta property="og:image" content="https://gitee.com/zhangjialin_zhulan/myimagerepo/raw/master/images/CVPB4%7DIPSN%604%7D%7DV3%FO%%605A.png">
<meta property="og:image" content="https://gitee.com/zhangjialin_zhulan/myimagerepo/raw/master/images/UI$(%60V0BITI%([L0M1)G$A3.png">
<meta property="og:image" content="https://gitee.com/zhangjialin_zhulan/myimagerepo/raw/master/images/$_T%7D_MB%6095ZMWLGHQV%3GSW.png">
<meta property="og:image" content="https://gitee.com/zhangjialin_zhulan/myimagerepo/raw/master/images/~L05T3_XDGGF7P$L%7BSZZH2K.png">
<meta property="og:image" content="https://gitee.com/zhangjialin_zhulan/myimagerepo/raw/master/images/image-20220310112202272.png">
<meta property="og:image" content="https://gitee.com/zhangjialin_zhulan/myimagerepo/raw/master/images/image-20220310105555979.png">
<meta property="og:image" content="https://gitee.com/zhangjialin_zhulan/myimagerepo/raw/master/images/image-20220310145219283.png">
<meta property="og:image" content="https://gitee.com/zhangjialin_zhulan/myimagerepo/raw/master/images/ZI3O]S6%%7D[]Y7L@[HMH%MFT.png">
<meta property="og:image" content="https://gitee.com/zhangjialin_zhulan/myimagerepo/raw/master/images/image-20220310151057865.png">
<meta property="og:image" content="https://gitee.com/zhangjialin_zhulan/myimagerepo/raw/master/images/image-20220310231016437.png">
<meta property="og:image" content="https://gitee.com/zhangjialin_zhulan/myimagerepo/raw/master/images/image-20220310233133400.png">
<meta property="og:image" content="https://gitee.com/zhangjialin_zhulan/myimagerepo/raw/master/images/image-20220310233217443.png">
<meta property="og:image" content="https://gitee.com/zhangjialin_zhulan/myimagerepo/raw/master/images/image-20220311091047610.png">
<meta property="og:image" content="https://gitee.com/zhangjialin_zhulan/myimagerepo/raw/master/images/image-20220311094456188.png">
<meta property="og:image" content="https://gitee.com/zhangjialin_zhulan/myimagerepo/raw/master/images/image-20220311093053923.png">
<meta property="og:image" content="https://gitee.com/zhangjialin_zhulan/myimagerepo/raw/master/images/image-20220311100022084.png">
<meta property="og:image" content="https://gitee.com/zhangjialin_zhulan/myimagerepo/raw/master/images/image-20220311134709043.png">
<meta property="og:image" content="https://gitee.com/zhangjialin_zhulan/myimagerepo/raw/master/images/image-20220311215910641.png">
<meta property="og:image" content="https://gitee.com/zhangjialin_zhulan/myimagerepo/raw/master/images/image-20220311233751710.png">
<meta property="og:image" content="https://gitee.com/zhangjialin_zhulan/myimagerepo/raw/master/images/image-20220311233817824.png">
<meta property="og:image" content="https://gitee.com/zhangjialin_zhulan/myimagerepo/raw/master/images/image-20220313230207687.png">
<meta property="og:image" content="https://gitee.com/zhangjialin_zhulan/myimagerepo/raw/master/images/image-20220320180338632.png">
<meta property="og:image" content="https://gitee.com/zhangjialin_zhulan/myimagerepo/raw/master/images/image-20220320180556154.png">
<meta property="og:image" content="https://gitee.com/zhangjialin_zhulan/myimagerepo/raw/master/images/image-20220320182045720.png">
<meta property="article:published_time" content="2022-03-03T14:17:33.000Z">
<meta property="article:modified_time" content="2023-03-14T02:31:28.120Z">
<meta property="article:author" content="Mike Taylor">
<meta property="article:tag" content="NodeJs">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://gitee.com/zhangjialin_zhulan/myimagerepo/raw/master/images/image-20220308224453666.png">
  
  <title>Nodejs应用开发 - Mike Taylor</title>

  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css@4/github-markdown.min.css" />
  <link  rel="stylesheet" href="/lib/hint/hint.min.css" />

  
    
    
      
      <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@10/styles/github-gist.min.css" />
    
  

  
    <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3/dist/jquery.fancybox.min.css" />
  



<!-- 主题依赖的图标库，不要自行修改 -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_kmeydafke9r.css">


<link  rel="stylesheet" href="/css/main.css" />

<!-- 自定义样式保持在最底部 -->


  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    var CONFIG = {"hostname":"github.com","root":"/","version":"1.8.11","typing":{"enable":true,"typeSpeed":30,"cursorChar":"|","loop":false},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"right","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"copy_btn":true,"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":true,"baidu":"e71cddb60357a788e6ed79bca37db76d","google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname"}},"search_path":"/local-search.xml"};
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>

    <!--自定义看板娘-->
    <script src="https://cdn.jsdelivr.net/npm/jquery/dist/jquery.min.js"></script>
    <script src="/live2d-widget/autoload.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome/css/font-awesome.min.css"/>
</head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>Mike Taylor&#39;s</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                首页
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                归档
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                分类
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                标签
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                关于
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/links/">
                <i class="iconfont icon-link-fill"></i>
                友链
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              &nbsp;<i class="iconfont icon-search"></i>&nbsp;
            </a>
          </li>
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="banner" id="banner" parallax=true
         style="background: url('/img/p12.png') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="page-header text-center fade-in-up">
            <span class="h2" id="subtitle" title="Nodejs应用开发">
              
            </span>

            
              <div class="mt-3">
  
  
    <span class="post-meta">
      <i class="iconfont icon-date-fill" aria-hidden="true"></i>
      <time datetime="2022-03-03 22:17" pubdate>
        2022年3月3日 晚上
      </time>
    </span>
  
</div>

<div class="mt-1">
  
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      80k 字
    </span>
  

  
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      400 分钟
    </span>
  

  
  
    
      <!-- 不蒜子统计文章PV -->
      <span id="busuanzi_container_page_pv" style="display: none">
        <i class="iconfont icon-eye" aria-hidden="true"></i>
        <span id="busuanzi_value_page_pv"></span> 次
      </span>
    
  
</div>

            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div class="py-5" id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">Nodejs应用开发</h1>
            
            <div class="markdown-body">
              <h1 id="Nodejs应用开发"><a href="#Nodejs应用开发" class="headerlink" title="Nodejs应用开发"></a>Nodejs应用开发</h1><p>小声BB：学到最后其实就是玩c++了，简直折磨</p>
<p>课程地址：<a href="http://sd.ccit.js.cn/info/1301/4628.htm">http://sd.ccit.js.cn/info/1301/4628.htm</a></p>
<p>[TOC]</p>
<h2 id="第一章-Node-js认知"><a href="#第一章-Node-js认知" class="headerlink" title="第一章 Node.js认知"></a>第一章 Node.js认知</h2><h3 id="1-1-Nodejs简介"><a href="#1-1-Nodejs简介" class="headerlink" title="1.1 Nodejs简介"></a>1.1 Nodejs简介</h3><p>引入：JavaScript作为脚本语言，从最初的表单验证，到为网页添加各式各样的动态功能，提供更流畅美观的浏览效果，nodejs则将javascript引入到后端。</p>
<p>Nodejs：</p>
<ul>
<li><p>让JavaScript运行在服务器端的平台，是JavaScript语言的服务器运行环境。</p>
</li>
<li><p>采用Google公司得V8引擎作为JavaScript语言解释器，通过自行开发得libuv库来进行操作系统资源调用。</p>
</li>
<li><p>V8引擎执行JavaScript速度非常块（底层使用C++作为内建模块），性能非常好。</p>
</li>
<li><p>对一些特殊用例进行了优化，提供了替代的API，使得V8引擎在非浏览器环境下运行得更好。</p>
</li>
<li><p>实时Web应用开发平台</p>
<ul>
<li>用于方便的搭建响应速度快，易于扩展的网络应用。</li>
</ul>
</li>
<li><p>架构可扩展性</p>
<ul>
<li>实时响应，超大规模数据要求。</li>
</ul>
</li>
<li><p>程序设计模式</p>
<ul>
<li>摈弃了传统平台依靠多线程来实现高并发的设计思路</li>
<li>单线程、非阻塞I/O、事件驱动机制</li>
</ul>
</li>
</ul>
<p><img src="https://gitee.com/zhangjialin_zhulan/myimagerepo/raw/master/images/image-20220308224453666.png" srcset="/img/loading.gif" lazyload alt="image-20220308224453666"></p>
<p><img src="https://gitee.com/zhangjialin_zhulan/myimagerepo/raw/master/images/image-20220308224552678.png" srcset="/img/loading.gif" lazyload alt="image-20220308224552678"></p>
<p>Node.js特点及应用场景：</p>
<ul>
<li><p>采用异步I/ O与事件驱动架构设计</p>
<ul>
<li>单线程模型（决定了单进程），在执行过程中只启动一个线程来运行代码</li>
<li>CPU和内存在同一时间集中处理一件事，同时尽可能让耗时的I/O操作并行执行</li>
</ul>
</li>
<li><p>强大而灵活的包管理器</p>
<ul>
<li>有上万个第三方模块<ul>
<li>网站开发框架</li>
<li>数据库接口</li>
<li>模板语言解析</li>
<li>CSS生成工具</li>
<li>图形用户界面</li>
<li>操作系统API工具</li>
</ul>
</li>
</ul>
</li>
<li><p>内置Http服务器</p>
<ul>
<li>作为服务器向用户提供服务，它跳过了Http服务器，直接面向前端开发</li>
</ul>
</li>
<li><p>具有强大的标准类库</p>
<ul>
<li>二进制类库、核心模块</li>
<li>二进制类库包括libuv，为网络以及文件系统提供快速的时间轮询以及非阻塞I/O</li>
<li>Http类库，快速构建Http客户端和服务器</li>
</ul>
</li>
<li><p>场景：</p>
<ul>
<li>Web服务API</li>
<li>实时多人游戏</li>
<li>后端Web服务</li>
<li>多客户端通信</li>
<li>基于Web的应用</li>
</ul>
</li>
</ul>
<p>Node.js与JavaScript的区别：</p>
<ul>
<li>JavaScript是一种前端语言，由浏览器解析执行，受制于浏览器提供的接口。浏览器为了安全考虑，对文件操作、网络操作、操作系统交互等功能有严格的限制，所以浏览器端的JavaScript功能受限。</li>
<li>Node.js：<strong>事实上既是一个运行环境，同时也是一个库</strong>。Node.js完全没有浏览器端的限制，让JavaScript拥有了文件操作、网络操作、进程操作等功能，允许脱离浏览器环境运行JavaScript代码。</li>
</ul>
<p>总结：</p>
<ul>
<li>什么是Node.js?</li>
<li>Node.js发展历史</li>
<li>Node.js特点及其应用场景</li>
<li>Node.js与JavaScript的区别</li>
</ul>
<h3 id="1-2-Node-js安装（略）"><a href="#1-2-Node-js安装（略）" class="headerlink" title="1.2 Node.js安装（略）"></a>1.2 Node.js安装（略）</h3><h3 id="1-3-运行Node-js程序"><a href="#1-3-运行Node-js程序" class="headerlink" title="1.3 运行Node.js程序"></a>1.3 运行Node.js程序</h3><ul>
<li><p>DOS命令窗口</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">node index.js<br></code></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">nodemon index.js<br></code></pre></td></tr></table></figure>

<p>nodemon相比，对项目进行热更新，他能自动检测目录中的文件更改，通过重启应用来调试Node.js程序，但是需要事先安装。</p>
</li>
<li><p>Git Bash</p>
<p>命令同DOS下，但是Git必须事先安装，Git Bash是一个适用于Windows环境的模拟Unix命令行的终端。</p>
</li>
</ul>
<h3 id="实训1-console控制台使用"><a href="#实训1-console控制台使用" class="headerlink" title="实训1 console控制台使用"></a>实训1 console控制台使用</h3><p>console对象提供了一个简单的调试控制台，使用其一系列方法可以将调试模式的信息输出到控制台。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Document<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><br><span class="javascript">    <span class="hljs-comment">/* 1.输出信息 */</span></span><br><span class="javascript">    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&quot;node学习&quot;</span>);</span><br><span class="javascript">    <span class="hljs-built_in">console</span>.info(<span class="hljs-string">&quot;node学习&quot;</span>); <span class="hljs-comment">// 输出提示信息</span></span><br><span class="javascript">    <span class="hljs-built_in">console</span>.error(<span class="hljs-string">&quot;node学习&quot;</span>); <span class="hljs-comment">// 输出错误信息</span></span><br><span class="javascript">    <span class="hljs-built_in">console</span>.warn(<span class="hljs-string">&quot;node学习&quot;</span>); <span class="hljs-comment">// 输出警告信息</span></span><br><br><span class="javascript">    <span class="hljs-comment">/* 2.输出对象的层次结构,打印出该对象的所有属性和属性值*/</span></span><br><span class="javascript">    <span class="hljs-keyword">let</span> bBody = <span class="hljs-built_in">document</span>.body;</span><br><span class="javascript">    <span class="hljs-built_in">console</span>.dir(bBody);</span><br><span class="javascript">    <span class="hljs-comment">/* 3.输出数据表格化 */</span></span><br><span class="javascript">    <span class="hljs-keyword">let</span> student = &#123;</span><br><span class="javascript">        name: <span class="hljs-string">&#x27;zjl&#x27;</span>,</span><br>        age: 20,<br>        gender: 20<br>    &#125;<br><span class="javascript">    <span class="hljs-built_in">console</span>.table(student);</span><br><br><span class="javascript">    <span class="hljs-comment">/* 4.统计代码被执行时间 */</span></span><br><span class="javascript">    <span class="hljs-built_in">console</span>.time(<span class="hljs-string">&quot;forTime&quot;</span>);</span><br><span class="javascript">    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> index = <span class="hljs-number">0</span>, count = <span class="hljs-number">0</span>; index &lt; <span class="hljs-number">10000</span>; index++) &#123;</span><br>        count++;<br>    &#125;<br><span class="javascript">    <span class="hljs-built_in">console</span>.timeEnd(<span class="hljs-string">&quot;forTime&quot;</span>);</span><br><br><span class="javascript">    <span class="hljs-comment">/* 5.分组输出信息 */</span></span><br><span class="javascript">    <span class="hljs-built_in">console</span>.group(<span class="hljs-string">&quot;node&quot;</span>);</span><br><span class="javascript">    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&quot;day1&quot;</span>);</span><br><span class="javascript">    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&quot;day2&quot;</span>);</span><br><span class="javascript">    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&quot;day3&quot;</span>);</span><br><span class="javascript">    <span class="hljs-built_in">console</span>.groupEnd(<span class="hljs-string">&quot;node&quot;</span>);</span><br><br><span class="javascript">    <span class="hljs-comment">/* 6.统计代码被执行次数 */</span></span><br><span class="javascript">    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Fn</span>(<span class="hljs-params"></span>) </span>&#123;</span><br><span class="javascript">        <span class="hljs-built_in">console</span>.count(<span class="hljs-string">&quot;当前函数被执行次数&quot;</span>);</span><br>    &#125;<br>    Fn();<br>    Fn();<br>    Fn();<br>    Fn();<br><br><span class="javascript">    <span class="hljs-comment">/* 7.当表达式为false，输出信息 */</span></span><br><span class="javascript">    <span class="hljs-keyword">let</span> flag = <span class="hljs-literal">false</span>;</span><br><span class="javascript">    <span class="hljs-built_in">console</span>.assert(flag, <span class="hljs-string">&quot;当flag表达式为false时才输出&quot;</span>);</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure>

<p><img src="https://gitee.com/zhangjialin_zhulan/myimagerepo/raw/master/images/image-20220308235836033.png" srcset="/img/loading.gif" lazyload alt="image-20220308235836033"></p>
<h2 id="第二章-模块机制"><a href="#第二章-模块机制" class="headerlink" title="第二章 模块机制"></a>第二章 模块机制</h2><h3 id="2-1-模块化开发"><a href="#2-1-模块化开发" class="headerlink" title="2.1 模块化开发"></a>2.1 模块化开发</h3><h4 id="模块的定义"><a href="#模块的定义" class="headerlink" title="模块的定义"></a>模块的定义</h4><p>什么是模块？</p>
<ul>
<li>模块通常是指编程语言所提供的代码组织机制，利用此机制可将程序拆解为独立且通用的代码单元。</li>
</ul>
<p>什么是模块化？</p>
<ul>
<li>模块化是一种设计思想，利用模块化可以把一个非常复杂的系统结构细化到具体的功能点，每个功能点看做一个模块，然后通过某种规则把这些小的模块组合到一起，构成模块化系统。</li>
</ul>
<h4 id="模块化的优点"><a href="#模块化的优点" class="headerlink" title="模块化的优点"></a>模块化的优点</h4><ul>
<li>生产效率高<ul>
<li>灵活架构，焦点分离</li>
<li>多人协作、互不干扰</li>
<li>方便模块间组合、分解（代码复用）</li>
</ul>
</li>
<li>维护成本低<ul>
<li>可分单元测试</li>
<li>方便单个模块功能调试、升级</li>
</ul>
</li>
</ul>
<h4 id="模块化规范"><a href="#模块化规范" class="headerlink" title="模块化规范"></a>模块化规范</h4><p>JavaScript三种模块规范：</p>
<ul>
<li><p>AMD</p>
<ul>
<li><p>异步模块定义，使用异步方式加载模块。</p>
</li>
<li><p>实操</p>
<p>callModule.html</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">&quot;X-UA-Compatible&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;IE=edge&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;viewport&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>AMD<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;./require.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><br><span class="javascript">    <span class="hljs-built_in">require</span>([<span class="hljs-string">&#x27;./module.js&#x27;</span>], <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">obj</span>) </span>&#123;</span><br>        alert(obj.multiply(99, 99));<br>    &#125;)<br><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure>

<p>module.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs js">define(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;<br>	<span class="hljs-keyword">let</span> multiply = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">x, y</span>) </span>&#123;<br>		<span class="hljs-keyword">return</span> x * y;<br>	&#125;;<br>	<span class="hljs-keyword">return</span> &#123;<br>		multiply,<br>	&#125;;<br>&#125;);<br></code></pre></td></tr></table></figure>

<p>注：<code>require.js</code>一个第三方库，实现了AMD规范。</p>
</li>
</ul>
</li>
<li><p>CMD</p>
<ul>
<li><p>通用模块定义，与AMD类似，但是在模块定义方式和加载时机上有所不同。</p>
</li>
<li><p>实操</p>
<p><img src="https://gitee.com/zhangjialin_zhulan/myimagerepo/raw/master/images/image-20220309101058980.png" srcset="/img/loading.gif" lazyload alt="image-20220309101058653"></p>
<p><code>index.html</code></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Document<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;./sea.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><br><span class="javascript">        seajs.use(<span class="hljs-string">&#x27;./main&#x27;</span>);</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure>

<p><code>main.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs js">define(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"><span class="hljs-built_in">require</span></span>) </span>&#123;<br>	<span class="hljs-keyword">var</span> m1 = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;./module1&quot;</span>);<br>	<span class="hljs-keyword">var</span> m4 = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;./module4&quot;</span>);<br>	m1.show();<br>	m4.show();<br>&#125;);<br></code></pre></td></tr></table></figure>

<p><code>module1.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs js">define(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"><span class="hljs-built_in">require</span>, <span class="hljs-built_in">exports</span>, <span class="hljs-built_in">module</span></span>) </span>&#123;<br>	<span class="hljs-comment">//内部变量数据</span><br>	<span class="hljs-keyword">var</span> data = <span class="hljs-string">&quot;sea.js采用的是CMD规范。&quot;</span>;<br>	<span class="hljs-comment">//内部函数</span><br>	<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">show</span>(<span class="hljs-params"></span>) </span>&#123;<br>		<span class="hljs-built_in">console</span>.log(<span class="hljs-string">&quot;模块1：&quot;</span> + data);<br>	&#125;<br><br>	<span class="hljs-comment">//向外暴露</span><br>	<span class="hljs-built_in">exports</span>.show = show;<br>&#125;);<br><br></code></pre></td></tr></table></figure>

<p><code>module2.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">/* </span><br><span class="hljs-comment">    module.exports对象为模块出口，可以把模块中希望输出的方法和变量放入该对象中。</span><br><span class="hljs-comment">    效果与exports. 类似，向外暴露内容，但是二者有一定区别</span><br><span class="hljs-comment">*/</span><br>define(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">reuqire, <span class="hljs-built_in">exports</span>, <span class="hljs-built_in">module</span></span>) </span>&#123;<br>	<span class="hljs-built_in">module</span>.exports = &#123;<br>		msg: <span class="hljs-string">&quot;张加林&quot;</span>,<br>	&#125;;<br>&#125;);<br></code></pre></td></tr></table></figure>

<p><code>module3.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs js">define(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"><span class="hljs-built_in">require</span>, <span class="hljs-built_in">exports</span>, <span class="hljs-built_in">module</span></span>) </span>&#123;<br>	<span class="hljs-keyword">const</span> API_KEY = <span class="hljs-string">&quot;zhangjialin996&quot;</span>;<br>	<span class="hljs-built_in">exports</span>.API_KEY = API_KEY;<br>&#125;);<br><br></code></pre></td></tr></table></figure>

<p><code>moudle4.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">/* </span><br><span class="hljs-comment">    使用同步方式引入module2</span><br><span class="hljs-comment">    使用异步方式引入module3</span><br><span class="hljs-comment">*/</span><br>define(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"><span class="hljs-built_in">require</span>, <span class="hljs-built_in">exports</span>, <span class="hljs-built_in">module</span></span>) </span>&#123;<br>	<span class="hljs-keyword">var</span> module2 = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;./module2&quot;</span>);<br>	<span class="hljs-comment">//引入依赖模块(同步)</span><br>	<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">show</span>(<span class="hljs-params"></span>) </span>&#123;<br>		<span class="hljs-built_in">console</span>.log(<span class="hljs-string">&quot;调用模块4：&quot;</span> + module2.msg);<br>	&#125;<br>	<span class="hljs-built_in">exports</span>.show = show;<br>	<span class="hljs-comment">//引入依赖模块(异步)，最后执行，因为是异步的，主线的先执行完才会执行这</span><br>	<span class="hljs-built_in">require</span>.async(<span class="hljs-string">&quot;./module3&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">m3</span>) </span>&#123;<br>		<span class="hljs-built_in">console</span>.log(<span class="hljs-string">&quot;异步引入依赖模块3：&quot;</span> + m3.API_KEY);<br>	&#125;);<br>&#125;);<br></code></pre></td></tr></table></figure>

<p>注：CMD模块化规范需要<code>sea.js</code>文件的支持，所以必须下载它并引入，也可以利用CDN引入。</p>
</li>
</ul>
</li>
<li><p>CommonJS</p>
<ul>
<li>主要用于规范服务端的编程，Node.js就是参照该规范实现。</li>
</ul>
</li>
</ul>
<h3 id="2-2-Node-js模块化基础"><a href="#2-2-Node-js模块化基础" class="headerlink" title="2.2 Node.js模块化基础"></a>2.2 Node.js模块化基础</h3><p>Node.js模块分类：</p>
<ul>
<li><p>核心模块</p>
<ul>
<li><p>由Node.js官方提供，有最高的加载优先级（http、net、fs）</p>
</li>
<li><p>又可以细分为JavaScript核心模块和内建模块（C/C++核心模块）</p>
</li>
<li><p>不需要开发者创建，可以直接通过require加载</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 创建服务器</span><br><span class="hljs-keyword">var</span> http = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;http&#x27;</span>);<br><span class="hljs-comment">// 创建数据库驱动</span><br><span class="hljs-keyword">var</span> mysql = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;mysql&#x27;</span>);<br><span class="hljs-comment">// DNS查询</span><br><span class="hljs-keyword">var</span> dns = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;dns&#x27;</span>);<br><span class="hljs-comment">// 文件操作</span><br><span class="hljs-keyword">var</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;fs&#x27;</span>)<br><span class="hljs-comment">// url处理</span><br><span class="hljs-keyword">var</span> url = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;url&#x27;</span>)<br></code></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>自定义模块</p>
<ul>
<li><p>存储为单独的文件 / 文件夹</p>
</li>
<li><p>Node.js所有模块都是以模块形式存在的</p>
</li>
<li><p>模块之间相互独立，如果需要在一个模块中使用另一个模块就需要引入模块，同时另一个模块需要将数据暴露出来。</p>
</li>
<li><p>自定义模块的两大对象：require和exports</p>
<ul>
<li><p>module.exports = 暴露对象</p>
</li>
<li><p>exports.暴露对象</p>
</li>
<li><p>实操</p>
<p>sort.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">sortArray</span>(<span class="hljs-params">arr</span>) </span>&#123;<br>  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> j = <span class="hljs-number">0</span>; j &lt; arr.length - <span class="hljs-number">1</span>; j++) &#123;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; arr.length - <span class="hljs-number">1</span> - j; i++) &#123;<br>        <span class="hljs-keyword">if</span> (arr[i] &gt; arr[i + <span class="hljs-number">1</span>]) &#123;<br>           <span class="hljs-keyword">let</span> temp = arr[i];<br>           arr[i] = arr[i + <span class="hljs-number">1</span>];<br>           arr[i + <span class="hljs-number">1</span>] = temp;&#125;<br>    &#125;<br>  &#125;<br>  <span class="hljs-keyword">return</span> arr;<br>&#125;<br><span class="hljs-built_in">module</span>.exports = &#123;<br>   sortArray<br>&#125;<br></code></pre></td></tr></table></figure>

<p>index.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">let</span> s = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;./s’);</span><br><span class="hljs-string">let rs = s.sortArray([1, 44, 2, -45, 100, 3]);</span><br><span class="hljs-string">console.log(rs);</span><br></code></pre></td></tr></table></figure>


</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="2-3-包与NPM"><a href="#2-3-包与NPM" class="headerlink" title="2.3 包与NPM"></a>2.3 包与NPM</h3><h4 id="包"><a href="#包" class="headerlink" title="包"></a>包</h4><p>Node.js中的包：包含js文件和其他附加信息的整体，某种意义上来说，包是<strong>模块的集合</strong>。</p>
<p>模块按照CommonJS规范书写</p>
<p>遵循CommonJS包规的包目录应该包含对应的文件，范包的结构：</p>
<ul>
<li>package.json：在顶层目录的包描述文件，说明文件<ul>
<li>name：包的名称</li>
<li>description：包的简介</li>
<li>version：包的版本</li>
<li>keywords：关键词数组，用于在NPM中分类搜索</li>
<li>author：包的作者</li>
<li>main：配置包的入口，默认是模块跟目录下的index.js</li>
<li>dependencies：包的依赖项，NPM会根据该属性自动加载依赖包。</li>
<li>scripts：指定了运行脚本命令的NPM命令行缩写，例如：start</li>
</ul>
</li>
<li>bin：存放可执行二进制文件的目录</li>
<li>lib：存放JavaScript文件的目录</li>
<li>doc：存放文档的目录</li>
<li>test：存放文档的目录</li>
</ul>
<h4 id="NPM"><a href="#NPM" class="headerlink" title="NPM"></a>NPM</h4><p>NPM是包管理工具</p>
<ul>
<li>Node.js组织了自身的核心模块，这部分不需要我们管理。</li>
<li>在使用第三方文件模块时，模块之间彼此独立，并不能直接相互引用。</li>
<li>通过NPM实现对包的管理，解决包之间的依赖关系，从而形成模块之间的“纽带”。</li>
</ul>
<p>常见NPM命令</p>
<table>
<thead>
<tr>
<th>命令</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>npm init [-y]</td>
<td>初始化一个package.json文件</td>
</tr>
<tr>
<td>npm install 包名</td>
<td>安装一个包</td>
</tr>
<tr>
<td>npm install -save 包名</td>
<td>将安装的包添加到package.json的依赖中</td>
</tr>
<tr>
<td>npm install -g 包名</td>
<td>安装一个命令行工具</td>
</tr>
<tr>
<td>npm docs 包名</td>
<td>查看包的文档！！！</td>
</tr>
<tr>
<td>npm root -g</td>
<td>查看全局包安装的路径</td>
</tr>
<tr>
<td>npm config set prefix “路径”</td>
<td>修改全局包安装路径</td>
</tr>
<tr>
<td>npm list</td>
<td>查看当前目录下安装的所有包</td>
</tr>
<tr>
<td>npm list -g</td>
<td>查看全局包的安装路径下的所有包</td>
</tr>
<tr>
<td>npm uninstall</td>
<td>卸载当前目录下的某个包</td>
</tr>
<tr>
<td>npm uninstall -g</td>
<td>卸载全局安装的某个包</td>
</tr>
<tr>
<td>npm update 包名</td>
<td>更新当前目录下的某个包</td>
</tr>
</tbody></table>
<h4 id="自定义包"><a href="#自定义包" class="headerlink" title="自定义包"></a>自定义包</h4><p>实现自定义包，关键为项目下的<code>package.json</code>文件</p>
<p>步骤：</p>
<ul>
<li>NPM生成<code>package.json</code>文件<ul>
<li>手动编写package.json文件</li>
<li>使用npm init指令，通过提问式交互让用户逐个填入选项</li>
<li>使用npm init -y采用默认的配置，跳过上面的步骤</li>
</ul>
</li>
<li>创建package.json文件后，使用<code>npm install</code>命令，针对目录信息自动安装所需模块</li>
<li>主模块使用node命令运行，启动项目<ul>
<li>关于主模块，以<code>package.json</code>中的<code>main</code>声明为准</li>
</ul>
</li>
</ul>
<h4 id="NPM脚本"><a href="#NPM脚本" class="headerlink" title="NPM脚本"></a>NPM脚本</h4><p>学习：<a href="https://www.ruanyifeng.com/blog/2016/10/npm_scripts.html">npm scripts 使用指南 - 阮一峰的网络日志 (ruanyifeng.com)</a></p>
<p>npm 允许在<code>package.json</code>文件里面，使用<code>scripts</code>字段定义脚本命令。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs js">&#123;<br>  <span class="hljs-comment">// ...</span><br>  <span class="hljs-string">&quot;scripts&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;build&quot;</span>: <span class="hljs-string">&quot;node build.js&quot;</span><br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>上面代码是<code>package.json</code>文件的一个片段，里面的<code>scripts</code>字段是一个对象。它的每一个属性，对应一段脚本。比如，<code>build</code>命令对应的脚本是<code>node build.js</code>。</p>
<p>命令行下使用<code>npm run</code>命令，就可以执行这段脚本：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> npm run build</span><br><span class="hljs-meta">#</span><span class="bash"> 等同于执行</span><br><span class="hljs-meta">$</span><span class="bash"> node build.js</span><br></code></pre></td></tr></table></figure>

<p>这些定义在<code>package.json</code>里面的脚本，就称为 npm 脚本。它的优点很多：</p>
<ul>
<li>项目的相关脚本，可以集中在一个地方。</li>
<li>不同项目的脚本命令，只要功能相同，就可以有同样的对外接口。用户不需要知道怎么测试你的项目，只要运行<code>npm run test</code>即可。</li>
<li>可以利用 npm 提供的很多辅助功能。</li>
</ul>
<p><strong>查看当前项目的所有 npm 脚本命令，可以使用不带任何参数的<code>npm run</code>命令。</strong></p>
<p>每当执行<code>npm run</code>，就会自动新建一个 Shell，在这个 Shell 里面执行指定的脚本命令。只要是 Shell（一般是 Bash）可以运行的命令，就可以写在 npm 脚本里面。</p>
<p>由于 npm 脚本的唯一要求就是可以在 Shell 执行，因此它不一定是 Node 脚本，任何可执行文件都可以写在里面。</p>
<h3 id="2-4-CNPM与YARM安装和使用"><a href="#2-4-CNPM与YARM安装和使用" class="headerlink" title="2.4 CNPM与YARM安装和使用"></a>2.4 CNPM与YARM安装和使用</h3><p>引入：国外服务器访问较慢，使用镜像服务器可以加快访问速度。</p>
<h4 id="包管理机制"><a href="#包管理机制" class="headerlink" title="包管理机制"></a>包管理机制</h4><ul>
<li><p>NPM：Node.js自带包管理工具。</p>
<ul>
<li>缺点：服务器在国外，下载速度较慢。</li>
<li>优点：可以快速使用，内容全面。</li>
</ul>
</li>
<li><p>CNPM</p>
<ul>
<li><p>优点：用法与NPM一致，且速度较快，由淘宝团队搭建npm的镜像。</p>
</li>
<li><p>缺点：同步频率10min一次，存在微小的误差（可忽略）</p>
</li>
<li><p>使用：</p>
<ul>
<li><p>安装CNPM</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">npm install -g cnpm --registry=https://registry.npm.taobao.org<br></code></pre></td></tr></table></figure>
</li>
<li><p>命令查看版本号</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">cnpm -v<br></code></pre></td></tr></table></figure>
</li>
<li><p>使用cnpm命令安装模块</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">cnpm install &lt;package&gt;<br></code></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
</li>
<li><p>YARN</p>
<ul>
<li>优点：YARN与NPM相同，使用本地缓存，但是YARN无需互联网连接即可安装本地缓存，提供离线模式</li>
</ul>
</li>
</ul>
<table>
<thead>
<tr>
<th><strong>功能</strong></th>
<th><strong>NPM</strong></th>
<th>CNPM</th>
<th>YARN</th>
</tr>
</thead>
<tbody><tr>
<td>初始化某个项目</td>
<td>npm init</td>
<td>cnpm init</td>
<td>yarn init</td>
</tr>
<tr>
<td>默认安装依赖操作</td>
<td>npm install/link</td>
<td>cnpm install/link</td>
<td>yarn install/link</td>
</tr>
<tr>
<td>安装某个依赖并保存到package.json</td>
<td>npm install taco -s</td>
<td>cnpm install taco -s</td>
<td>yarn add taco</td>
</tr>
<tr>
<td>移除某个依赖项目</td>
<td>npm uninstall taco -s</td>
<td>cnpm uninstall taco -s</td>
<td>yarn remove taco</td>
</tr>
<tr>
<td>安装某个开发时依赖项目</td>
<td>npm install taco -save-dev</td>
<td>cnpm install taco -save-dev</td>
<td>yarn add taco -dev</td>
</tr>
<tr>
<td>更新某个依赖项目</td>
<td>npm update taco -s</td>
<td>cnpm update taco -s</td>
<td>yarn upgrade taco</td>
</tr>
<tr>
<td>安装某个全局依赖项目</td>
<td>npm install taco -g</td>
<td>cnpm install taco -g</td>
<td>yarn global add taco</td>
</tr>
<tr>
<td>发布登录登出，   一系列 NPM Registry 操作</td>
<td>npm  publish/login/logout</td>
<td>cnpm publish/login/logout</td>
<td>yarn ublish/login/logout</td>
</tr>
<tr>
<td><strong>运行某个命令</strong></td>
<td>npm run/test</td>
<td>cnpm run/test</td>
<td>yarn run/test</td>
</tr>
</tbody></table>
<h3 id="补充"><a href="#补充" class="headerlink" title="补充"></a>补充</h3><ul>
<li><p>独立性是模块化开发的重要特点，模块内部最好不与程序的其他部分直接交互。</p>
</li>
<li><p>require参数类型：</p>
<ul>
<li>http、fs、path等,原生模块</li>
<li>./mod或../mod,相对路径的文件模块</li>
<li>/pathtomodule/mod,绝对路径的文件模块</li>
<li>mod,非原生模块的文件模块</li>
</ul>
</li>
<li><p>module path</p>
<ul>
<li><p>对于每一个被加载的文件模块，创建这个模块对象的时候，这个模块便会有一个paths属性，其值根据当前文件的路径计算得到。</p>
</li>
<li><p>Node.js在编译js文件的过程中实际完成的步骤有对js文件内容进行头尾包装。</p>
<p>以app.js为例，我们将其放在任意一个文件夹中，包装之后的app.js将会变成以下形式:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs js">(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"><span class="hljs-built_in">exports</span>, <span class="hljs-built_in">require</span>, <span class="hljs-built_in">module</span>, __filename, __dirname</span>) </span>&#123;<br>    <span class="hljs-built_in">console</span>.log(<span class="hljs-built_in">module</span>.paths);<br>&#125;);<br></code></pre></td></tr></table></figure>

<p>执行node module app.js命令，将得到以下的输出结果：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs js">[ <span class="hljs-string">&#x27;/home/jackson/research/node_modules&#x27;</span>, <br><span class="hljs-string">&#x27;/home/jackson/node_modules&#x27;</span>, <br><span class="hljs-string">&#x27;/home/node_modules&#x27;</span>, <br><span class="hljs-string">&#x27;/node_modules&#x27;</span> ]<br></code></pre></td></tr></table></figure>

<p>可以看出module path的生成规则为：从当前文件目录开始查找node_modules目录；然后依次进入父目录，查找父目录下的node_modules目录；依次迭代，直到根目录下的node_modules目录。</p>
<p>除此之外还有一个全局module path，是当前node执行文件的相对目录（../../lib/node）。如果在环境变量中设置了HOME目录和NODE_PATH目录的话，整个路径还包含NODE_PATH和HOME目录下的.node_libraries与.node_modules。其最终值大致如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js">[NODE_PATH，HOME/.node_modules，HOME/.node_libraries，execPath/../../lib/node]<br></code></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>require方法中的文件查找策略(指内置模块和第三方模块)：</p>
<ul>
<li>1、从module path数组中取出第一个目录作为查找基准。</li>
<li>2、直接从目录中查找该文件，如果存在，则结束查找。如果不存在，则进行下一条查找。 </li>
<li>3、尝试添加.js、.json、.node后缀后查找，如果存在文件，则结束查找。如果不存在，则进行下一条。</li>
<li>4、尝试将require的参数作为一个包来进行查找，<strong>读取目录下的<code>package.json</code>文件，取得main参数指定的文件</strong>。 </li>
<li>5、尝试查找<code>package.json</code>文件，如果存在，则结束查找。如果不存在，则进行第3条查找。</li>
<li>6、如果继续失败，则取出module path数组中的下一个目录作为基准查找，循环第1至5个步骤。</li>
<li>7、如果继续失败，循环第1至6个步骤，直到module path中的最后一个值。 </li>
<li>8、如果仍然失败，则抛出异常。</li>
</ul>
</li>
<li><p>文件查找流程</p>
<p><img src="https://img-blog.csdnimg.cn/20190503145158255.jpg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2R1YW5zYW12ZQ==,size_16,color_FFFFFF,t_70" srcset="/img/loading.gif" lazyload alt="img"></p>
<ul>
<li><p>一、优先从文件模块缓存加载</p>
<p>尽管原生模块与文件模块的优先级不同，但是都会优先从文件模块的缓存中加载已经存在的模块。</p>
</li>
<li><p>二、原生模块</p>
<p>原生模块的优先级仅次于文件模块缓存的优先级。require 方法在解析文件名之后，优先检查模块是否在原生模块列表中。</p>
<p>在实际开发过程中，如果你的文件和核心库文件同名，加载过程中是会直接忽略你的项目文件。</p>
<p>例如在server下有config.json，require(“config”)。</p>
<p>require具体的加载过程是：</p>
<ul>
<li><p>核心库中如果有config.js 会直接加载 忽略你的文件。</p>
</li>
<li><p>如果没有会检查你的项目中是否有这个.js文件。</p>
</li>
<li><p>如果没有才会去查询 .json 文件。</p>
</li>
</ul>
<p>所以在开发过程中最好使用其相对路径指明具体文件。</p>
<p>当第三方的模块和内置模块同名时，内置模块将覆盖第三方同名模块。因此命名时需要注意不要和内置模块同名。</p>
<p>原生模块也有一个缓存区，同样也是优先从缓存区加载。如果缓存区没有被加载过，则调用原生模块的加载方式进行加载和执行。</p>
<blockquote>
<p>原生模块的本质也是文件，原生模块文件已经被编译到了二进制文件中了，我们只需要按照名字来加载就可以了。如：require(‘fs’)或require(‘http’)</p>
</blockquote>
</li>
<li><p>三、路径形式的模块</p>
<p>我们说的路径形式的模块，其实就是加载自己写的JS文件，有四种方式可以加载。</p>
<p>当文件模块缓存中不存在，而且不是原生模块的时候，Node.js 会解析 require 方法传入的参数，并从文件系统中加载实际的文件 。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">var</span> fooExports = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;./index&#x27;</span>)	<span class="hljs-comment">//相对路径，常用</span><br><span class="hljs-keyword">var</span> fooExports = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;../index&#x27;</span>)	<span class="hljs-comment">//相对路径，常用</span><br><span class="hljs-keyword">var</span> fooExports = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;/index&#x27;</span>)	<span class="hljs-comment">//根目录，不常用</span><br><span class="hljs-keyword">var</span> fooExports = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;D:/demo/index&#x27;</span>)	<span class="hljs-comment">//根目录，不常用</span><br></code></pre></td></tr></table></figure>

<p>注意，这里忽略了扩展名“.js”，以下是对等的：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">var</span> myMod = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;./my_mod&#x27;</span>)<br><span class="hljs-keyword">var</span> myMod = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;./my_mod.js&#x27;</span>)<br></code></pre></td></tr></table></figure>

<p>如果当前目录有my_mod.js和my_mod.json，则会优先加载 my_mod.js。</p>
<p>可以直接require一个目录，假设有一个目录名为folder，如：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">var</span> myMod = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;./folder&#x27;</span>)<br></code></pre></td></tr></table></figure>

<p>此时，Node将搜索整个folder目录，Node会假设folder为一个包并试图找到包定义文件package.json。如果folder 目录里没有包含package.json文件，Node会假设默认主文件为index.js，即会加载index.js。如果index.js也不存在， 那么加载将失败。 </p>
<p>假如目录结构如下：</p>
<p><img src="https://img-blog.csdnimg.cn/20190503170609761.png" srcset="/img/loading.gif" lazyload alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" srcset="/img/loading.gif" lazyload alt="点击并拖拽以移动"></p>
<p>package.json定义如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs javascript">&#123;<br>    <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;pack&quot;</span>,<br>    <span class="hljs-string">&quot;main&quot;</span>: <span class="hljs-string">&quot;modA.js&quot;</span><br>&#125;<br></code></pre></td></tr></table></figure>

<p>此时 require(‘./folder’) 将返回模块modA.js。如果package.json不存在，那么将返回模块index.js。如果index.js也不存在，那么将发生载入异常。 </p>
<p>如果folder同级目录还有folder.js和folder.json，同时folder目录下还有index.js，则require(‘./folder’) 将返回folder.js中的内容，否则返回folder.json中的内容，否则会返回folder目录下index.js中的内容，最后才会返回modA.js中的内容。</p>
</li>
<li><p>四、第三方模块</p>
<p>凡是用到第三方模块，都必须通过 npm 来下载；</p>
<p>使用的时候就可以通过 require(‘包名’) 的方式来进行加载才可以使用；</p>
<p>不可能有任何一个第三方包和核心模块的名字是一样的。</p>
<blockquote>
<p>既不是核心模块、也不是路径形式的模块，就是第三方模块。</p>
</blockquote>
<p>如果模块名不是路径，也不是内置模块，Node将试图去当前目录的node_modules文件夹里搜索。如果当前目录的node_modules里没有找到，Node会从父目录的node_modules里搜索，这样递归下去直到根目录。</p>
</li>
<li><p>总结：</p>
<p>其实主要就是两种情况：</p>
<p>1、如果require中是名称，则说明搜索的是内置模块或者第三方模块，此时内置模块的优先级高于第三方模块；</p>
<p>2、如果require中是路径，则会按照自定义模块的规则查找。</p>
</li>
</ul>
</li>
</ul>
<h2 id="第三章-Node-js异步编程"><a href="#第三章-Node-js异步编程" class="headerlink" title="第三章 Node.js异步编程"></a>第三章 Node.js异步编程</h2><h3 id="3-1-回调函数"><a href="#3-1-回调函数" class="headerlink" title="3.1 回调函数"></a>3.1 回调函数</h3><h4 id="引入"><a href="#引入" class="headerlink" title="引入"></a>引入</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">let</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;fs&quot;</span>);<br><br>fs.readFile(<span class="hljs-string">&quot;./demo.txt&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">error, data</span>) </span>&#123;<br>    <span class="hljs-comment">/* 注意error和data顺序不能换 */</span><br>	<span class="hljs-built_in">console</span>.log(data, error);<br>	<span class="hljs-keyword">if</span> (error) <span class="hljs-keyword">return</span> <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&quot;出错了！&quot;</span>);<br>	<span class="hljs-built_in">console</span>.log(data.toString());<br>&#125;);<br><span class="hljs-built_in">console</span>.log(<span class="hljs-string">&quot;程序运行结束&quot;</span>);<br></code></pre></td></tr></table></figure>

<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs txt">程序运行结束<br>&lt;Buffer 73 6a 74 75&gt; null<br>sjtu<br></code></pre></td></tr></table></figure>

<h4 id="阻塞"><a href="#阻塞" class="headerlink" title="阻塞"></a>阻塞</h4><p>单线程在程序执行时，程序执行路径按照连续顺序排下来，前面的必须处理好，后面的才会执行。</p>
<p>阻塞时，在调用结果返回前，当前线程会被挂起，调用会一直等待数据就绪返回。</p>
<h4 id="非阻塞"><a href="#非阻塞" class="headerlink" title="非阻塞"></a>非阻塞</h4><p>非阻塞是不需要按顺序执行的，非阻塞调用不能立即得到结果，无论什么情况下都会立即返回，该调用不会阻塞当前线程。</p>
<p>案例：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>非阻塞案例<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><br><span class="javascript">    <span class="hljs-keyword">var</span> img = <span class="hljs-keyword">new</span> Image();</span><br><span class="javascript">    callback = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">w, h</span>) </span>&#123;</span><br><span class="javascript">        <span class="hljs-built_in">console</span>.log(w, h);</span><br>    &#125;<br><span class="javascript">    img.onload = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;</span><br>        if (img.complete) callback(img.width, img.height);<br>        callback(img.width, img.height);<br><span class="javascript">        <span class="hljs-built_in">document</span>.body.appendChild(img);</span><br>    &#125;<br><span class="javascript">    img.addEventListener(<span class="hljs-string">&quot;click&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;</span><br><span class="javascript">        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&quot;点击事件&quot;</span>);</span><br>    &#125;)<br><span class="javascript">    img.src = <span class="hljs-string">&#x27;./feature-19.jpg&#x27;</span>;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure>

<p>注意：创建一个Image对象，就会生成一个<code>&lt;img&gt;</code>标签</p>
<h3 id="3-2-异步编程"><a href="#3-2-异步编程" class="headerlink" title="3.2 异步编程"></a>3.2 异步编程</h3><p><img src="https://gitee.com/zhangjialin_zhulan/myimagerepo/raw/master/images/CVPB4%7DIPSN%604%7D%7DV3%FO%%605A.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<p><img src="https://gitee.com/zhangjialin_zhulan/myimagerepo/raw/master/images/UI$(%60V0BITI%([L0M1)G$A3.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<h4 id="事件发布-订阅模式"><a href="#事件发布-订阅模式" class="headerlink" title="事件发布 / 订阅模式"></a>事件发布 / 订阅模式</h4><ul>
<li><p>事件驱动：</p>
<p><strong>当web服务器接收到请求后，先将其关闭，然后进行处理，再去服务下一个web请求</strong>。<strong>当这个请求完成时，会被放回处理队列</strong>，当到达队列开头，此时处理结果返回给用户。</p>
<p>在事件驱动模型中，会生成一个主循环来监听事件，<strong>当检测到事件时触发回调函数</strong>。</p>
</li>
<li><p>EventEmitter类</p>
<p>Node.js有多个内置事件可以通过引入events模块，并通过实例化EventEmitter类来绑定和监听事件。</p>
<p>首先，通过require加载events模块。然后，通过下列语句来实例化一个对象：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">var</span> eventEmitter = events.EventEmitter();<br></code></pre></td></tr></table></figure>

<p>最后调用一系列方法处理事件。</p>
<p><img src="https://gitee.com/zhangjialin_zhulan/myimagerepo/raw/master/images/$_T%7D_MB%6095ZMWLGHQV%3GSW.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<p>案例：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> EventEmitter = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;events&quot;</span>);<br><span class="hljs-keyword">const</span> myEmitter = <span class="hljs-keyword">new</span> EventEmitter();<br>myEmitter.on(<span class="hljs-string">&quot;event&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;<br>	<span class="hljs-built_in">console</span>.log(<span class="hljs-string">&quot;A&quot;</span>);<br>&#125;);<br><br>myEmitter.addListener(<span class="hljs-string">&quot;click&quot;</span>, <span class="hljs-function">() =&gt;</span> &#123;<br>	<span class="hljs-built_in">console</span>.log(<span class="hljs-string">&quot;super man!&quot;</span>);<br>&#125;);<br><br>myEmitter.emit(<span class="hljs-string">&quot;event&quot;</span>);<br>myEmitter.emit(<span class="hljs-string">&quot;click&quot;</span>);<br></code></pre></td></tr></table></figure>

<p>这种思想也被用来进行vue中的组件传参。</p>
</li>
</ul>
<h4 id="Promise-Deferred"><a href="#Promise-Deferred" class="headerlink" title="Promise / Deferred"></a>Promise / Deferred</h4><p>为了解决回调地狱。</p>
<ul>
<li><p>Promise</p>
<p>异步编程的一种解决方案，类似于一个容器，通常用来保存一个异步操作的结果。避免了层层嵌套的回调函数，可以解决回调地狱问题。</p>
<p>Promise主要用于外部，代表一个异步操作，有三种状态：</p>
<ul>
<li>Pending（进行中）</li>
<li>Fulfilled（已完成）</li>
<li>Rejected（失败），状态不可逆</li>
</ul>
</li>
<li><p>Deferred</p>
<p>Deferred主要用于外部，来维护异步模型的状态。</p>
<p>通过<code>resolve()</code>方法，改变自身状态行为执行态，并触发<code>then()</code>方法的<code>onfulfilled</code>回调函数；</p>
<p>通过<code>reject()</code>方法，改变自身状态为拒绝态，并触发<code>then()</code>方法的<code>onrejected</code>回调函数</p>
</li>
</ul>
<p>案例：</p>
<ul>
<li>下载<code>jquery.js</code></li>
<li>创建一个<code>city.json</code>，使用外部开发的API数据接口</li>
<li>创建一个Node.js Web服务器<code>server.js</code>并运行，启动HTTP服务器，并在浏览器查看</li>
<li>编写<code>main.html</code>文件代码，在浏览器端运行</li>
<li>在<code>main.html</code>页面调试模式下查看结果</li>
</ul>
<p><code>server.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">var</span> http = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;http&quot;</span>);<br><span class="hljs-keyword">var</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;fs&quot;</span>);<br><span class="hljs-keyword">var</span> url = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;url&quot;</span>);<br><br>http<br>	.createServer(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">req, res</span>) </span>&#123;<br>		<span class="hljs-keyword">var</span> pathname = url.parse(req.url).pathname;<br>		<span class="hljs-built_in">console</span>.log(<span class="hljs-string">&quot;Request for&quot;</span> + pathname + <span class="hljs-string">&quot;received.&quot;</span>);<br>		fs.readFile(pathname.substring(<span class="hljs-number">1</span>), <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err, data</span>) </span>&#123;<br>			<span class="hljs-keyword">if</span> (err) &#123;<br>				<span class="hljs-built_in">console</span>.log(err);<br>				res.writeHead(<span class="hljs-number">404</span>, &#123; <span class="hljs-string">&quot;Content-Type&quot;</span>: <span class="hljs-string">&quot;text/html&quot;</span> &#125;);<br>			&#125; <span class="hljs-keyword">else</span> &#123;<br>				res.writeHead(<span class="hljs-number">200</span>, &#123; <span class="hljs-string">&quot;Content-Type&quot;</span>: <span class="hljs-string">&quot;text/html&quot;</span> &#125;);<br>				res.write(data.toString);<br>			&#125;<br>			res.end();<br>		&#125;);<br>	&#125;)<br>	.listen(<span class="hljs-number">5600</span>);<br><br><span class="hljs-built_in">console</span>.log(<span class="hljs-string">&quot;Server running at http://127.0.0.1:5600/&quot;</span>);<br><br></code></pre></td></tr></table></figure>

<p><code>main.html</code></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-comment">&lt;!-- 引入jquery.js --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;../js/jquery.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Document<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><br><span class="javascript">        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">request</span>(<span class="hljs-params">option</span>) </span>&#123;</span><br><span class="javascript">            <span class="hljs-keyword">var</span> def = $.Deferred(); <span class="hljs-comment">// 这调用了jQuery的Deferred方法</span></span><br>            if (!option || !option.url) &#123;<br><span class="javascript">                <span class="hljs-keyword">throw</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">&#x27;url is undefined.&#x27;</span>);</span><br>            &#125;<br><span class="javascript">            <span class="hljs-keyword">var</span> _config = &#123;</span><br><span class="javascript">                type: <span class="hljs-string">&#x27;get&#x27;</span>,</span><br><span class="javascript">                dataType: <span class="hljs-string">&#x27;JSON&#x27;</span>,</span><br><span class="javascript">                success: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">res</span>) </span>&#123;</span><br><span class="javascript">                    def.resolve(res); <span class="hljs-comment">// 通过resolve来改变def对象的状态为“成功”</span></span><br>                &#125;,<br><span class="javascript">                error: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">a, b, err</span>) </span>&#123;</span><br><span class="javascript">                    def.reject(err); <span class="hljs-comment">// 通过reject来改变def对象的状态为“失败”</span></span><br>                &#125;<br>            &#125;;<br><span class="javascript">            $.extend(_config, option, <span class="hljs-literal">true</span>);</span><br><span class="javascript">            $.ajax(_config);</span><br><span class="javascript">            <span class="hljs-keyword">return</span> def.promise(); <span class="hljs-comment">// 返回def对象的承诺（promise）</span></span><br>        &#125;<br><br><span class="javascript">        <span class="hljs-comment">// request调用</span></span><br><span class="javascript">        <span class="hljs-keyword">var</span> option = &#123;</span><br><span class="javascript">            url: <span class="hljs-string">&#x27;./city.json&#x27;</span></span><br>        &#125;;<br><br><span class="javascript">        request(option).then(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">data</span>) </span>&#123;	<span class="hljs-comment">// 成功时执行的回调函数</span></span><br><span class="javascript">            <span class="hljs-built_in">console</span>.log(data);</span><br><span class="javascript">        &#125;, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err</span>) </span>&#123;	<span class="hljs-comment">// 失败时执行的回调函数</span></span><br><span class="javascript">            <span class="hljs-built_in">console</span>.log(err);</span><br>        &#125;)<br>    <span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure>

<p>注意：由于<code>server.js</code>运行在<code>http:127.0.0.1</code>，所以不能直接在<code>localhost</code>下运行<code>main.html</code>，因为存在跨域问题，建议使用<code>live server</code>运行html。</p>
<h3 id="3-3-流程控制库案例"><a href="#3-3-流程控制库案例" class="headerlink" title="3.3 流程控制库案例"></a>3.3 流程控制库案例</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> request = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;request&quot;</span>); <span class="hljs-comment">// 引入request包用于后台发异步请求</span><br><br><span class="hljs-comment">// 创建请求对象，进行请求参数设置</span><br><span class="hljs-keyword">var</span> option1 = &#123;<br>	url: <span class="hljs-string">&quot;https://api.apiopen.top/getJoke&quot;</span>, <span class="hljs-comment">// 请求的后台地址，新实时段子</span><br>	data: &#123;<br>		<span class="hljs-comment">// 传参到后台</span><br>		page: <span class="hljs-number">1</span>, <span class="hljs-comment">// 第n页</span><br>		count: <span class="hljs-number">1</span>, <span class="hljs-comment">// 返回的条数</span><br>		type: <span class="hljs-string">&quot;video&quot;</span>, <span class="hljs-comment">// 返回数据的类型为视频</span><br>	&#125;,<br>&#125;;<br><span class="hljs-keyword">var</span> option2 = &#123;<br>	url: <span class="hljs-string">&quot;https://api.apiopen.top/getSingleJoke&quot;</span>, <span class="hljs-comment">// 通过Id查段子</span><br>	data: &#123;<br>		sid: <span class="hljs-string">&quot;28654780&quot;</span>, <span class="hljs-comment">// 要查的段子的id号</span><br>	&#125;,<br>&#125;;<br><br><span class="hljs-keyword">const</span> myAsyncFn = <span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;<br>	<span class="hljs-comment">// 声明一个异步处理函数</span><br>	<span class="hljs-comment">// await的作用：只有当前这个请求完成后才能执行后面的代码</span><br>	<span class="hljs-keyword">const</span> getJoke = <span class="hljs-keyword">await</span> request(option1, <span class="hljs-function">(<span class="hljs-params">err, res, data</span>) =&gt;</span> &#123;<br>		<span class="hljs-comment">// request是一个异步函数</span><br>		<span class="hljs-built_in">console</span>.log(data); <span class="hljs-comment">// 返回新实时段子</span><br>	&#125;);<br>	<span class="hljs-keyword">const</span> getSingleJoke = <span class="hljs-keyword">await</span> request(option2, <span class="hljs-function">(<span class="hljs-params">err, res, data</span>) =&gt;</span> &#123;<br>		<span class="hljs-built_in">console</span>.log(data); <span class="hljs-comment">// 通过Id查段子</span><br>	&#125;);<br>&#125;;<br><br>myAsyncFn(); <span class="hljs-comment">// 调用myAsyncFn函数</span><br></code></pre></td></tr></table></figure>

<h3 id="实训3-获取天气预报信息"><a href="#实训3-获取天气预报信息" class="headerlink" title="实训3 获取天气预报信息"></a>实训3 获取天气预报信息</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;utf-8&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>天气预报<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;../css/bootstrap.css&quot;</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">&quot;stylesheet&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><br>        .container &#123;<br><span class="css">            <span class="hljs-attribute">margin-top</span>: <span class="hljs-number">30px</span>;</span><br>        &#125;<br><br><span class="css">        <span class="hljs-selector-tag">h2</span> &#123;</span><br><span class="css">            <span class="hljs-attribute">text-align</span>: center;</span><br>        &#125;<br>    <span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;container&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>未来七天天气预报<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">table</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;table table-hover&quot;</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">thead</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">th</span> <span class="hljs-attr">scope</span>=<span class="hljs-string">&quot;col&quot;</span>&gt;</span>日期<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">th</span> <span class="hljs-attr">scope</span>=<span class="hljs-string">&quot;col&quot;</span>&gt;</span>天气情况<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">th</span> <span class="hljs-attr">scope</span>=<span class="hljs-string">&quot;col&quot;</span>&gt;</span>温度<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">th</span> <span class="hljs-attr">scope</span>=<span class="hljs-string">&quot;col&quot;</span>&gt;</span>风力<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">th</span> <span class="hljs-attr">scope</span>=<span class="hljs-string">&quot;col&quot;</span>&gt;</span>空气等级<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">th</span> <span class="hljs-attr">scope</span>=<span class="hljs-string">&quot;col&quot;</span>&gt;</span>建议<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span><br>                <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">thead</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">tbody</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;detail&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">tbody</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">table</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;weather&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text/html&quot;</span>&gt;</span><br><span class="handlebars"><span class="xml">		</span><span class="hljs-template-variable">&#123;&#123; <span class="hljs-name"><span class="hljs-builtin-name">each</span></span> data &#125;&#125;</span></span><br><span class="handlebars"><span class="xml">		<span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span></span></span><br><span class="handlebars"><span class="xml">			<span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span></span><span class="hljs-template-variable">&#123;&#123; <span class="hljs-name">$value.date</span> &#125;&#125;</span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span></span></span><br><span class="handlebars"><span class="xml">			<span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span></span><span class="hljs-template-variable">&#123;&#123; <span class="hljs-name">$value.wea</span> &#125;&#125;</span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span></span></span><br><span class="handlebars"><span class="xml">			<span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>最低温度：</span><span class="hljs-template-variable">&#123;&#123; <span class="hljs-name">$value.tem2</span> &#125;&#125;</span><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">sup</span>&gt;</span>。<span class="hljs-tag">&lt;/<span class="hljs-name">sup</span>&gt;</span>，最高温度：</span><span class="hljs-template-variable">&#123;&#123; <span class="hljs-name">$value.tem1</span> &#125;&#125;</span><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">sup</span>&gt;</span>。<span class="hljs-tag">&lt;/<span class="hljs-name">sup</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span></span></span><br><span class="handlebars"><span class="xml">			<span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span></span><span class="hljs-template-variable">&#123;&#123; <span class="hljs-name">$value.win_speed</span> &#125;&#125;</span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span></span></span><br><span class="handlebars"><span class="xml">			<span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span></span><span class="hljs-template-variable">&#123;&#123; <span class="hljs-name">$value.air_level</span> &#125;&#125;</span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span></span></span><br><span class="handlebars"><span class="xml">			<span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span></span><span class="hljs-template-variable">&#123;&#123; <span class="hljs-name">$value.index</span>[0].desc &#125;&#125;</span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span></span></span><br><span class="handlebars"><span class="xml">		<span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span></span></span><br><span class="handlebars"><span class="xml">		</span><span class="hljs-template-variable">&#123;&#123; <span class="hljs-name">/each</span> &#125;&#125;</span></span><br>	<span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;../js/jquery.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;../js/template.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;../js/axios.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><br><span class="javascript">    axios.get(<span class="hljs-string">&#x27;https://v0.yiketianqi.com/api?version=v9&amp;appid=59394221&amp;appsecret=sec3chco&#x27;</span>).then(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">res</span>) </span>&#123;</span><br><span class="javascript">        <span class="hljs-keyword">var</span> rs = &#123;</span><br>            data: res.data.data<br>        &#125;;<br><span class="javascript">        <span class="hljs-built_in">console</span>.log(rs.data.data);</span><br><span class="javascript">        <span class="hljs-keyword">var</span> txt = template(<span class="hljs-string">&#x27;weather&#x27;</span>, rs);</span><br><span class="javascript">        $(<span class="hljs-string">&#x27;.detail&#x27;</span>).html(txt);</span><br><span class="javascript">    &#125;).catch(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err</span>) </span>&#123;</span><br><span class="javascript">        <span class="hljs-built_in">console</span>.log(err);</span><br>    &#125;)<br><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure>

<p>同步代码中使用try……catch处理异常，异步代码中使用回调函数处理异常。</p>
<h2 id="第四章-内存管理"><a href="#第四章-内存管理" class="headerlink" title="第四章 内存管理"></a>第四章 内存管理</h2><h3 id="4-1-BUFFER缓存区"><a href="#4-1-BUFFER缓存区" class="headerlink" title="4.1 BUFFER缓存区"></a>4.1 BUFFER缓存区</h3><h4 id="BUFFER简介"><a href="#BUFFER简介" class="headerlink" title="BUFFER简介"></a>BUFFER简介</h4><ul>
<li><p>Buffer</p>
<ul>
<li>Buffer缓存区，处理文件流和二进制流</li>
</ul>
</li>
<li><p>Buffer类</p>
<ul>
<li>核心类库，无需引入即可直接使用，使用Buffer类提供的构造函数创建Buffer实例。</li>
<li>通过Buffer缓存区存放二进制数据，进行二进制字节流的读、写和网络传输</li>
</ul>
</li>
<li><p>Stream 和 Buffer</p>
<ul>
<li><p>流(Stream)就是一些列从A到B点移动的数据</p>
</li>
<li><p>二者联系：分为数据送达和处理</p>
<ul>
<li>数据量较小，送达比处理更快，需要等待数据处理完毕。</li>
<li>数据量较大，处理比送达更快，需要等待完整数据送达</li>
</ul>
<p>这两个等待的过程，就需要在Buffer缓冲区中</p>
<p>案例：视频播放过程中的卡顿情况</p>
</li>
</ul>
<p>在应用中，因为在后端与前端、后端的IO中，每当需要在 Node.js 中处理I/O操作中移动的数据时，就有可能使用 Buffer 库，很多时候会出现数据过大，不能一次性读取的问题。会导致程序的等待时间过长，因此，流操作（stream）便营运而生。</p>
<p>buffer：内存中一块确定的临时存储区域。<br>stream：一段不确定长度的数据序列，可以认为stream就是I/O中input部分的FIFO实现，为了方便理解，可以用键盘输入作为输入来举例，从键盘中敲入的字符组成一段stream,先敲入的字符先被读取，也就是FIFO,但是读取的过程中，你并不知道总共要读取多少，也就是长度的不确定性。</p>
<p>在使用 stream 的过程中，我们遵循这样一个基本的过程，以从文件中读取为例:<br>1.程序向 stream 发起请求，要读取一个字节。<br>2.stream 在磁盘上定为到请求的字节，并发送给程序。<br>3.程序得到这个字节后，在进行请求，重复到第一步</p>
<p>这个样子就有一个很严重的效率问题，读取一个字节需要在程序和stream之间来回一次，那么1000个字节就是1000次。怎么解决这个问题呢？</p>
<p>这时候就到 buffer 出场了，buffer 根据上面的概念,他是内存中一块确定的临时存储区域。如果使用一个 1000 字节的 buffer ,那么程序和 stream 的关系就变成:<br>1.程序向stream发起请求，要求stream将buffer填满。<br>2.stream向buffer中填充字节，要么填满1000个字节为止，要么stream到达结尾为止。<br>3.程序从buffer中一次性获取1000字节的数据</p>
<p>很明显，使用buffer的好处在于减少的请求IO的次数，也大大提升了效率。</p>
</li>
</ul>
<h4 id="BUFFER类API"><a href="#BUFFER类API" class="headerlink" title="BUFFER类API"></a>BUFFER类API</h4><p><code>Buffer.from(value)</code></p>
<p>申请Buffer实例，将内容写入刚刚申请的Buffer内存中。</p>
<p>value为传入的参数，根据传入值的不同可以分为不同的形式。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> buffer = Buffer.from(<span class="hljs-string">&quot;july&quot;</span>);<br><span class="hljs-built_in">console</span>.log(buffer); <span class="hljs-comment">// &lt;Buffer 6a 75 6c 79&gt;</span><br><span class="hljs-built_in">console</span>.log(buffer.toString()); <span class="hljs-comment">//输出缓存区内容</span><br></code></pre></td></tr></table></figure>

<p><code>Buffer.alloc(size,[,fill[,encoding]])</code></p>
<p>返回一个指定size个字节空间大小的Buffer实例。size为数字，表示分配字节的大小，size不是一个数字则抛出一个TypeError错误。</p>
<p>fill用于设置新建Buffer的初始值，如省略，则默认为undefined（该Buffer用0填充），默认填满。</p>
<p>encoding用于设置字符编码格式，如果没有指定，则为<code>utf-8</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> buf1 = Buffer.alloc(<span class="hljs-number">6</span>);<br><span class="hljs-keyword">const</span> buf2 = Buffer.alloc(<span class="hljs-number">6</span>, <span class="hljs-number">3</span>);<br><span class="hljs-comment">/* 注意：一个汉字占用3个字节，低于12字节将被截断，高于12字节将重复存储 */</span><br><span class="hljs-keyword">const</span> buf3 = Buffer.alloc(<span class="hljs-number">12</span>, <span class="hljs-string">&quot;前端&quot;</span>, <span class="hljs-string">&quot;utf-8&quot;</span>);<br><span class="hljs-keyword">const</span> buf4 = Buffer.alloc(<span class="hljs-number">12</span>, <span class="hljs-string">&quot;前端开发学习&quot;</span>, <span class="hljs-string">&quot;utf-8&quot;</span>);<br><span class="hljs-keyword">const</span> buf5 = Buffer.alloc(<span class="hljs-number">12</span>, <span class="hljs-string">&quot;前端开发&quot;</span>, <span class="hljs-string">&quot;utf-8&quot;</span>);<br><br><span class="hljs-built_in">console</span>.log(buf1); <span class="hljs-comment">// &lt;Buffer 00 00 00 00 00 00&gt;</span><br><span class="hljs-built_in">console</span>.log(buf2); <span class="hljs-comment">// &lt;Buffer 03 03 03 03 03 03&gt;</span><br><span class="hljs-built_in">console</span>.log(buf3); <span class="hljs-comment">// &lt;Buffer e5 89 8d e7 ab af e5 89 8d e7 ab af&gt;</span><br><span class="hljs-built_in">console</span>.log(buf3.toString()); <span class="hljs-comment">// 前端前端 -- 重复存储</span><br><span class="hljs-built_in">console</span>.log(buf4); <span class="hljs-comment">// &lt;Buffer e5 89 8d e7 ab af e5 bc 80 e5 8f 91&gt;</span><br><span class="hljs-built_in">console</span>.log(buf4.toString()); <span class="hljs-comment">// 前端开发 -- 截断</span><br><span class="hljs-built_in">console</span>.log(buf5); <span class="hljs-comment">// &lt;Buffer e5 89 8d e7 ab af e5 bc 80 e5 8f 91&gt;</span><br><span class="hljs-built_in">console</span>.log(buf5.toString()); <span class="hljs-comment">// 前端开发</span><br></code></pre></td></tr></table></figure>

<p><code>Buffer.allocUnsafe(size)</code></p>
<p>返回一个size字节大小的新的非零填充(non-zero-filled)的Buffer，生成的Buffer实例不被初始化。</p>
<p>注意：使用Buffer.allocUnsafe创建Buffer后，应是使用<code>buf.fill()</code>将这个Buffer初始化为0</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">/* Buffer.allocUnsafe() */</span><br><span class="hljs-keyword">const</span> buffer1 = Buffer.allocUnsafe(<span class="hljs-number">10</span>);<br><span class="hljs-keyword">const</span> buffer2 = Buffer.allocUnsafe(<span class="hljs-number">10</span>);<br><span class="hljs-keyword">const</span> buffer3 = Buffer.allocUnsafe(<span class="hljs-number">10</span>);<br><br><span class="hljs-built_in">console</span>.log(buffer1); <span class="hljs-comment">// 随机</span><br><span class="hljs-built_in">console</span>.log(buffer2); <span class="hljs-comment">// 随机</span><br><span class="hljs-built_in">console</span>.log(buffer3); <span class="hljs-comment">// 随机</span><br></code></pre></td></tr></table></figure>

<ul>
<li>Buffer.allocUnsafe(size).fill(fill)方法和 Buffer.alloc(size, fill)方法的区别<ul>
<li>用 Buffer.allocUnsafe(size).fill(fill)方法创建的 Buffer 实例在 size 小于或等于 Buffer.  poolSize 的一半时将使用内部的 Buffer 池，因此，调用 Buffer.allocUnsafe(size).fill(fill)比调用 Buffer.alloc(size, fill)有可能快很多。（速度）</li>
<li>Buffer.allocUnsafe 创建的 Buffer 实例的底层内存是没被初始化过的，新创建的 Buffer 的 内容是未知的，可能包含敏感数据。用 Buffer.alloc(size, fill)创建的实例，默认初值为 0，因此，能 确保新创建的 Buffer 实例的内容永远不会包含来自先前分配的敏感数据，包括可能尚未分配给 Buffer 的数据。（初始值）</li>
</ul>
</li>
</ul>
<h4 id="BUFFER与字符编码"><a href="#BUFFER与字符编码" class="headerlink" title="BUFFER与字符编码"></a>BUFFER与字符编码</h4><p>字符编码&lt;===&gt;Buffer</p>
<p>Buffer缓存区处理数据，事先数据按一定字符编码转换为二进制数据，这个过程叫编码。</p>
<p>反过来，当数据处理完成，又必须将二进制数据按一定字符编码转换为人们能读懂的字符串等信息，这个过程叫解码。</p>
<p>支持的buffer与字符串互转的字符编码：</p>
<ul>
<li>utf-8</li>
<li>utf16le</li>
<li>latin1</li>
<li>base64</li>
<li>hex</li>
</ul>
<p>示例：将Buffer转换为不同字符编码的字符串。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> buf = Buffer.from(<span class="hljs-string">&quot;懦弱的张加林&quot;</span>);<br><span class="hljs-built_in">console</span>.log(buf); <span class="hljs-comment">// &lt;Buffer e6 87 a6 e5 bc b1 e7 9a 84 e5 bc a0 e5 8a a0 e6 9e 97&gt;</span><br><span class="hljs-built_in">console</span>.log(buf.toString()); <span class="hljs-comment">// 懦弱的张加林(默认utf-8)</span><br><span class="hljs-built_in">console</span>.log(buf.toString(<span class="hljs-string">&quot;utf-8&quot;</span>)); <span class="hljs-comment">// 懦弱的张加林</span><br><span class="hljs-built_in">console</span>.log(buf.toString(<span class="hljs-string">&quot;base64&quot;</span>)); <span class="hljs-comment">// 5oem5byx55qE5byg5Yqg5p6X</span><br></code></pre></td></tr></table></figure>

<h3 id="4-2-文件系统"><a href="#4-2-文件系统" class="headerlink" title="4.2 文件系统"></a>4.2 文件系统</h3><h4 id="4-2-1-文件打开与关闭"><a href="#4-2-1-文件打开与关闭" class="headerlink" title="4.2.1 文件打开与关闭"></a>4.2.1 文件打开与关闭</h4><h5 id="fs简介"><a href="#fs简介" class="headerlink" title="fs简介"></a>fs简介</h5><p>fs模块：Node.js针对前端开发中的文件操作问题，提供的文件操作API</p>
<p>文件同步操作：同步方法执行返回结果后，才能执行后续的代码，给用户一种卡死的感觉，形成阻塞。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;fs&quot;</span>);<br><span class="hljs-keyword">try</span> &#123;<br>	fs.unlinkSync(<span class="hljs-string">&quot;./demo.txt&quot;</span>); <span class="hljs-comment">// 删除文件</span><br>	<span class="hljs-built_in">console</span>.log(<span class="hljs-string">&quot;删除成功&quot;</span>);<br>&#125; <span class="hljs-keyword">catch</span> (err) &#123;<br>	<span class="hljs-built_in">console</span>.log(err);<br>&#125;<br><br></code></pre></td></tr></table></figure>

<p>文件异步操作：用户无需等待结果，比起同步，异步方法无阻塞，性能更高，速度更快，所以Node.js的文件操作建议采用异步操作。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;fs&quot;</span>);<br><br>fs.unlink(<span class="hljs-string">&quot;./demo.txt&quot;</span>, <span class="hljs-function">(<span class="hljs-params">error</span>) =&gt;</span> &#123;<br>	<span class="hljs-keyword">if</span> (error) <span class="hljs-keyword">throw</span> error;<br>	<span class="hljs-built_in">console</span>.log(<span class="hljs-string">&quot;已成功删除文件&quot;</span>);<br>&#125;);<br></code></pre></td></tr></table></figure>

<p>fs基本用法</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">var</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;fs&#x27;</span>);<br></code></pre></td></tr></table></figure>

<p>fs提供读写方法，对应参数：</p>
<ul>
<li>path：要打开的文路径或文件描述</li>
<li>file：协议的URL对象作为fs操作的路径</li>
<li>flags：文件打开的模式</li>
<li>mode：设置文件权限</li>
</ul>
<p><img src="https://gitee.com/zhangjialin_zhulan/myimagerepo/raw/master/images/~L05T3_XDGGF7P$L%7BSZZH2K.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<h5 id="打开文件"><a href="#打开文件" class="headerlink" title="打开文件"></a>打开文件</h5><ul>
<li><p>同步打开文件</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js">fs.openSync(path,[,flags,mode]);<br></code></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">let</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;fs&quot;</span>);<br><br><span class="hljs-keyword">let</span> fd = fs.openSync(<span class="hljs-string">&quot;./test.txt&quot;</span>, <span class="hljs-string">&quot;w+&quot;</span>);<br>fs.write(fd, <span class="hljs-string">&quot;我一直很讨厌你！&quot;</span>, <span class="hljs-function">(<span class="hljs-params">err, written, str</span>) =&gt;</span> &#123;<br>	<span class="hljs-keyword">if</span> (err) <span class="hljs-keyword">throw</span> err;<br>	<span class="hljs-built_in">console</span>.log(written);<br>	<span class="hljs-built_in">console</span>.log(str);<br>&#125;);<br></code></pre></td></tr></table></figure>
</li>
<li><p>异步打开文件</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js">fs.open(path, flags, [, mode], callback)<br></code></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">let</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;fs&quot;</span>);<br><br>fs.open(<span class="hljs-string">&quot;./test.txt&quot;</span>, <span class="hljs-string">&quot;w+&quot;</span>, <span class="hljs-function">(<span class="hljs-params">err, fd</span>) =&gt;</span> &#123;<br>	<span class="hljs-comment">// fd为文件指针，指向打开的文件</span><br>	<span class="hljs-keyword">if</span> (err) &#123;<br>		<span class="hljs-built_in">console</span>.log(<span class="hljs-string">&quot;打开文件失败&quot;</span>);<br>		<span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>	&#125;<br>	fs.write(fd, <span class="hljs-string">&quot;我一直很讨厌你！&quot;</span>, <span class="hljs-function">(<span class="hljs-params">err, written, str</span>) =&gt;</span> &#123;<br>		<span class="hljs-keyword">if</span> (err) <span class="hljs-keyword">throw</span> err;<br>		<span class="hljs-built_in">console</span>.log(written); <span class="hljs-comment">// 返回字符串所占字节数 - 一个汉字占用3个字节</span><br>		<span class="hljs-built_in">console</span>.log(str); <span class="hljs-comment">// 返回写入的文件内容</span><br>	&#125;);<br>&#125;);<br></code></pre></td></tr></table></figure>
</li>
<li><p>共性：</p>
<ul>
<li>其中path为必选值</li>
<li>两者的返回值都为<number>：表示文件描述符</li>
</ul>
</li>
<li><p>区别：</p>
<ul>
<li>异步打开文件的回调函数有两个参数<ul>
<li>error<Error>，异常出错信息</li>
<li>fd<integer>，打开后的文件标识符</li>
</ul>
</li>
</ul>
</li>
</ul>
<h5 id="关闭文件"><a href="#关闭文件" class="headerlink" title="关闭文件"></a>关闭文件</h5><p>同步关闭文件</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js">fs.closeSync(fd);<br></code></pre></td></tr></table></figure>

<p>异步关闭文件</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js">fs.close(fd, callback);<br></code></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;fs&#x27;</span>);<br>fs.open(<span class="hljs-string">&#x27;./test.txt&#x27;</span>, <span class="hljs-string">&#x27;rs+&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">err, fd</span>) =&gt;</span> <br>&#123;  <br>   <span class="hljs-keyword">if</span> (err) &#123;<br>      <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&#x27;文件打开失败！’);</span><br><span class="hljs-string">      return false;</span><br><span class="hljs-string">   &#125;</span><br><span class="hljs-string">   fs.close(fd, err =&gt; &#123; </span><br><span class="hljs-string">      if (err) throw err;</span><br><span class="hljs-string">      console.log(&#x27;</span>文件正常关闭！’);<br>   &#125;)<br>&#125;)<br><br></code></pre></td></tr></table></figure>

<p>共性：</p>
<ul>
<li>fd：表示要关闭的文件标识，必选</li>
</ul>
<p>区别：</p>
<ul>
<li>异步关闭存在回调函数，内部只有一个异常参数</li>
</ul>
<h4 id="4-2-2-文件的读取和写入"><a href="#4-2-2-文件的读取和写入" class="headerlink" title="4.2.2 文件的读取和写入"></a>4.2.2 文件的读取和写入</h4><h5 id="读取文件"><a href="#读取文件" class="headerlink" title="读取文件"></a>读取文件</h5><p><code>fs.readFile(path[,options,], callback)</code></p>
<p>用于异步读取文件的全部内容。</p>
<p>参数说明：</p>
<ul>
<li><p><code>options</code></p>
<ul>
<li><code>encoding</code>：编码方式，默认值：null</li>
<li><code>flag</code>：文件系统flag的支持，默认为<code>r</code></li>
</ul>
</li>
<li><p><code>callback</code>：说明异步读取文件的回调函数</p>
<p>传入两个参数(err, data)</p>
<ul>
<li><code>err</code>：异常出错信息</li>
<li><code>data</code>：读取文件内容，若未指定字符编码，返回原始buffer</li>
</ul>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">let</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;fs&quot;</span>);<br><br>fs.readFile(<span class="hljs-string">&quot;./data.json&quot;</span>, <span class="hljs-string">&quot;utf-8&quot;</span>, <span class="hljs-function">(<span class="hljs-params">err, data</span>) =&gt;</span> &#123;<br>	<span class="hljs-keyword">if</span> (err) <span class="hljs-keyword">throw</span> err;<br>	<span class="hljs-built_in">console</span>.log(<span class="hljs-built_in">JSON</span>.parse(data));<br>&#125;);<br></code></pre></td></tr></table></figure>

<p>注意事项</p>
<ul>
<li><code>fs.readFile()</code>函数会缓冲整个文件</li>
<li>任何指定的文件描述符都必须支持读取</li>
<li>如果将文件描述符指定为path，则不会自动关闭它，读取时将从当前位置开始（一定要手动关闭，不然可能导致内存泄漏，系统崩溃）</li>
</ul>
<h5 id="写入文件"><a href="#写入文件" class="headerlink" title="写入文件"></a>写入文件</h5><p><code>fs.write(fd, string,[,position, [,encoding], callback)</code></p>
<p>用于将string写入到fd指定的文件</p>
<p>参数说明：</p>
<ul>
<li><p><code>fd</code>：文件路径或文件描述符</p>
</li>
<li><p><code>string</code>：要写入的字符串内容，也可以是一个buffer</p>
</li>
<li><p><code>position</code>：数据要被写入的位置</p>
</li>
<li><p><code>encoding</code>：是期望的字符串编码，默认值<code>utf-8</code></p>
</li>
<li><p><code>callback</code>：回调函数会接收到参数(err, written, string)</p>
<ul>
<li><p><code>written</code>：指定传入的字符串中写入的字节数。</p>
<p>注意：被写入的字节数不一定与被写入的字符串字符数相同（一个汉字占3字节，英文字母占1个字节）。</p>
</li>
</ul>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;fs&quot;</span>);<br><br>fs.open(<span class="hljs-string">&quot;./test.txt&quot;</span>, <span class="hljs-string">&quot;rs+&quot;</span>, <span class="hljs-function">(<span class="hljs-params">err, fd</span>) =&gt;</span> &#123;<br>	<span class="hljs-keyword">if</span> (err) &#123;<br>		<span class="hljs-built_in">console</span>.log(err);<br>		<span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>	&#125;<br>	fs.write(fd, <span class="hljs-string">&quot;百年孤独&quot;</span>, <span class="hljs-string">&quot;utf-8&quot;</span>, <span class="hljs-function">(<span class="hljs-params">err, written, str</span>) =&gt;</span> &#123;<br>		<span class="hljs-keyword">if</span> (err) <span class="hljs-keyword">throw</span> err;<br>		<span class="hljs-built_in">console</span>.log(written); <span class="hljs-comment">// 12</span><br>		<span class="hljs-built_in">console</span>.log(str);<br>	&#125;);<br>&#125;);<br><br></code></pre></td></tr></table></figure>

<p><code>fs.writeFile(file, data[, options], callback)</code>：当 <code>file</code> 是文件名时，将数据异步地写入文件，如果文件已存在则替换该文件。 <code>data</code> 可以是字符串或缓冲区。    </p>
<h4 id="4-2-3-读取目录"><a href="#4-2-3-读取目录" class="headerlink" title="4.2.3 读取目录"></a>4.2.3 读取目录</h4><p>读取目录的语法：</p>
<p><code>fs.readdir(path[, options], callback)</code></p>
<p>用于异步地读取目录中的内容</p>
<p>参数说明：</p>
<ul>
<li><p><code>path</code>：表示将要读取地文件夹或标识符，必选</p>
</li>
<li><p><code>options</code>：可以是字符编码、或具有encoding属性对象</p>
<p><code>encoding</code>：为<code>buffer</code>，返回文件名作为Buffer传入</p>
</li>
<li><p><code>callback</code>：异步地读取文件的回调函数</p>
<ul>
<li><code>err</code>：异常出错</li>
<li><code>files</code>：files是目录里中文件名的数组</li>
</ul>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;fs&quot;</span>);<br><br>fs.readdir(<span class="hljs-string">&quot;./&quot;</span>, <span class="hljs-function">(<span class="hljs-params">err, files</span>) =&gt;</span> &#123;<br>    <span class="hljs-comment">/* 输出当前目录下的所有文件 */</span><br>	<span class="hljs-keyword">if</span> (err) <span class="hljs-keyword">throw</span> err;<br>	<span class="hljs-built_in">console</span>.log(files);<br>&#125;);<br></code></pre></td></tr></table></figure>

<h3 id="4-3-fs流"><a href="#4-3-fs流" class="headerlink" title="4.3 fs流"></a>4.3 fs流</h3><h4 id="fs流简介"><a href="#fs流简介" class="headerlink" title="fs流简介"></a>fs流简介</h4><p>fs流：Node.js的抽象接口</p>
<p>fs流的作用：</p>
<ul>
<li>读取大文件的过程中，不会一次性读入到内存中</li>
<li>每次读取数据源的一个数据块，然后立刻处理</li>
</ul>
<p>流的类型：</p>
<ul>
<li>readable：可读的流，如：<code>fs.createReadStream()</code></li>
<li>writable：可写的流，如：<code>fs.createWriteStream()</code></li>
<li>duplex：可读写的流，如：<code>net.socket()</code></li>
<li>transform：在读写过程中可以修改和改变数据的Duplex流，如：<code>zlib.createDeflate()</code></li>
</ul>
<p>流的事件：所有Stream对象都是事件发射器EventEmitter的实例，发射的常用事件有：data事件、end事件、error事件、finish事件</p>
<h4 id="创建流"><a href="#创建流" class="headerlink" title="创建流"></a>创建流</h4><h5 id="可读流"><a href="#可读流" class="headerlink" title="可读流"></a>可读流</h5><p>创建fs可读流，用于从流中读取数据。客户端的HTTP响应，服务器的HTTP请求，fs读取流都是可读流的例子。</p>
<p><code>fs.createReadStream(path,[, options])</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;fs&quot;</span>);<br><span class="hljs-keyword">let</span> data = <span class="hljs-string">&quot;&quot;</span>;<br><br><span class="hljs-keyword">var</span> readerStream = fs.createReadStream(<span class="hljs-string">&quot;./love.txt&quot;</span>);<br>readerStream.setEncoding(<span class="hljs-string">&quot;utf-8&quot;</span>);<br><br><span class="hljs-comment">/* 当有数据时触发data事件 */</span><br>readerStream.on(<span class="hljs-string">&quot;data&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">chunk</span>) </span>&#123;<br>	data += chunk;<br>	<span class="hljs-built_in">console</span>.log(data);<br>&#125;);<br><span class="hljs-comment">/* 当没有数据时，触发end事件 */</span><br>readerStream.on(<span class="hljs-string">&quot;end&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;<br>	<span class="hljs-built_in">console</span>.log(<span class="hljs-string">&quot;该文件已经没有内容&quot;</span>);<br>&#125;);<br><span class="hljs-comment">/* 打开文件错误触发error事件 */</span><br>readerStream.on(<span class="hljs-string">&quot;error&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err</span>) </span>&#123;<br>	<span class="hljs-built_in">console</span>.log(err.stack);<br>&#125;);<br><br><span class="hljs-built_in">console</span>.log(<span class="hljs-string">&quot;程序执行完毕!&quot;</span>);<br><br></code></pre></td></tr></table></figure>

<h5 id="可写流"><a href="#可写流" class="headerlink" title="可写流"></a>可写流</h5><p>可写流也叫写入流，创建fs可写流，可用于向流中写入数据。</p>
<p><code>fs.createWriteStream(path[,options])</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;fs&quot;</span>);<br><span class="hljs-keyword">const</span> data = <span class="hljs-string">&quot;I will be there for you!&quot;</span>;<br><span class="hljs-keyword">let</span> writerStream = fs.createWriteStream(<span class="hljs-string">&quot;./love.txt&quot;</span>);<br>writerStream.write(data, <span class="hljs-string">&quot;utf-8&quot;</span>);<br>writerStream.end();<br><br>writerStream.on(<span class="hljs-string">&quot;finish&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;<br>	<span class="hljs-built_in">console</span>.log(<span class="hljs-string">&quot;写入完成~&quot;</span>);<br>&#125;);<br><br>writerStream.on(<span class="hljs-string">&quot;error&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err</span>) </span>&#123;<br>	<span class="hljs-built_in">console</span>.log(err.stack);<br>&#125;);<br><br><span class="hljs-built_in">console</span>.log(<span class="hljs-string">&quot;程序执行完毕！&quot;</span>);<br></code></pre></td></tr></table></figure>

<h5 id="其他流方式"><a href="#其他流方式" class="headerlink" title="其他流方式"></a>其他流方式</h5><p>管道流：管道流是可读流的一种方法，将可读流与可写流进行管道方式的绑定，将可读流信息通过管道方式写入可写流的一种数据写入方式。</p>
<p>语法：<code>readable.pipe(destination[, options])</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;fs&quot;</span>);<br><br><span class="hljs-keyword">var</span> readerStream = fs.createReadStream(<span class="hljs-string">&quot;./love.txt&quot;</span>);<br><br><span class="hljs-keyword">var</span> writerStream = fs.createWriteStream(<span class="hljs-string">&quot;./forever.txt&quot;</span>);<br><br>readerStream.pipe(writerStream);<br><span class="hljs-built_in">console</span>.log(<span class="hljs-string">&quot;执行完成&quot;</span>);<br><br></code></pre></td></tr></table></figure>

<p>链式流：一般用于管道操作，在单个可读流上绑定多个可写流的流操作链。</p>
<h3 id="实训4"><a href="#实训4" class="headerlink" title="实训4"></a>实训4</h3><h4 id="Buffer缓存区操作"><a href="#Buffer缓存区操作" class="headerlink" title="Buffer缓存区操作"></a>Buffer缓存区操作</h4><p>API：</p>
<ul>
<li><p>写入缓存区</p>
<p><code>buf.write(string[,offset[,length]][,encoding])</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 2.写入缓存区</span><br><span class="hljs-keyword">let</span> buffer1 = <span class="hljs-keyword">new</span> Buffer.alloc(<span class="hljs-number">256</span>);<br><span class="hljs-keyword">var</span> length = buffer1.write(<span class="hljs-string">&quot;https://www.ptpress.com.cn&quot;</span>);<br><span class="hljs-built_in">console</span>.log(buffer1);<br><span class="hljs-built_in">console</span>.log(length);<br></code></pre></td></tr></table></figure>
</li>
<li><p>从缓存读取数据</p>
<p>语法：<code>buf.toString([encoding[,start[,end]]])</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">var</span> buffer2 = <span class="hljs-keyword">new</span> Buffer.alloc(<span class="hljs-number">26</span>);<br><span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">26</span>; i++) &#123;<br>	buffer2[i] = i + <span class="hljs-number">97</span>;<br>&#125;<br><span class="hljs-built_in">console</span>.log(buffer2.toString(<span class="hljs-string">&quot;utf-8&quot;</span>));<br><span class="hljs-built_in">console</span>.log(buffer2.toString(<span class="hljs-string">&quot;ascii&quot;</span>, <span class="hljs-number">0</span>, <span class="hljs-number">5</span>));<br><span class="hljs-built_in">console</span>.log(buffer2.toString(<span class="hljs-string">&quot;utf-8&quot;</span>, <span class="hljs-number">0</span>, <span class="hljs-number">5</span>));<br></code></pre></td></tr></table></figure>
</li>
<li><p>转换为JSON</p>
<p>语法：<code>buf.toJSON()</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">var</span> buffer3 = <span class="hljs-keyword">new</span> Buffer.from(<span class="hljs-string">&quot;https://www.ptpress.com.cn&quot;</span>);<br><span class="hljs-keyword">var</span> json = buffer3.toJSON(<span class="hljs-string">&quot;buf&quot;</span>);<br><span class="hljs-built_in">console</span>.log(json);<br></code></pre></td></tr></table></figure>

<img src="https://gitee.com/zhangjialin_zhulan/myimagerepo/raw/master/images/image-20220310112202272.png" srcset="/img/loading.gif" lazyload alt="image-20220310112202272" style="zoom:50%;" />
</li>
<li><p>缓存合并</p>
<p>语法：<code>buffer.concat(list[,totalLength]);</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">var</span> buf7 = <span class="hljs-keyword">new</span> Buffer.from(<span class="hljs-string">&quot;中慧教学平台-&gt;&quot;</span>);<br><span class="hljs-keyword">var</span> buf8 = <span class="hljs-keyword">new</span> Buffer.from(<span class="hljs-string">&quot;https://www.ptpress.com.cn&quot;</span>);<br><span class="hljs-keyword">var</span> buf9 = Buffer.concat([buf7, buf8]);<br><span class="hljs-built_in">console</span>.log(<span class="hljs-string">&quot;------------------5.缓存合并------------------&quot;</span>);<br><span class="hljs-built_in">console</span>.log(<span class="hljs-string">&quot;合并的结果为：&quot;</span> + buf9.toString());<br></code></pre></td></tr></table></figure>

</li>
</ul>
<h4 id="文件模块化管理JSON数据"><a href="#文件模块化管理JSON数据" class="headerlink" title="文件模块化管理JSON数据"></a>文件模块化管理JSON数据</h4><p><img src="https://gitee.com/zhangjialin_zhulan/myimagerepo/raw/master/images/image-20220310105555979.png" srcset="/img/loading.gif" lazyload alt="image-20220310105555979"></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;fs&quot;</span>);<br><br><span class="hljs-comment">// /* 读取json文件方法 */</span><br><span class="hljs-comment">// // 异步读取</span><br><span class="hljs-keyword">let</span> orderAsync = [];<br><span class="hljs-keyword">let</span> readOrderAsync = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">path, order</span>) </span>&#123;<br>	fs.readFile(path, <span class="hljs-string">&quot;utf-8&quot;</span>, <span class="hljs-function">(<span class="hljs-params">err, data</span>) =&gt;</span> &#123;<br>		<span class="hljs-keyword">if</span> (err) <span class="hljs-keyword">throw</span> err;<br>		order = <span class="hljs-built_in">JSON</span>.parse(data);<br>		<span class="hljs-built_in">console</span>.log(<span class="hljs-string">&quot;异步读取&quot;</span>, order);<br>	&#125;);<br>&#125;;<br>readOrderAsync(<span class="hljs-string">&quot;./order.json&quot;</span>, orderAsync);<br><br><span class="hljs-comment">// 同步读取</span><br><span class="hljs-keyword">let</span> orderSync = [];<br><span class="hljs-keyword">let</span> readOrderSync = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">path, order</span>) </span>&#123;<br>	order = fs.readFileSync(path, <span class="hljs-string">&quot;utf-8&quot;</span>);<br>	<span class="hljs-built_in">console</span>.log(<span class="hljs-string">&quot;同步读取&quot;</span>, <span class="hljs-built_in">JSON</span>.parse(order));<br>&#125;;<br>readOrderSync(<span class="hljs-string">&quot;./order.json&quot;</span>, orderSync);<br><br><span class="hljs-comment">// /* 添加数据 */</span><br><span class="hljs-keyword">let</span> appendOrder = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">path, appendObj</span>) </span>&#123;<br>	fs.readFile(path, <span class="hljs-function">(<span class="hljs-params">err, data</span>) =&gt;</span> &#123;<br>		<span class="hljs-keyword">if</span> (err) <span class="hljs-keyword">throw</span> err;<br>		<span class="hljs-keyword">var</span> order = <span class="hljs-built_in">JSON</span>.parse(data);<br>		order.push(appendObj);<br>		fs.writeFile(path, <span class="hljs-built_in">JSON</span>.stringify(order), <span class="hljs-string">&quot;utf-8&quot;</span>, <span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> &#123;<br>			<span class="hljs-keyword">if</span> (err) <span class="hljs-keyword">throw</span> err;<br>			<span class="hljs-built_in">console</span>.log(<span class="hljs-string">&quot;添加成功&quot;</span>);<br>		&#125;);<br>	&#125;);<br>&#125;;<br><span class="hljs-keyword">let</span> goods = &#123;<br>	gId: <span class="hljs-string">&quot;003&quot;</span>,<br>	goodName: <span class="hljs-string">&quot;矿泉水&quot;</span>,<br>	gPrice: <span class="hljs-number">2</span>,<br>&#125;;<br>appendOrder(<span class="hljs-string">&quot;./order.json&quot;</span>, goods);<br><br><span class="hljs-comment">/* 修改数据 */</span><br><span class="hljs-keyword">let</span> updataOrder = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">path, newObj</span>) </span>&#123;<br>	fs.readFile(path, <span class="hljs-string">&quot;utf-8&quot;</span>, <span class="hljs-function">(<span class="hljs-params">err, data</span>) =&gt;</span> &#123;<br>		<span class="hljs-keyword">let</span> order = <span class="hljs-built_in">JSON</span>.parse(data);<br>		order.forEach(<span class="hljs-function">(<span class="hljs-params">element, index, array</span>) =&gt;</span> &#123;<br>			<span class="hljs-keyword">if</span> (element.gId === newObj.gId) &#123;<br>				<span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> item <span class="hljs-keyword">in</span> newObj) &#123;<br>					<span class="hljs-keyword">if</span> (element[item]) &#123;<br>						element[item] = newObj[item];<br>						array.splice(index, <span class="hljs-number">1</span>, element);<br>					&#125;<br>				&#125;<br>			&#125;<br>		&#125;);<br>		<span class="hljs-built_in">console</span>.log(order);<br>		fs.writeFile(path, <span class="hljs-built_in">JSON</span>.stringify(order), <span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> &#123;<br>			<span class="hljs-keyword">if</span> (err) <span class="hljs-keyword">throw</span> err;<br>		&#125;);<br>	&#125;);<br>&#125;;<br><span class="hljs-keyword">var</span> updateGood = &#123;<br>	gId: <span class="hljs-string">&quot;001&quot;</span>,<br>	goodName: <span class="hljs-string">&quot;macBookPro&quot;</span>,<br>	gPrice: <span class="hljs-number">16666</span>,<br>&#125;;<br>updataOrder(<span class="hljs-string">&quot;./order.json&quot;</span>, updateGood);<br><br><span class="hljs-comment">/* 删除数据 */</span><br><span class="hljs-keyword">let</span> deleteOrder = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">path, id</span>) </span>&#123;<br>	fs.readFile(path, <span class="hljs-string">&quot;utf-8&quot;</span>, <span class="hljs-function">(<span class="hljs-params">err, data</span>) =&gt;</span> &#123;<br>		<span class="hljs-keyword">if</span> (err) <span class="hljs-keyword">throw</span> err;<br>		order = <span class="hljs-built_in">JSON</span>.parse(data);<br>		order.forEach(<span class="hljs-function">(<span class="hljs-params">element, index, array</span>) =&gt;</span> &#123;<br>			<span class="hljs-keyword">if</span> (element.gId === id) &#123;<br>				array.splice(index, <span class="hljs-number">1</span>);<br>			&#125;<br>		&#125;);<br>		<span class="hljs-built_in">console</span>.log(order);<br>		fs.writeFile(path, <span class="hljs-built_in">JSON</span>.stringify(order), <span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> &#123;<br>			<span class="hljs-keyword">if</span> (err) <span class="hljs-keyword">throw</span> err;<br>		&#125;);<br>	&#125;);<br>&#125;;<br><br>deleteOrder(<span class="hljs-string">&quot;./order.json&quot;</span>, <span class="hljs-string">&quot;001&quot;</span>);<br></code></pre></td></tr></table></figure>

<h4 id="XML文件转JSON文件"><a href="#XML文件转JSON文件" class="headerlink" title="XML文件转JSON文件"></a>XML文件转JSON文件</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 引入node的扩展模块xml2js来解析xml文件</span><br><span class="hljs-keyword">const</span> xml2js = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;xml2js&quot;</span>);<br><span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;fs&quot;</span>);<br><br><span class="hljs-comment">// 创建xml解析器</span><br><span class="hljs-keyword">var</span> xmlParser = <span class="hljs-keyword">new</span> xml2js.Parser();<br><br><span class="hljs-comment">//创建读取xml文件流</span><br><span class="hljs-keyword">var</span> readXml = fs.createReadStream(<span class="hljs-string">&quot;./data/city.xml&quot;</span>);<br><br><span class="hljs-comment">// 创建变量用来缓存读取的每行内容</span><br><span class="hljs-keyword">var</span> data = <span class="hljs-string">&quot;&quot;</span>;<br><br><span class="hljs-comment">// 读取数据</span><br>readXml.on(<span class="hljs-string">&quot;data&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">rs</span>) </span>&#123;<br>	data += rs;<br>	<span class="hljs-comment">// 将xml文本解析成JSON</span><br>	xmlParser.parseString(data, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err, result</span>) </span>&#123;<br>		<span class="hljs-keyword">if</span> (err) <span class="hljs-keyword">throw</span> err;<br>		<span class="hljs-keyword">var</span> result = <span class="hljs-built_in">JSON</span>.stringify(result);<br>		<span class="hljs-built_in">console</span>.log(result);<br><br>		<span class="hljs-comment">// 创建可写流</span><br>		<span class="hljs-keyword">var</span> writeXml = fs.createWriteStream(<span class="hljs-string">&quot;./data/city.json&quot;</span>);<br><br>		<span class="hljs-comment">// 将读出的xml文件内容转换成json格式的数据写入到city.json文件中</span><br>		writeXml.write(result, <span class="hljs-string">&quot;UTF8&quot;</span>);<br><br>		<span class="hljs-comment">// 写文件结束</span><br>		writeXml.end();<br>	&#125;);<br>&#125;);<br></code></pre></td></tr></table></figure>

<p>需要引入第三方库xml2js</p>
<h2 id="第五章-网络编程"><a href="#第五章-网络编程" class="headerlink" title="第五章 网络编程"></a>第五章 网络编程</h2><h3 id="5-1-http协议"><a href="#5-1-http协议" class="headerlink" title="5.1 http协议"></a>5.1 http协议</h3><h4 id="HTTP协议原理"><a href="#HTTP协议原理" class="headerlink" title="HTTP协议原理"></a>HTTP协议原理</h4><p>就像我们要用双方都能理解的语言才能进行沟  通和交流一样，网络上的各台计算机之间要互换信息，也要用一种双方都明白的、约定好的语言才能进行。</p>
<p>这种双方约定的沟通语言就称为网络协议。（网络协议三要素：语法、语义、时序）</p>
<p>HTTP协议：用于规范客户端浏览器和服务器端以什么样的格式进行通信数据交互，作为应用层的面向对象的协议，HTTP由请求和响应构成，是一个标准的客户端服务器模型，也是一个无状态的协议。</p>
<p><img src="https://gitee.com/zhangjialin_zhulan/myimagerepo/raw/master/images/image-20220310145219283.png" srcset="/img/loading.gif" lazyload alt="image-20220310145219283"></p>
<p>HTTP协议主要特点：</p>
<ul>
<li><p>简单快速</p>
<p>客户向服务器请求服务时，只需传送请求方法和路径。</p>
</li>
<li><p>无连接</p>
<p>限制每次连接只处理一个请求，采用这种方式可以节省传输时间。</p>
</li>
<li><p>灵活</p>
<p>HTTP允许传输任意类型的数据对象</p>
</li>
<li><p>无状态</p>
<p>无状态是指协议对于事务处理没有记忆能力</p>
</li>
<li><p>支持B/S以及C/S</p>
<p><img src="https://gitee.com/zhangjialin_zhulan/myimagerepo/raw/master/images/ZI3O]S6%%7D[]Y7L@[HMH%MFT.png" srcset="/img/loading.gif" lazyload alt="img"></p>
</li>
</ul>
<h4 id="请求报文"><a href="#请求报文" class="headerlink" title="请求报文"></a>请求报文</h4><p>组成：</p>
<ul>
<li><p>请求行</p>
<p>请求报文的起始行称为请求行。请求行由请求方法字段、URL 字段和 HTTP 协议版本字段组成，它们用空格分隔，例如：GET/index.html HTTP/1.1。</p>
</li>
<li><p>请求消息头</p>
<p>请求消息头，由关键字/值对组成，每行一对，关键字和值用英文冒号“:”分隔。请求头部通知服务器关于客户端请求的信息，典型的请求头有：</p>
<ul>
<li>User-Agent：产生请求的浏览器类型；</li>
</ul>
<ul>
<li><p> Accept：客户端可识别的响应内容类型列表，星号“*”用于按范围将类型分组，*/*”表示可接受全部类型，“type/*”表示可接受 type 类型的所有子类型</p>
</li>
<li><p>Accept-Language：客户端可接受的自然语言</p>
</li>
<li><p>Accept-Encoding：客户端可接受的编码压缩格式</p>
</li>
<li><p> Accept-Charset：可接受的应答字符集</p>
</li>
<li><p>Host：请求的主机名，允许多个域名同处一个 IP 地址，即虚拟主机</p>
</li>
<li><p>connection：连接方式（close 或 keepalive）</p>
</li>
<li><p> Cookie：存储于客户端的扩展字段，向同一域名的服务端发送属于该域的 cookie</p>
</li>
</ul>
</li>
<li><p>空行</p>
<p>最后一个请求头之后是一个空行，发送回车符和换行符，通知服务器以下不再有请求头。</p>
</li>
<li><p>请求行</p>
<p>请求体也称报文体，它的内容就是请求数据，承载多个请求参数的数据。它将一个页面表单中的组件值通过键值对形式编码成一个格式化串</p>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">let</span> http = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;http&quot;</span>);<br><br><span class="hljs-keyword">var</span> server = http.createServer();<br>server.on(<span class="hljs-string">&quot;request&quot;</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;<br>	<span class="hljs-built_in">console</span>.log(req.headers); <span class="hljs-comment">// 打印全部请求头信息--对象形式</span><br>	<span class="hljs-built_in">console</span>.log(req.rawHeaders); <span class="hljs-comment">// 全部头信息--数组形式</span><br>	<span class="hljs-built_in">console</span>.log(req.httpVersion); <span class="hljs-comment">// 请求的协议方式</span><br>	<span class="hljs-built_in">console</span>.log(req.method);<br>	<span class="hljs-built_in">console</span>.log(req.url);<br><br>	res.end();<br>&#125;);<br><br>server.listen(<span class="hljs-number">9000</span>, <span class="hljs-function">() =&gt;</span> &#123;<br>	<span class="hljs-built_in">console</span>.log(<span class="hljs-string">&quot;localhost://9000服务器已开启&quot;</span>);<br>&#125;);<br><br></code></pre></td></tr></table></figure>

<h4 id="响应报文"><a href="#响应报文" class="headerlink" title="响应报文"></a>响应报文</h4><p>组成；</p>
<ul>
<li><p>状态行</p>
<p>响应报文的起始行称为响应状态行。</p>
<p> 状态行由 HTTP 协议版本、一个表示成功或错误的整数代码（状态码）和对状态码进行描述的文本信息三部分组成，它们用空格分隔。例如： HTTP/1.1 200 OK。</p>
<p>状态代码由 3 位数字组成，表示请求是否被理解或被满足。</p>
<p>HTTP 响应状态码的第一个数字定义了响应的类别，后面两位没有具体的分类</p>
<p><img src="https://gitee.com/zhangjialin_zhulan/myimagerepo/raw/master/images/image-20220310151057865.png" srcset="/img/loading.gif" lazyload alt="image-20220310151057865"></p>
</li>
<li><p>响应消息头</p>
<p>状态行后紧接着的是若干响应消息头，服务器端通过响应消息头向客户端传递附加信息， 包括服务程序名、被请求资源需要的认证方式、客户端请求资源的最后修改时间、重定向地 址等信息。</p>
</li>
<li><p>空行</p>
<p>最后一个响应头之后是一个空行，发送回车符和换行符，通知服务器以下不再有响应头。</p>
</li>
<li><p>响应体</p>
<p>内容就是响应数据，包括服务器返回给客户端的文本信息。</p>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">let</span> http = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;http&quot;</span>);<br><br><span class="hljs-keyword">var</span> server = http.createServer();<br>server.on(<span class="hljs-string">&quot;request&quot;</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;<br>	res.statusCode = <span class="hljs-number">404</span>;<br>	res.statusmessage = <span class="hljs-string">&quot;Not found&quot;</span>;<br><br>	res.setHeader(<span class="hljs-string">&quot;Content-type&quot;</span>, <span class="hljs-string">&quot;text/plain;charset=utf-8&quot;</span>);<br><br>	<span class="hljs-comment">/* </span><br><span class="hljs-comment">        参数1：必选，三位数的http状态码</span><br><span class="hljs-comment">        参数2：可选，可有可无</span><br><span class="hljs-comment">        参数3：可选，告诉浏览器我发给你的数据是什么类型的</span><br><span class="hljs-comment">        res.writeHead(200, &#123; &#x27;Content-type&#x27;: &#x27;text/html;charset=utf-8&#x27; &#125;)</span><br><span class="hljs-comment">    */</span><br>	res.writeHead(<span class="hljs-number">404</span>, <span class="hljs-string">&quot;not found&quot;</span>, &#123;<br>		<span class="hljs-string">&quot;Content-Type&quot;</span>: <span class="hljs-string">&quot;text/plain;charset=utf-8&quot;</span>,<br>	&#125;);<br><br>	<span class="hljs-comment">/* 1.写内容 */</span><br>	res.write(<span class="hljs-string">&quot;向前端发送的内容！&quot;</span>);<br><br>	<span class="hljs-comment">// 2.每个请求都必须要调用的一个方法res.end();</span><br>	<span class="hljs-comment">// 结束响应（请求）</span><br>	<span class="hljs-comment">// 告诉服务器该响应的报文头、报文体等等全部已经响应完毕了，可以考虑本次响应结束。</span><br>	<span class="hljs-comment">// res.end() 要响应数据的话，数据必须是 String 类型或者是 Buffer 类型</span><br>	res.end();<br><br>	<span class="hljs-comment">/* 3.设置http响应状态码（放在响应信息最前面） */</span><br>	<span class="hljs-comment">// res.status.message = &quot;OK&quot;;</span><br>	<span class="hljs-comment">// res.statusCode = 200;</span><br><br>	<span class="hljs-comment">// 4.通过res.setHeader()来设置响应报文头</span><br>	<span class="hljs-comment">// res.setHeader()要放在res.write()和res.end()之前设置</span><br>	<span class="hljs-comment">// 因为即使我们不设置响应报文头，系统也会默认有响应报文头，并且默认发送给浏览器，当已经发送过响应报文头后，就不能再通过res.setHeader()来再次设置响应报文头了，否则就会报错</span><br>	<span class="hljs-comment">// res.setHeader(&quot;Content-Type&quot;, &quot;text/plain;charset=utf-8&quot;);</span><br><br>	<span class="hljs-comment">// 5.writeHeader书写响应头(包括响应状态码和设置头内容)</span><br>	<span class="hljs-comment">// res.writeHead(404, &quot;not found&quot;, &#123;</span><br>	<span class="hljs-comment">// 	&quot;Content-Type&quot;: &quot;text/palin;charset=utf-8&quot;,</span><br>	<span class="hljs-comment">// &#125;);</span><br>&#125;);<br><br>server.listen(<span class="hljs-number">9000</span>, <span class="hljs-function">() =&gt;</span> &#123;<br>	<span class="hljs-built_in">console</span>.log(<span class="hljs-string">&quot;localhost://9000 服务器已开启&quot;</span>);<br>&#125;);<br></code></pre></td></tr></table></figure>

<h3 id="5-2-http模块"><a href="#5-2-http模块" class="headerlink" title="5.2 http模块"></a>5.2 http模块</h3><h4 id="Http模块介绍"><a href="#Http模块介绍" class="headerlink" title="Http模块介绍"></a>Http模块介绍</h4><p>Http模块是Node.js的核心模块，用于创建Http服务器，实现服务器与web服务器之间的请求与响应。</p>
<p>引入：<code>let http = require(&#39;http&#39;);</code></p>
<h4 id="Http服务端"><a href="#Http服务端" class="headerlink" title="Http服务端"></a>Http服务端</h4><ul>
<li><p><code>http.createServer([options][, requestListener])</code>：创建Http Web服务器</p>
<p>方法有多个可选参数，但一般只接收一个可选传入参数<code>requestListener</code></p>
<p>返回：新创建的http服务器实例</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> http = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;http&quot;</span>);<br><br>http<br>	.createServer(<span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;<br>		res.writeHead(<span class="hljs-number">200</span>, &#123;<br>			<span class="hljs-string">&quot;content-type&quot;</span>: <span class="hljs-string">&quot;text/plain&quot;</span>,<br>		&#125;);<br>		res.write(<span class="hljs-string">&quot;hello zjl!&quot;</span>);<br>		res.end();<br>	&#125;)<br>	.listen(<span class="hljs-number">9000</span>, <span class="hljs-function">() =&gt;</span> &#123;<br>		<span class="hljs-built_in">console</span>.log(<span class="hljs-string">&quot;9000端口服务启动&quot;</span>);<br>	&#125;);<br><br></code></pre></td></tr></table></figure>
</li>
<li><p><code>server.listen([port[, host[, backlog]][, callback]);</code></p>
<p>用来启动一个服务监听连接端口信息</p>
<p>调用server.listen()后http.Server就可以接收客户端传入连接</p>
</li>
<li><p><code>http.Server</code>：服务器实例对象</p>
</li>
<li><p><code>http.ServerResponse</code>：该对象用于响应处理客户端请求</p>
</li>
<li><p><code>http.ServerResponse</code>：此对象由Http服务器内部创建，作为第二个参数传给<code>request</code>事件，内部存在多种方法。</p>
<ul>
<li><code>response.writeHead()</code>：用于向请求发送响应头。</li>
<li><code>response.setHeader</code>为隐式响应头设置单个响应头的值。</li>
<li><code>responose.write()</code>：该方法用于发送一块响应主体，可以多次调用该方法以提供连续的响应主体片段。</li>
<li><code>response.end()</code>：用于向服务器发送信号，表明已发送所有响应头和主体，该服务器应该视为此消息完成。</li>
<li><code>message.headers</code>：请求或响应的消息头对象。</li>
<li><code>message.rawheaders</code>：原始请求头 / 响应头的列表数据。</li>
</ul>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">let</span> http = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;http&quot;</span>);<br><br><span class="hljs-keyword">let</span> server = <span class="hljs-keyword">new</span> http.Server();<br>server.on(<span class="hljs-string">&quot;request&quot;</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;<br>	res.writeHeader(<span class="hljs-number">200</span>, &#123;<br>		<span class="hljs-string">&quot;content-type&quot;</span>: <span class="hljs-string">&quot;text/plain;charset=utf-8&quot;</span>,<br>	&#125;);<br><br>	res.write(<span class="hljs-string">&quot;接收服务器返回的服务&quot;</span>, <span class="hljs-string">&quot;&quot;</span>);<br><br>	res.end();<br>&#125;);<br>server.listen(<span class="hljs-number">9999</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;<br>	<span class="hljs-built_in">console</span>.log(<span class="hljs-string">&quot;服务器启动&quot;</span>);<br>&#125;);<br></code></pre></td></tr></table></figure>

<h4 id="Http客户端"><a href="#Http客户端" class="headerlink" title="Http客户端"></a>Http客户端</h4><ul>
<li><p><code>http.request(options[, callback])</code>：创建Http请求</p>
<p>http客户端由http.request()方法实现，执行该方法会在内部自返回一个http.ClientRequest类对象</p>
<p>options参数：</p>
<ul>
<li>host：请求发送至服务器域名 / ip地址，默认值为<code>localhost</code></li>
<li>method：指定http请求的方法，默认值为GET</li>
<li>path：请求路径，默认为80</li>
<li>port：远程服务器的端口，默认值为http</li>
<li>protocol</li>
</ul>
<p>callback：Node.js为每个服务器维护多个连接以发出http请求，此函数允许显式地发送请求，可选地callback参数会作为单次监听器被添加到response事件。</p>
</li>
<li><p><code>http.ClientRequest</code></p>
<p>由http.request()创建并返回，它是一个正在处理的HTTP请求。</p>
</li>
</ul>
<p>案例</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">let</span> http = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;http&quot;</span>);<br><br><span class="hljs-keyword">let</span> options = &#123;<br>	hostname: <span class="hljs-string">&quot;miketaylorjuly123.cn&quot;</span>,<br>	port: <span class="hljs-number">80</span>,<br>	methods: <span class="hljs-string">&quot;GET&quot;</span>,<br>	path: <span class="hljs-string">&quot;/&quot;</span>,<br>&#125;;<br><br><span class="hljs-keyword">var</span> req = http.request(options, <span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> &#123;<br>	<span class="hljs-built_in">console</span>.log(res.statusCode);<br>	<span class="hljs-built_in">console</span>.log(<span class="hljs-built_in">JSON</span>.stringify(res.headers));<br>	res.setEncoding(<span class="hljs-string">&quot;utf-8&quot;</span>);<br>	res.on(<span class="hljs-string">&quot;data&quot;</span>, <span class="hljs-function">(<span class="hljs-params">chunk</span>) =&gt;</span> &#123;<br>		<span class="hljs-comment">// 监听data事件，如果有数据，将执行回调函数</span><br>		<span class="hljs-built_in">console</span>.log(chunk);<br>	&#125;);<br>&#125;);<br>req.end();<br><br></code></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">/*</span><br><span class="hljs-comment">	通过使用http模块的方法直接请求</span><br><span class="hljs-comment">*/</span><br><span class="hljs-keyword">let</span> http = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;http&quot;</span>);<br><br><span class="hljs-keyword">let</span> options = &#123;<br>	host: <span class="hljs-string">&quot;miketaylorjuly123.cn&quot;</span>,<br>&#125;;<br>http.get(options, <span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> &#123;<br>	<span class="hljs-built_in">console</span>.log(res.statusCode);<br>	<span class="hljs-built_in">console</span>.log(<span class="hljs-built_in">JSON</span>.stringify(res.headers));<br>	res.on(<span class="hljs-string">&quot;data&quot;</span>, <span class="hljs-function">(<span class="hljs-params">chunk</span>) =&gt;</span> &#123;<br>		<span class="hljs-built_in">console</span>.log(chunk.toString(<span class="hljs-string">&quot;utf-8&quot;</span>));<br>	&#125;);<br>&#125;);<br></code></pre></td></tr></table></figure>

<h3 id="5-3-path模块和url模块"><a href="#5-3-path模块和url模块" class="headerlink" title="5.3 path模块和url模块"></a>5.3 path模块和url模块</h3><h4 id="path模块"><a href="#path模块" class="headerlink" title="path模块"></a>path模块</h4><p>为什么要使用path模块？</p>
<p>针对多文件和路径问题，需要使用path模块中一系列处理和转换文件路径的工具集。</p>
<p>引入：<code>var path = require(&#39;path&#39;);</code></p>
<p>path模块主要方法：</p>
<ul>
<li><p><code>path.dirname(path)</code></p>
<p>用于获取文件目录</p>
</li>
<li><p><code>path.normalize(path)</code></p>
<p>用于规范化给定的path，处理冗余的<code>..</code>、<code>.</code>、<code>/</code>字符</p>
</li>
<li><p><code>path.resolve([from...], to)</code></p>
<p>用于将to参数解析为绝对路径，给定的路径序列会从右到左进行处理，后面的每个path会被追加到前面，直到构造出绝对路径。</p>
<p>处理完所有给定的 path 片段之后还未生成绝对路径，就把当前工作目录追加到前面构成绝对路径。</p>
</li>
<li><p><code>path.basename(path[, ext])</code></p>
<p>用于获取路径的最后一个部分，即文件名，参数ext为需要截掉的后缀内容。</p>
</li>
<li><p><code>path.join()</code></p>
<p>用于将所有给定的path片段连接到一起，然后规范化生成的路径</p>
</li>
<li><p><code>path.parse()</code></p>
<p>用于将path字符串转为path对象，其属性表示path的有效元素。</p>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">let</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;path&quot;</span>);<br><br><span class="hljs-comment">/* path.dirname */</span><br><span class="hljs-built_in">console</span>.log(__filename); <span class="hljs-comment">// F:\全栈项目\node\nodeMooc\5.3path和url模块\path.js</span><br><span class="hljs-built_in">console</span>.log(path.dirname(__filename)); <span class="hljs-comment">// F:\全栈项目\node\nodeMooc\5.3path和url模块</span><br><span class="hljs-built_in">console</span>.log(__dirname); <span class="hljs-comment">// F:\全栈项目\node\nodeMooc\5.3path和url模块</span><br><span class="hljs-built_in">console</span>.log(path.dirname(__dirname)); <span class="hljs-comment">// F:\全栈项目\node\nodeMooc\5.3path和url模块</span><br><br><span class="hljs-comment">/* path.normalize() */</span><br><span class="hljs-keyword">let</span> myPath = path.normalize(<span class="hljs-string">&quot;/foo/bar//baz/aa/bb/..&quot;</span>);<br><span class="hljs-built_in">console</span>.log(myPath); <span class="hljs-comment">// \foo\bar\baz\aa</span><br><br><span class="hljs-comment">/* path.join() */</span><br><span class="hljs-keyword">let</span> path1 = <span class="hljs-string">&quot;path1&quot;</span>,<br>	path2 = <span class="hljs-string">&quot;path2/pp&quot;</span>,<br>	path3 = <span class="hljs-string">&quot;path3&quot;</span>;<br><span class="hljs-built_in">console</span>.log(path.join(path1, path2, path3)); <span class="hljs-comment">// path1\path2\pp\path3</span><br><br><span class="hljs-comment">/* path.resolve() */</span><br><span class="hljs-built_in">console</span>.log(path.resolve(<span class="hljs-string">&quot;path1&quot;</span>, <span class="hljs-string">&quot;path2&quot;</span>, <span class="hljs-string">&quot;a/b\\c/&quot;</span>)); <span class="hljs-comment">// F:\全栈项目\node\nodeMooc\5.3path和url模块\path1\path2\a\b\c</span><br><span class="hljs-built_in">console</span>.log(path.resolve(<span class="hljs-string">&quot;/path1&quot;</span>, <span class="hljs-string">&quot;path2&quot;</span>, <span class="hljs-string">&quot;a/b\\c/&quot;</span>)); <span class="hljs-comment">// F:\path1\path2\a\b\c</span><br><br><span class="hljs-comment">/* path.basename() */</span><br><span class="hljs-built_in">console</span>.log(path.basename(__filename)); <span class="hljs-comment">// path.js</span><br><span class="hljs-built_in">console</span>.log(path.basename(__filename, <span class="hljs-string">&quot;.js&quot;</span>)); <span class="hljs-comment">// path</span><br><br><span class="hljs-comment">/* path.parse() */</span><br><span class="hljs-built_in">console</span>.log(<br>	path.parse(<span class="hljs-string">&quot;/Users/laihuamin/Documents/richEditor/editor/src/task.js&quot;</span>)<br>);<br><span class="hljs-comment">/* </span><br><span class="hljs-comment">&#123;</span><br><span class="hljs-comment">  root: &#x27;/&#x27;,</span><br><span class="hljs-comment">  dir: &#x27;/Users/laihuamin/Documents/richEditor/editor/src&#x27;,</span><br><span class="hljs-comment">  base: &#x27;task.js&#x27;,</span><br><span class="hljs-comment">  ext: &#x27;.js&#x27;,</span><br><span class="hljs-comment">  name: &#x27;task&#x27;</span><br><span class="hljs-comment">&#125;</span><br><span class="hljs-comment">*/</span><br></code></pre></td></tr></table></figure>

<h4 id="url模块"><a href="#url模块" class="headerlink" title="url模块"></a>url模块</h4><p>为什么要使用url模块？</p>
<p>在实际运用中，经常涉及到需要从完整url请求路径中提取各个属性及其值得问题，<code>Node.js</code>的url模块为解决这类问题提供了相应的方法。</p>
<p>url引入：<code>var url = require(&#39;url&#39;);</code></p>
<p>主要方法：</p>
<ul>
<li><p><code>url.parse(urlString[, parseQuery[, slashesDenoteHost]])</code></p>
<p>把字符串形式的url转成对象形式的url</p>
<p>返回：url对象</p>
<ul>
<li><code>urlString</code>：需要解析的url字符串</li>
<li><code>parseQueryString</code>：为true时将使用查询寻模块分析查询字符串，默认为false</li>
</ul>
</li>
<li><p><code>url.format(urlObject)</code></p>
<p>把JSON对象形式的url格式化成字符串形式的url</p>
<p>format()方法的作用与parse方法相反，它的参数是一个JSON对象，返回一个组装好的url地址。</p>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">let</span> url = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;url&quot;</span>);<br><br><span class="hljs-comment">/* url.parse() */</span><br><span class="hljs-keyword">var</span> mywebsite = <span class="hljs-string">&quot;https://miketaylorjuly123.cn/2021/07/26/SDC/&quot;</span>;<br><span class="hljs-built_in">console</span>.log(url.parse(mywebsite)); <span class="hljs-comment">// 安全问题，已弃用</span><br><br><span class="hljs-comment">/* new URL() */</span><br><span class="hljs-built_in">console</span>.log(<span class="hljs-keyword">new</span> URL(<span class="hljs-string">&quot;https://miketaylorjuly123.cn/2021/07/26/SDC/&quot;</span>)); <span class="hljs-comment">// 更加安全</span><br><br><span class="hljs-comment">/* url.format() */</span><br><span class="hljs-keyword">var</span> testObj1 = &#123;<br>	protocol: <span class="hljs-string">&quot;https:&quot;</span>,<br>	slashes: <span class="hljs-literal">true</span>,<br>	auth: <span class="hljs-literal">null</span>,<br>	host: <span class="hljs-string">&quot;www.ptpress.com.cn&quot;</span>,<br>	port: <span class="hljs-literal">null</span>,<br>	hostname: <span class="hljs-string">&quot;www.ptpress.com.cn&quot;</span>,<br>	hash: <span class="hljs-literal">null</span>,<br>	search: <span class="hljs-string">&quot;?bookId=5e6fe0f3-6ee7-40c2-8c25-9cdf9b0c87e6&quot;</span>,<br>	query: <span class="hljs-string">&quot;bookId=5e6fe0f3-6ee7-40c2-8c25-9cdf9b0c87e6&quot;</span>,<br>	pathname: <span class="hljs-string">&quot;/shopping/buy&quot;</span>,<br>	path: <span class="hljs-string">&quot;/shopping/buy?bookId=5e6fe0f3-6ee7-40c2-8c25-9cdf9b0c87e6&quot;</span>,<br>	href: <span class="hljs-string">&quot;https://www.ptpress.com.cn/shopping/buy?bookId=5e6fe0f3-6ee7-40c2-8c25-9cdf9b0c87e6&quot;</span>,<br>&#125;;<br><span class="hljs-built_in">console</span>.log(url.format(testObj1));<br><br></code></pre></td></tr></table></figure>

<h3 id="5-4-前后端交互显示省份信息"><a href="#5-4-前后端交互显示省份信息" class="headerlink" title="5.4 前后端交互显示省份信息"></a>5.4 前后端交互显示省份信息</h3><p><code>server.js</code>：一定设置数据编码！</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">let</span> http = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;http&quot;</span>);<br><span class="hljs-keyword">let</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;fs&quot;</span>);<br><br>http<br>	.createServer(<span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;<br>		<span class="hljs-built_in">console</span>.log(<span class="hljs-string">&quot;收到请求&quot;</span>);<br>		fs.readFile(<span class="hljs-string">&quot;./city.json&quot;</span>, <span class="hljs-string">&quot;utf-8&quot;</span>, <span class="hljs-function">(<span class="hljs-params">err, data</span>) =&gt;</span> &#123;<br>			<span class="hljs-keyword">if</span> (err) <span class="hljs-keyword">throw</span> err;<br>			res.setHeader(<span class="hljs-string">&quot;Access-Control-Allow-Origin&quot;</span>, <span class="hljs-string">&quot;*&quot;</span>); <span class="hljs-comment">// *表示所有IP都能访问到</span><br>			res.setHeader(<span class="hljs-string">&quot;Access-Control-Allow-Headers&quot;</span>, <span class="hljs-string">&quot;X-Requested-With&quot;</span>);<br>			res.setHeader(<br>				<span class="hljs-string">&quot;Access-Control-Allow-Methods&quot;</span>,<br>				<span class="hljs-string">&quot;PUT,POST,GET,DELETE,OPTIONS&quot;</span><br>			);<br>			res.setHeader(<span class="hljs-string">&quot;Content-Type&quot;</span>, <span class="hljs-string">&quot;text/plain;charset=utf-8&quot;</span>);<br>			res.write(data);<br>			res.end();<br>		&#125;);<br>	&#125;)<br>	.listen(<span class="hljs-number">9000</span>, <span class="hljs-function">() =&gt;</span> &#123;<br>		<span class="hljs-built_in">console</span>.log(<span class="hljs-string">&quot;服务启动在9000端口上&quot;</span>);<br>	&#125;);<br></code></pre></td></tr></table></figure>

<p><code>main.html</code>：使用原生ajax发送请求</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">&quot;X-UA-Compatible&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;IE=edge&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;viewport&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Document<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>省份<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">ul</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;data&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>城市<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">ul</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;data&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><br><span class="javascript">        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">show</span>(<span class="hljs-params">data, position</span>) </span>&#123;</span><br><span class="javascript">            data.forEach(<span class="hljs-function">(<span class="hljs-params">element, index, array</span>) =&gt;</span> &#123;</span><br><span class="javascript">                <span class="hljs-built_in">console</span>.log(element);</span><br><span class="javascript">                <span class="hljs-keyword">const</span> content = element[<span class="hljs-string">&quot;$&quot;</span>];</span><br><span class="javascript">                <span class="hljs-built_in">console</span>.log(content);</span><br><span class="javascript">                <span class="hljs-keyword">let</span> ul = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">&#x27;ul&#x27;</span>);</span><br><span class="javascript">                <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> item <span class="hljs-keyword">in</span> content) &#123;</span><br><span class="javascript">                    <span class="hljs-keyword">let</span> li = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">&#x27;li&#x27;</span>);</span><br>                    li.innerHTML = item + content[item];<br>                    ul.appendChild(li)<br>                &#125;<br>                position.appendChild(ul);<br>            &#125;)<br>        &#125;<br><br><span class="javascript">        <span class="hljs-keyword">let</span> xhr = <span class="hljs-keyword">new</span> XMLHttpRequest();</span><br><span class="javascript">        xhr.open(<span class="hljs-string">&#x27;get&#x27;</span>, <span class="hljs-string">&#x27;http://127.0.0.1:9000&#x27;</span>);</span><br>        xhr.send();<br><span class="javascript">        xhr.onreadystatechange = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;</span><br>            if (xhr.readyState === 4 &amp;&amp; xhr.status === 200 || xhr.status === 304) &#123;<br><span class="javascript">                <span class="hljs-keyword">let</span> data = <span class="hljs-built_in">JSON</span>.parse(xhr.responseText);</span><br><span class="javascript">                <span class="hljs-keyword">let</span> proviceUl = <span class="hljs-built_in">document</span>.getElementsByClassName(<span class="hljs-string">&#x27;data&#x27;</span>)[<span class="hljs-number">0</span>];</span><br><span class="javascript">                <span class="hljs-keyword">let</span> cityUl = <span class="hljs-built_in">document</span>.getElementsByClassName(<span class="hljs-string">&#x27;data&#x27;</span>)[<span class="hljs-number">1</span>];</span><br><span class="javascript">                <span class="hljs-keyword">let</span> provinceSet = data.locality.provinces[<span class="hljs-number">0</span>].province;</span><br><span class="javascript">                <span class="hljs-keyword">let</span> citySet = data.locality.cities[<span class="hljs-number">0</span>].city;</span><br>                show(citySet, cityUl);<br>                show(provinceSet, proviceUl);<br><br><br>            &#125;<br>        &#125;<br>    <span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure>

<h3 id="5-5-使用openssl加密搭建https服务"><a href="#5-5-使用openssl加密搭建https服务" class="headerlink" title="5.5 使用openssl加密搭建https服务"></a>5.5 使用openssl加密搭建https服务</h3><h4 id="OpenSSL"><a href="#OpenSSL" class="headerlink" title="OpenSSL"></a>OpenSSL</h4><ul>
<li><p>开源软件包，应用程序可以使用该包进行安全通信，避免窃听，同时确认另一端的身份，该包广泛应用于互联网的网页服务器上。</p>
</li>
<li><p>ssl：安全套接层的缩写，可以在Internet上提供秘密性传输。</p>
<p>SSL能使用户/服务器应用之间的通信不被攻击者窃听，并且始终对服务器进行认证，还可选择对用户进行认证。SSL协议要求建立在可靠的传输层协议(TCP)之上。SSL协议的优势在于它是与应用层协议独立无关的，高层的应用层协议(例如：HTTP，FTP，TELNET等)能透明地建立于SSL协议之上。SSL协议在应用层协议通信之前就已经完成加密算法、通信密钥的协商及服务器认证工作。在此之后应用层协议所传送的数据都会被加密，从而保证通信的私密性。</p>
</li>
<li><p>特点：</p>
<ul>
<li><p>数据保密性</p>
<p>信息加密就是把明码的输入文件用加密算法转换成加密的文件以实现数据的保密。加密的过程需要用到密钥来加密数据然后再解密。没有了密钥，就无法解开加密的数据。数据加密之后，只有密钥要用一个安全的方法传送。加密过的数据可以公开地传送。</p>
</li>
<li><p>数据完整性</p>
<p>加密也能保证数据的一致性。例如：消息验证码（MAC），能够校验用户提供的加密信息，接收者可以用MAC来校验加密数据，保证数据在传输过程中没有被篡改过。</p>
</li>
<li><p>安全验证</p>
<p>加密的另外一个用途是用来作为个人的标识，用户的密钥可以作为他的安全验证的标识。SSL是利用公开密钥的加密技术（RSA）来作为用户端与服务器端在传送机密资料时的加密通讯协定。</p>
</li>
</ul>
</li>
<li><p>基本功能</p>
<p>OpenSSL整个软件包大概可以分成三个主要的功能部分：SSL协议库、应用程序以及密码算法库。OpenSSL的目录结构自然也是围绕这三个功能部分进行规划的。<br>作为一个基于密码学的安全开发包，OpenSSL提供的功能相当强大和全面，囊括了主要的密码算法、常用的密钥和证书封装管理功能以及SSL协议，并提供了丰富的应用程序供测试或其它目的使用。</p>
</li>
</ul>
<h4 id="实验步骤"><a href="#实验步骤" class="headerlink" title="实验步骤"></a>实验步骤</h4><ul>
<li><p>下载安装OpenSSL</p>
</li>
<li><p>使用openssl生成密钥</p>
<ul>
<li><p>进入项目文件夹</p>
</li>
<li><p>运行</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">openssl genrsa -out privatekey.pem 1024<br></code></pre></td></tr></table></figure>

<p><img src="https://gitee.com/zhangjialin_zhulan/myimagerepo/raw/master/images/image-20220310231016437.png" srcset="/img/loading.gif" lazyload></p>
</li>
<li><p>运行</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">openssl req -new -key privatekey.pem -out certrequest.csr<br></code></pre></td></tr></table></figure>

<p><img src="https://gitee.com/zhangjialin_zhulan/myimagerepo/raw/master/images/image-20220310233133400.png" srcset="/img/loading.gif" lazyload alt="image-20220310233133400"></p>
</li>
<li><p>运行</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">openssl x509 -req -in certrequest.csr -signkey privatekey.pem -out certificate.pem<br></code></pre></td></tr></table></figure>

<img src="https://gitee.com/zhangjialin_zhulan/myimagerepo/raw/master/images/image-20220310233217443.png" srcset="/img/loading.gif" lazyload alt="image-20220310233217443" style="zoom:67%;" />
</li>
<li><p>准备数据<code>product.json</code></p>
</li>
<li><p>配置https</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">let</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;fs&quot;</span>);<br><span class="hljs-keyword">let</span> http = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;http&quot;</span>);<br><span class="hljs-keyword">let</span> https = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;https&quot;</span>);<br><span class="hljs-keyword">let</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;path&quot;</span>);<br><br><span class="hljs-comment">/* 读取ssl密钥 */</span><br><span class="hljs-keyword">let</span> privateKey = fs.readFileSync(<span class="hljs-string">&quot;./key/privatekey.pem&quot;</span>, <span class="hljs-string">&quot;utf8&quot;</span>); <span class="hljs-comment">// 路径+编码</span><br><span class="hljs-keyword">let</span> certificate = fs.readFileSync(<span class="hljs-string">&quot;./key/certificate.pem&quot;</span>, <span class="hljs-string">&quot;utf8&quot;</span>);<br><span class="hljs-keyword">let</span> credential = &#123;<br>	key: privateKey,<br>	cert: certificate,<br>&#125;;<br><br><span class="hljs-comment">/* 创建http服务器 */</span><br><span class="hljs-keyword">let</span> httpServer = http.createServer();<br><span class="hljs-comment">/* 创建https服务器 */</span><br><span class="hljs-keyword">let</span> httpsServer = https.createServer(credential);<br><span class="hljs-keyword">let</span> Port = <span class="hljs-number">81</span>;<br><span class="hljs-keyword">let</span> sslPort = <span class="hljs-number">443</span>;<br><br><span class="hljs-comment">// 文件读取</span><br><span class="hljs-keyword">let</span> data = fs.readFileSync(<span class="hljs-string">&quot;./product.json&quot;</span>, <span class="hljs-string">&quot;utf-8&quot;</span>);<br><br><span class="hljs-comment">/* 处理http / https请求 */</span><br>httpServer<br>	.on(<span class="hljs-string">&quot;request&quot;</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;<br>		res.setHeader(<span class="hljs-string">&quot;Content-type&quot;</span>, <span class="hljs-string">&quot;text/plain;charset=utf-8&quot;</span>);<br>		res.end(data);<br>	&#125;)<br>	.listen(Port, <span class="hljs-function">() =&gt;</span> &#123;<br>		<span class="hljs-built_in">console</span>.log(<span class="hljs-string">&quot;Http Server is running on http://localhost:%s&quot;</span>, Port);<br>	&#125;);<br><br>httpsServer<br>	.on(<span class="hljs-string">&quot;request&quot;</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;<br>		res.setHeader(<span class="hljs-string">&quot;Content-Type&quot;</span>, <span class="hljs-string">&quot;text/plain;charset=utf-8&quot;</span>);<br>		res.end(data);<br>	&#125;)<br>	.listen(sslPort, <span class="hljs-function">() =&gt;</span> &#123;<br>		<span class="hljs-built_in">console</span>.log(<span class="hljs-string">&quot;Https Server is running on https://localhost:%s&quot;</span>, sslPort);<br>	&#125;);<br></code></pre></td></tr></table></figure>


</li>
</ul>
</li>
</ul>
<h2 id="第六章-express开发基础"><a href="#第六章-express开发基础" class="headerlink" title="第六章 express开发基础"></a>第六章 express开发基础</h2><h3 id="6-1Express简介与安装"><a href="#6-1Express简介与安装" class="headerlink" title="6.1Express简介与安装"></a>6.1Express简介与安装</h3><h4 id="Express简介"><a href="#Express简介" class="headerlink" title="Express简介"></a>Express简介</h4><p>Express框架：基于Node.js平台，快速、开放、极简的Web开发框架。</p>
<p><img src="https://gitee.com/zhangjialin_zhulan/myimagerepo/raw/master/images/image-20220311091047610.png" srcset="/img/loading.gif" lazyload></p>
<h4 id="Express安装"><a href="#Express安装" class="headerlink" title="Express安装"></a>Express安装</h4><ul>
<li><p>局部安装</p>
<ul>
<li><p>创建项目路径</p>
</li>
<li><p>使用<code>npm init</code>生成<code>package.json</code>文件：定义了项目开发者、版本、脚本信息</p>
</li>
<li><p>安装express</p>
<p><code>npm install express --save</code></p>
<p><code>-S / --save</code>：表示保存到<code>package.json</code>文件的依赖列表中</p>
<p><code>npm install</code> 就会把package.json这个配置文件里面所有的依赖项，包括-D，-S安装的（这都是我们的依赖项），它都会自动的把所有的依赖项原封不动的安装好</p>
</li>
<li><p>测试运行</p>
<p><code>app.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">let</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;express&quot;</span>);<br><br><span class="hljs-keyword">let</span> app = express();<br>app<br>	.get(<span class="hljs-string">&quot;/&quot;</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;<br>		res.set(&#123; <span class="hljs-string">&quot;content-type&quot;</span>: <span class="hljs-string">&quot;application/json; charset=utf-8&quot;</span> &#125;); <span class="hljs-comment">// 设置字符集</span><br>		res.end(<span class="hljs-string">&quot;起飞！&quot;</span>);<br>	&#125;)<br>	.listen(<span class="hljs-number">3000</span>);<br></code></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>全局安装</p>
<ul>
<li><p>全局安装<code>npm install express -g</code></p>
</li>
<li><p>全局安装express生成器express-generator</p>
<p><code>npm install express-generator -g</code></p>
</li>
<li><p>查看express版本</p>
<p><code>express --version</code></p>
</li>
</ul>
</li>
</ul>
<h4 id="搭建框架项目"><a href="#搭建框架项目" class="headerlink" title="搭建框架项目"></a>搭建框架项目</h4><p><img src="https://gitee.com/zhangjialin_zhulan/myimagerepo/raw/master/images/image-20220311094456188.png" srcset="/img/loading.gif" lazyload alt="image-20220311094456188"></p>
<p>使用express生成项目</p>
<ul>
<li><code>express 文件夹名称</code></li>
</ul>
<p>​        <img src="https://gitee.com/zhangjialin_zhulan/myimagerepo/raw/master/images/image-20220311093053923.png" srcset="/img/loading.gif" lazyload alt="image-20220311093053923" style="zoom:80%;" /></p>
<ul>
<li>进入 目录</li>
<li>安装所有依赖<code>npm install</code></li>
<li><code>npm start</code>启动项目，具体可以看<code>package.json</code>中的script配置</li>
</ul>
<h3 id="6-2路由配置"><a href="#6-2路由配置" class="headerlink" title="6.2路由配置"></a>6.2路由配置</h3><h4 id="路由介绍"><a href="#路由介绍" class="headerlink" title="路由介绍"></a>路由介绍</h4><p>路由</p>
<ul>
<li><p>Express框架最重要的功能之一</p>
</li>
<li><p>如何根据用户请求的路径和Http请求方法处理请求</p>
<p><img src="https://gitee.com/zhangjialin_zhulan/myimagerepo/raw/master/images/image-20220311100022084.png" srcset="/img/loading.gif" lazyload alt="image-20220311100022084"></p>
</li>
</ul>
<h4 id="app级别路由定义"><a href="#app级别路由定义" class="headerlink" title="app级别路由定义"></a>app级别路由定义</h4><p><code>app.method(path, handler)</code></p>
<ul>
<li>app：express应用实例</li>
<li>method：http请求方法，支持get、post、put、delete等所有http请求方法，注意使用小写</li>
<li>path：请求路径</li>
<li>handler：路径匹配的时候执行的函数</li>
</ul>
<p>例：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">let</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;express&#x27;</span>);<br><br><span class="hljs-keyword">let</span> app = express();<br>app.get(<span class="hljs-string">&#x27;/&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>)=&gt;</span>&#123;<br>   res.send(<span class="hljs-string">&#x27;home page&#x27;</span>);<br>&#125;);<br></code></pre></td></tr></table></figure>

<p>分类：</p>
<ul>
<li><p>基于字符串的路由路径：创建字符串形式路由路径匹配的app路由</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">let</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;express&#x27;</span>);<br><br><span class="hljs-keyword">let</span> app = express();<br>app.get(<span class="hljs-string">&#x27;/about&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>)=&gt;</span>&#123;<br>   res.send(<span class="hljs-string">&#x27;about&#x27;</span>);<br>&#125;);<br></code></pre></td></tr></table></figure>
</li>
<li><p>基于字符串模板的路由路径：创建字符串模板的路由路径匹配的app路由。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">let</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;express&#x27;</span>);<br><br><span class="hljs-keyword">let</span> app = express();<br><span class="hljs-comment">/*</span><br><span class="hljs-comment">	匹配0个或1个b</span><br><span class="hljs-comment">*/</span><br>app.get(<span class="hljs-string">&#x27;/ab?cd&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>)=&gt;</span>&#123;<br>    res.send(<span class="hljs-string">&#x27;/ab?cd&#x27;</span>);<br>&#125;);<br><br><span class="hljs-comment">/*</span><br><span class="hljs-comment">	匹配一个或多个b</span><br><span class="hljs-comment">*/</span><br>app.get(<span class="hljs-string">&quot;/ab+cd&quot;</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;<br>	res.send(<span class="hljs-string">&quot;/ab+cd&quot;</span>);<br>&#125;);<br><br><span class="hljs-comment">/*</span><br><span class="hljs-comment">	*表示任意数量的字符</span><br><span class="hljs-comment">	所以b与c之间可以有任意个字符</span><br><span class="hljs-comment">*/</span><br>app.get(<span class="hljs-string">&quot;/ab*cd&quot;</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;<br>	res.send(<span class="hljs-string">&quot;/ab+cd&quot;</span>);<br>&#125;);<br><br><span class="hljs-comment">/*</span><br><span class="hljs-comment">	?表示0个或一个</span><br><span class="hljs-comment">*/</span><br>app.get(<span class="hljs-string">&quot;/a(bc)?d&quot;</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;<br>	res.send(<span class="hljs-string">&quot;/a(bc)?d&quot;</span>);<br>&#125;);<br><br></code></pre></td></tr></table></figure>
</li>
<li><p>基于路由正则写法的路由路径</p>
<p>创建正则写法的路由路径匹配的app路由</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 匹配路径中含有a的任意路径</span><br>app.get(<span class="hljs-string">&quot;/a/&quot;</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;<br>	res.send(<span class="hljs-string">&quot;/a/&quot;</span>);<br>&#125;);<br><br><span class="hljs-comment">// app.js-路由路径匹配fly结尾的任意路径</span><br>app.get(<span class="hljs-string">&quot;/*(fly)$/&quot;</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;<br>	res.send(<span class="hljs-string">&quot;/*(fly)$/&quot;</span>);<br>&#125;);<br></code></pre></td></tr></table></figure>
</li>
<li><p>基于路由参数的路由路径</p>
<p>创建基于路由参数的路由路径的app路由</p>
<ul>
<li><p>路由参数：用来获取路径中的值，并且该值会赋值给req.params对象</p>
<p>注意：路由参数必须是由大小写字母、数字、下划线组成</p>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs js">app.get(<span class="hljs-string">&quot;/a/:id/b/:name&quot;</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;<br>	res.send(req.params);<br>&#125;);<br></code></pre></td></tr></table></figure>

<p>访问<code>localhost:3000/a/1/b/张加林</code></p>
</li>
<li><p>不同的请求方式</p>
<ul>
<li><p>get</p>
</li>
<li><p>post</p>
</li>
<li><p>all：接收任意http方法</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs js">app.all(<span class="hljs-string">&#x27;/secret&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">req, res, next</span>)=&gt;</span>&#123;<br>    res.send(<span class="hljs-string">&#x27;all request!&#x27;</span>)<br>&#125;)<br></code></pre></td></tr></table></figure>

</li>
</ul>
</li>
</ul>
<h4 id="router级别路由"><a href="#router级别路由" class="headerlink" title="router级别路由"></a>router级别路由</h4><p><code>app.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// ...................</span><br><span class="hljs-keyword">var</span> goodsRouter = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;./routes/goods.js&quot;</span>);<br>app.use(<span class="hljs-string">&quot;/&quot;</span>, goodsRouter);<br></code></pre></td></tr></table></figure>

<p><code>routers/goods.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">let</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;express&quot;</span>);<br><span class="hljs-keyword">let</span> router = express.Router();<br><br><span class="hljs-keyword">let</span> goods = [<br>	&#123;<br>		gid: <span class="hljs-string">&quot;0001&quot;</span>,<br>		gname: <span class="hljs-string">&quot;Web前端课程&quot;</span>,<br>		gprice: <span class="hljs-number">21999</span>,<br>	&#125;,<br>	&#123;<br>		gid: <span class="hljs-string">&quot;0002&quot;</span>,<br>		gname: <span class="hljs-string">&quot;Java大数据课程&quot;</span>,<br>		gprice: <span class="hljs-number">24999</span>,<br>	&#125;<br>];<br><br>router.get(<span class="hljs-string">&quot;/goods&quot;</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;<br>	res.json(goods);<br>&#125;);<br><br><span class="hljs-built_in">module</span>.exports = router;<br></code></pre></td></tr></table></figure>

<h3 id="6-3-1自定义中间件与第三方中间件"><a href="#6-3-1自定义中间件与第三方中间件" class="headerlink" title="6.3.1自定义中间件与第三方中间件"></a>6.3.1自定义中间件与第三方中间件</h3><p>逻辑的分离，思维的独立</p>
<h4 id="中间的定义"><a href="#中间的定义" class="headerlink" title="中间的定义"></a>中间的定义</h4><p>中间件不是express独有的，在软件工程领域已经广泛使用。</p>
<p>express的本质就是调用各种中间件，服务器的生命周期是一个请求和响应的循环周期，处理请求一般较为复杂，为了逻辑单元独立和便于维护，可以将该部分拆分为子单元进行处理，此时子单元的处理就是中间件，服务器接收到请求后，会依次执行每个中间件，直到调用终止，发出响应给客户端。</p>
<p>中间件：函数，除了能够访问请求对象req和响应对象res，还有一个next对象</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">middleware</span>(<span class="hljs-params">req, res, next</span>)</span>&#123;<br>    <span class="hljs-comment">// 处理业务的逻辑代码</span><br>    next(); <span class="hljs-comment">// 调用下一个函数</span><br>&#125;<br></code></pre></td></tr></table></figure>

<p>next对象详解：</p>
<ul>
<li>nextI()将控制权交给下一个中间件，调用下一个函数</li>
<li>如果没有next()，就不用再调用下一个函数</li>
<li><strong>如果当前中间件没有调用next()，也没有结束请求-响应周期，请求会被挂起</strong></li>
</ul>
<p>中间件作用：</p>
<ul>
<li>执行逻辑代码</li>
<li>修改请求和响应对象</li>
<li>结束请求-响应周期</li>
<li>调用下一个中间件</li>
<li>主要有：自定义中间件、第三方中间件、内置中间件和错误中间件</li>
</ul>
<h4 id="自定义中间件"><a href="#自定义中间件" class="headerlink" title="自定义中间件"></a>自定义中间件</h4><p>案例：获取时间戳的中间件</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">/* </span><br><span class="hljs-comment">  获取时间戳的中间件</span><br><span class="hljs-comment">*/</span><br><span class="hljs-keyword">var</span> getTimeStamp = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">req, res, next</span>) </span>&#123;<br>	<span class="hljs-keyword">let</span> t1 = <span class="hljs-built_in">Date</span>.parse(<span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>());<br>	<span class="hljs-keyword">let</span> t2 = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>().valueOf();<br>	<span class="hljs-keyword">let</span> t3 = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>().getTime();<br><br>	<span class="hljs-built_in">console</span>.log(t1, t2, t3);<br>	next();<br>&#125;;<br>app.use(getTimeStamp);<br>app.get(<span class="hljs-string">&quot;/&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">req, res</span>) </span>&#123;<br>	<span class="hljs-built_in">console</span>.log(<span class="hljs-string">&quot;This is a self-defined middleware&quot;</span>);<br>&#125;);<br></code></pre></td></tr></table></figure>

<h4 id="第三方中间件"><a href="#第三方中间件" class="headerlink" title="第三方中间件"></a>第三方中间件</h4><p>案例：使用第三方中间件multiply，实现文件上传。</p>
<ul>
<li>初始化项目</li>
<li>安装中间件，创建文件存储文件夹</li>
<li>编码</li>
<li>运行测试</li>
</ul>
<p><code>./router/upload.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">var</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;express&quot;</span>);<br><span class="hljs-keyword">var</span> multiparty = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;multiparty&quot;</span>);<br><span class="hljs-keyword">var</span> http = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;http&quot;</span>);<br><span class="hljs-keyword">var</span> util = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;util&quot;</span>);<br><span class="hljs-keyword">var</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;fs&quot;</span>);<br><span class="hljs-keyword">var</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;path&quot;</span>);<br><br><span class="hljs-keyword">var</span> router = express.Router();<br><br>router.get(<span class="hljs-string">&quot;/&quot;</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;<br>	res.sendFile(path.join(__dirname, <span class="hljs-string">&quot;../views/index.html&quot;</span>)); <span class="hljs-comment">// 需要使用绝对路径</span><br>&#125;);<br><br>router.post(<span class="hljs-string">&quot;/&quot;</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;<br>	<span class="hljs-keyword">var</span> form = <span class="hljs-keyword">new</span> multiparty.Form(&#123;<br>		encoding: <span class="hljs-string">&quot;utf8&quot;</span>,<br>		maxFieldsSize: <span class="hljs-number">1024</span> * <span class="hljs-number">1024</span> * <span class="hljs-number">20</span>, <span class="hljs-comment">//设置文件大小限制：20M</span><br>		maxFields: <span class="hljs-number">100</span>, <span class="hljs-comment">// 限制文件数量</span><br>		uploadDir: <span class="hljs-string">&quot;./public/files&quot;</span>,<br>	&#125;);<br>	form.on(<span class="hljs-string">&quot;error&quot;</span>, <span class="hljs-function">() =&gt;</span> &#123;<br>		<span class="hljs-built_in">console</span>.log(<span class="hljs-string">&quot;Error parsing form: &quot;</span> + err.stack);<br>	&#125;);<br><br>	<span class="hljs-comment">// Close emitted after form parsed</span><br>	form.on(<span class="hljs-string">&quot;close&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;<br>		<span class="hljs-built_in">console</span>.log(<span class="hljs-string">&quot;Upload completed!&quot;</span>);<br>	&#125;);<br><br>	<span class="hljs-comment">/* 上传后处理 */</span><br>	form.parse(req, <span class="hljs-function">(<span class="hljs-params">err, fields, files</span>) =&gt;</span> &#123;<br>		<span class="hljs-keyword">var</span> filesTemp = <span class="hljs-built_in">JSON</span>.stringify(files, <span class="hljs-literal">null</span>, <span class="hljs-number">2</span>);<br>		<span class="hljs-keyword">if</span> (err) &#123;<br>			<span class="hljs-built_in">console</span>.log(err);<br>			<span class="hljs-built_in">console</span>.log(<span class="hljs-number">12</span>);<br>		&#125; <span class="hljs-keyword">else</span> &#123;<br>			<span class="hljs-keyword">var</span> inputFile = files.inputFile[<span class="hljs-number">0</span>];<br>			<span class="hljs-keyword">var</span> uploadedPath = inputFile.path;<br>			<span class="hljs-keyword">var</span> dstPath = path.join(<span class="hljs-string">&quot;./public/files&quot;</span>, inputFile.originalFilename);<br>			<span class="hljs-built_in">console</span>.log(dstPath);<br>			<span class="hljs-comment">//重命名为真实文件名</span><br>			fs.rename(uploadedPath, dstPath, <span class="hljs-function">(<span class="hljs-params">error</span>) =&gt;</span> &#123;<br>				<span class="hljs-keyword">if</span> (error) <span class="hljs-keyword">throw</span> error;<br>			&#125;);<br><br>			res.end(util.inspect(&#123; fields, <span class="hljs-attr">files</span>: filesTemp &#125;));<br>		&#125;<br>	&#125;);<br>	<span class="hljs-comment">// form.parse(req);</span><br>&#125;);<br><br><span class="hljs-built_in">module</span>.exports = router;<br></code></pre></td></tr></table></figure>

<p><code>app.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">var</span> uploadRouter = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;./routes/upload&quot;</span>);<br>app.use(<span class="hljs-string">&quot;/uploading&quot;</span>, uploadRouter);<br></code></pre></td></tr></table></figure>

<p><code>./view/index.html</code></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">&quot;X-UA-Compatible&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;IE=edge&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;viewport&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>上传文件<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">method</span>=<span class="hljs-string">&quot;post&quot;</span> <span class="hljs-attr">action</span>=<span class="hljs-string">&quot;/uploading&quot;</span> <span class="hljs-attr">enctype</span>=<span class="hljs-string">&quot;multipart/form-data&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;file&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;inputFile&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;submit&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;上传&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure>

<h3 id="6-3-2内置中间件与错误中间件"><a href="#6-3-2内置中间件与错误中间件" class="headerlink" title="6.3.2内置中间件与错误中间件"></a>6.3.2内置中间件与错误中间件</h3><h4 id="内置中间件"><a href="#内置中间件" class="headerlink" title="内置中间件"></a>内置中间件</h4><p>4.x后express框架唯一的内置中间件<code>express.static(root[, options])</code>：指定要加载的静态资源，包括图片、css、js等静态文件</p>
<p>root为加载静态资源的路径，options为可选参数，具有以下属性：</p>
<p><img src="https://gitee.com/zhangjialin_zhulan/myimagerepo/raw/master/images/image-20220311134709043.png" srcset="/img/loading.gif" lazyload alt="image-20220311134709043"></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">/*</span><br><span class="hljs-comment">	http://localhost:3000/files/image-20211223131427131.png</span><br><span class="hljs-comment">*/</span><br>app.use(<br>express.static(path.join(__dirname, <span class="hljs-string">&quot;public&quot;</span>), &#123;<br>		dotfiles: <span class="hljs-string">&quot;ignore&quot;</span>,<br>		etag: <span class="hljs-literal">false</span>,<br>		extensions: [<span class="hljs-string">&quot;htm&quot;</span>, <span class="hljs-string">&quot;html&quot;</span>],<br>		index: <span class="hljs-literal">false</span>,<br>		maxAge: <span class="hljs-string">&quot;1d&quot;</span>,<br>		redirect: <span class="hljs-literal">false</span>,<br>		setHeaders: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">res, path, stat</span>) </span>&#123;<br>			res.set(<span class="hljs-string">&quot;x-timestamp&quot;</span>, <span class="hljs-built_in">Date</span>.now());<br>		&#125;,<br>	&#125;)<br>);<br></code></pre></td></tr></table></figure>

<h4 id="错误中间件"><a href="#错误中间件" class="headerlink" title="错误中间件"></a>错误中间件</h4><p>参数顺序：<code>(err, req, res, next)</code></p>
<ul>
<li>即使不需要使用next参数，也必须要声明，否则会被识别为普通中间件，不能处理错误。</li>
<li>错误中间件需要放在所有中间件、路由函数的后面，才可以生效。</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// error handler</span><br>app.use(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err, req, res, next</span>) </span>&#123;<br>	<span class="hljs-comment">// set locals, only providing error in development</span><br>	res.locals.message = err.message;<br>	res.locals.error = req.app.get(<span class="hljs-string">&quot;env&quot;</span>) === <span class="hljs-string">&quot;development&quot;</span> ? err : &#123;&#125;;<br><br>	<span class="hljs-comment">// render the error page</span><br>	res.status(err.status || <span class="hljs-number">500</span>);<br>	res.render(<span class="hljs-string">&quot;error&quot;</span>);<br>&#125;);<br></code></pre></td></tr></table></figure>

<h3 id="6-4请求与响应"><a href="#6-4请求与响应" class="headerlink" title="6.4请求与响应"></a>6.4请求与响应</h3><h4 id="请求对象"><a href="#请求对象" class="headerlink" title="请求对象"></a>请求对象</h4><p>示例一：</p>
<p><code>app.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">var</span> reqRouter = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;./routes/req&quot;</span>);<br>app.use(<span class="hljs-string">&quot;/&quot;</span>, reqRouter);<br></code></pre></td></tr></table></figure>

<p><code>./routers/req.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">let</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;express&quot;</span>);<br><span class="hljs-keyword">let</span> router = express.Router();<br><br>router.get(<span class="hljs-string">&quot;/aa/bb/cc/:id&quot;</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;<br>	<span class="hljs-keyword">var</span> reqAttributes = &#123;<br>		originalUrl: req.originalUrl, <span class="hljs-comment">//获取路由配置的url</span><br>		hostname: req.hostname, <span class="hljs-comment">// 获取用户请求的域名</span><br>		ip: req.ip, <span class="hljs-comment">// 获取用户请求的ip地址</span><br>		method: req.method, <span class="hljs-comment">// 获取用户请求方法</span><br>		params: req.params, <span class="hljs-comment">// 获取路由动态参数中的内容</span><br>		path: req.path, <span class="hljs-comment">// 获取URL请求中的路径</span><br>		protocol: req.protocol, <span class="hljs-comment">// 获取客户端请求的协议</span><br>		secure: req.secure, <span class="hljs-comment">// 判断用户是否为https请求</span><br>		xhr: req.xhr, <span class="hljs-comment">// 判断是否是ajax请求</span><br>		query: req.query, <span class="hljs-comment">// 获取URL查询字符串部分的参数</span><br>	&#125;;<br>	res.send(reqAttributes);<br>&#125;);<br><br><span class="hljs-built_in">module</span>.exports = router;<br><br></code></pre></td></tr></table></figure>

<p>结果</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js">&#123;<span class="hljs-string">&quot;originalUrl&quot;</span>:<span class="hljs-string">&quot;/aa/bb/cc/21121212&quot;</span>,<span class="hljs-string">&quot;hostname&quot;</span>:<span class="hljs-string">&quot;127.0.0.1&quot;</span>,<span class="hljs-string">&quot;ip&quot;</span>:<span class="hljs-string">&quot;::ffff:127.0.0.1&quot;</span>,<span class="hljs-string">&quot;method&quot;</span>:<span class="hljs-string">&quot;GET&quot;</span>,<span class="hljs-string">&quot;params&quot;</span>:&#123;<span class="hljs-string">&quot;id&quot;</span>:<span class="hljs-string">&quot;21121212&quot;</span>&#125;,<span class="hljs-string">&quot;path&quot;</span>:<span class="hljs-string">&quot;/aa/bb/cc/21121212&quot;</span>,<span class="hljs-string">&quot;protocol&quot;</span>:<span class="hljs-string">&quot;http&quot;</span>,<span class="hljs-string">&quot;secure&quot;</span>:<span class="hljs-literal">false</span>,<span class="hljs-string">&quot;xhr&quot;</span>:<span class="hljs-literal">false</span>,<span class="hljs-string">&quot;query&quot;</span>:&#123;&#125;&#125;<br></code></pre></td></tr></table></figure>

<p>示例二：</p>
<p><code>login.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// http://localhost:3000/login/?password=123456&amp;account=zhangjialin访问</span><br>ar express = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;express&quot;</span>);<br><span class="hljs-keyword">var</span> router = express.Router();<br><br>router.get(<span class="hljs-string">&quot;/login&quot;</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;<br>	<span class="hljs-keyword">let</span> account = req.query.account;<br>	<span class="hljs-keyword">let</span> password = req.query.password;<br><br>	<span class="hljs-built_in">console</span>.log(account, password);<br>	res.send(<span class="hljs-string">&quot;login!&quot;</span>);<br>&#125;);<br><br><br><span class="hljs-comment">// http://localhost:3000/foods/1访问</span><br>router.get(<span class="hljs-string">&quot;/foods/:id&quot;</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;<br>	<span class="hljs-built_in">console</span>.log(req.params);<br>	<span class="hljs-keyword">let</span> id = req.params.id;<br>	<span class="hljs-keyword">if</span> (id == <span class="hljs-number">1</span>) &#123;<br>		res.render(<span class="hljs-string">&quot;food1&quot;</span>);<br>		<span class="hljs-built_in">console</span>.log(<span class="hljs-number">1</span>);<br>	&#125;<br>	<span class="hljs-keyword">if</span> (id == <span class="hljs-number">2</span>) res.render(<span class="hljs-string">&quot;food2&quot;</span>);<br>&#125;);<br><br><span class="hljs-built_in">module</span>.exports = router;<br></code></pre></td></tr></table></figure>

<p>请求对象的部分属性，如body属性，需要在POST方式下，使用<code>body-parse</code>中间件，才可能获取请求数据。</p>
<ul>
<li><p>安装<code>npm i body-parser -S</code></p>
</li>
<li><p>路由文件中引入中间件</p>
</li>
<li><p>对请求进行解析</p>
<p><code>urlencoded</code>解析器使用：<code>bobyParse.urlcoded(&#123;extended:[option]&#125;)</code>，其中option为true或false</p>
</li>
</ul>
<p>示例三：使用body-parse中间件，通过属性body获取请求数据。</p>
<p><code>body.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">var</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;express&quot;</span>);<br><span class="hljs-keyword">var</span> router = express.Router();<br><span class="hljs-keyword">var</span> bodyParser = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;body-parser&quot;</span>);<br><span class="hljs-keyword">var</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;path&quot;</span>);<br>router.use(bodyParser.urlencoded(&#123; <span class="hljs-attr">extended</span>: <span class="hljs-literal">false</span> &#125;));<br>router.use(bodyParser.json());<br><br><span class="hljs-comment">/* 登录页面 */</span><br>router.get(<span class="hljs-string">&quot;/login2&quot;</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;<br>	res.sendFile(path.join(__dirname, <span class="hljs-string">&quot;../views/login.html&quot;</span>));<br>&#125;);<br><br><span class="hljs-comment">/* 获取body数据 */</span><br>router.post(<span class="hljs-string">&quot;/login2&quot;</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;<br>	<span class="hljs-built_in">console</span>.log(<span class="hljs-built_in">JSON</span>.stringify(req.body));<br>	<span class="hljs-keyword">var</span> account = req.body.account;<br>	<span class="hljs-keyword">var</span> password = req.body.password;<br>	<span class="hljs-built_in">console</span>.log(account, password, req.body);<br>&#125;);<br><br><span class="hljs-built_in">module</span>.exports = router;<br></code></pre></td></tr></table></figure>

<p><code>login.html</code></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">&quot;X-UA-Compatible&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;IE=edge&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;viewport&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>登录<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">action</span>=<span class="hljs-string">&quot;/login2&quot;</span> <span class="hljs-attr">method</span>=<span class="hljs-string">&quot;post&quot;</span> <span class="hljs-attr">enctype</span>=<span class="hljs-string">&quot;multipart/form-data&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">&quot;账号&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;account&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;password&quot;</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">&quot;密码&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;password&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;submit&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;登录&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure>

<p>在<code>app.js</code>中添加引入代码</p>
<h4 id="响应对象"><a href="#响应对象" class="headerlink" title="响应对象"></a>响应对象</h4><ul>
<li>路由处理函数接收响应对象，调用响应对象的方法发送Http响应到客户端。</li>
<li>如果路由函数不给出任何响应，也就是不调用响应对象的任何方法，客户端会被挂起直到超时。</li>
</ul>
<table>
<thead>
<tr>
<th><strong>方法</strong></th>
<th><strong>描述</strong></th>
</tr>
</thead>
<tbody><tr>
<td>res.json()</td>
<td>返回JSON数据</td>
</tr>
<tr>
<td>res.send()</td>
<td>根据不同的内容，返回不同格式的HTTP响应，可以是字符串、JSON对象、Buffer对象</td>
</tr>
<tr>
<td>res.render()</td>
<td>渲染模板页面</td>
</tr>
<tr>
<td>res.redirect()</td>
<td>重定向到指定的URL</td>
</tr>
<tr>
<td>res.status()</td>
<td>设置响应状态码，如200,404,500等</td>
</tr>
<tr>
<td>res.set()</td>
<td>设置响应报头信息</td>
</tr>
<tr>
<td>res.end()</td>
<td>结束请求-响应循环</td>
</tr>
</tbody></table>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">let</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;express&quot;</span>);<br><span class="hljs-keyword">let</span> router = express.Router();<br><br><span class="hljs-keyword">var</span> goods = &#123;<br>	iphonex: &#123;<br>		nums: <span class="hljs-number">100</span>,<br>		price: <span class="hljs-number">1999.98</span>,<br>		color: <span class="hljs-string">&quot;red&quot;</span>,<br>	&#125;,<br>&#125;;<br>router.get(<span class="hljs-string">&quot;/json&quot;</span>, <span class="hljs-function">(<span class="hljs-params">req, res, next</span>) =&gt;</span> &#123;<br>	<span class="hljs-built_in">console</span>.log(req.url);<br>	res.json(&#123; <span class="hljs-attr">error</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">data</span>: goods &#125;);<br>&#125;);<br>router.get(<span class="hljs-string">&quot;/send&quot;</span>, <span class="hljs-function">(<span class="hljs-params">req, res, next</span>) =&gt;</span> &#123;<br>	<span class="hljs-comment">// res.send(&quot;success&quot;);</span><br>	<span class="hljs-comment">// res.send(goods);</span><br>	res.send(Buffer.from(<span class="hljs-string">&quot;你好&quot;</span>));<br>&#125;);<br>router.get(<span class="hljs-string">&quot;/render&quot;</span>, <span class="hljs-function">(<span class="hljs-params">req, res, next</span>) =&gt;</span> &#123;<br>	res.render(<span class="hljs-string">&quot;index&quot;</span>, &#123; <span class="hljs-attr">title</span>: <span class="hljs-string">&quot;张加林&quot;</span> &#125;);<br>&#125;);<br><br>router.get(<span class="hljs-string">&quot;/redirect&quot;</span>, <span class="hljs-function">(<span class="hljs-params">req, res, next</span>) =&gt;</span> &#123;<br>	res.redirect(<span class="hljs-string">&quot;/res/render&quot;</span>);<br>&#125;);<br><br>router.get(<span class="hljs-string">&quot;/status&quot;</span>, <span class="hljs-function">(<span class="hljs-params">req, res, next</span>) =&gt;</span> &#123;<br>	res.status(<span class="hljs-number">200</span>).send(<span class="hljs-string">&quot;success&quot;</span>);<br>&#125;);<br><br>router.get(<span class="hljs-string">&quot;/set&quot;</span>, <span class="hljs-function">(<span class="hljs-params">req, res, next</span>) =&gt;</span> &#123;<br>	res.setHeader(<span class="hljs-string">&quot;Contnt-Type&quot;</span>, <span class="hljs-string">&quot;text/html;charset=utf8&quot;</span>);<br>	res.set(&#123;<br>		<span class="hljs-string">&quot;Content-Type&quot;</span>: <span class="hljs-string">&quot;application/json&quot;</span>,<br>	&#125;);<br><br>	<span class="hljs-built_in">console</span>.log(res.get(<span class="hljs-string">&quot;Content-Type&quot;</span>));<br>	res.end();<br>&#125;);<br><span class="hljs-built_in">module</span>.exports = router;<br></code></pre></td></tr></table></figure>

<p>在<code>app.js</code>中引入中间件即可。</p>
<h3 id="6-5cookie"><a href="#6-5cookie" class="headerlink" title="6.5cookie"></a>6.5cookie</h3><h4 id="cookie工作原理"><a href="#cookie工作原理" class="headerlink" title="cookie工作原理"></a>cookie工作原理</h4><p>http协议：无状态协议</p>
<p>需要知道客户端身份</p>
<h4 id="cookie设置与获取"><a href="#cookie设置与获取" class="headerlink" title="cookie设置与获取"></a>cookie设置与获取</h4><p>cookie-parser：处理cookie数据的第三方中间件。</p>
<p>获取请求cookie：<code>req.cookies</code></p>
<p>设置cookie：<code>res.cookie(name, value[, options])</code></p>
<table>
<thead>
<tr>
<th><strong>属性</strong></th>
<th><strong>含义</strong></th>
</tr>
</thead>
<tbody><tr>
<td>domain</td>
<td>域名，默认为当前域名</td>
</tr>
<tr>
<td>(key:value)</td>
<td>键值对，可以设置要保存的key:value，注意这里的key不能和其他属性项的名字相同</td>
</tr>
<tr>
<td>expires</td>
<td>过期时间(秒)，在设置的某个时间点后该Cookie就会失效，如 expires=Wednesday, 09-Nov-21  23:12:40 GMT。如果未设置或设置为0，浏览器关闭后cookie失效</td>
</tr>
<tr>
<td>maxAge</td>
<td>最大失效时间（毫秒）</td>
</tr>
<tr>
<td>secure</td>
<td>当secure值为true时，cookie在HTTP中无效，只有在HTTPS中才有效</td>
</tr>
<tr>
<td>path</td>
<td>表示在哪个路由下可以访问到cookie</td>
</tr>
<tr>
<td>httpOnly</td>
<td>微软对cookie做的扩展。如果在cookie中设置了“httpOnly”属性，通过程序（JS脚本、applet等）将无法读取到cookie信息，防止XSS攻击</td>
</tr>
<tr>
<td>singed</td>
<td>表示是否签cookie，设为true会对这个cookie签名，这样就需要用 res.signedCookies而不是res.cookies访问它。被篡改的签名cookie会被服务器拒绝，并且cookie值会重置为它的原始值</td>
</tr>
</tbody></table>
<p>实例</p>
<ul>
<li>搭建环境</li>
<li>安装<code>npm install cookie-parser -S</code></li>
<li>编码</li>
<li>运行</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">var</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;express&quot;</span>);<br><span class="hljs-keyword">var</span> router = express.Router();<br><span class="hljs-keyword">var</span> cookieParser = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;cookie-parser&quot;</span>);<br><br>router.use(cookieParser());<br><br>router.get(<span class="hljs-string">&quot;/cookie&quot;</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;<br>	res.send(<span class="hljs-string">&quot;cookie学习&quot;</span>);<br>&#125;);<br>router.get(<span class="hljs-string">&quot;/set&quot;</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;<br>	res.cookie(<span class="hljs-string">&quot;myName&quot;</span>, <span class="hljs-string">&quot;张加林&quot;</span>, &#123;<br>		maxAge: <span class="hljs-number">20000</span>,<br>		httpOnly: <span class="hljs-literal">true</span>,<br>	&#125;);<br>	res.send(<span class="hljs-string">&quot;设置cookie成功&quot;</span>);<br>&#125;);<br><br>router.get(<span class="hljs-string">&quot;/get&quot;</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;<br>	<span class="hljs-built_in">console</span>.log(req.cookies.myName);<br>	res.status(<span class="hljs-number">200</span>).send(<span class="hljs-string">&quot;cookie数据：&quot;</span> + req.cookies.myName);<br>&#125;);<br><br><span class="hljs-built_in">module</span>.exports = router;<br></code></pre></td></tr></table></figure>

<h3 id="6-6session"><a href="#6-6session" class="headerlink" title="6.6session"></a>6.6session</h3><p>cookie存储在客户端，容易被篡改，服务端session的出现，将用户的信息临时保存在服务器，提高了用户数据的安全性。</p>
<h4 id="session工作原理"><a href="#session工作原理" class="headerlink" title="session工作原理"></a>session工作原理</h4><p>session会话控制</p>
<ul>
<li>服务器中，存储特定用户会话所需属性及配置属性</li>
<li>客户无法修改，用户离开网站后，sessionid才会注销</li>
</ul>
<p><img src="https://gitee.com/zhangjialin_zhulan/myimagerepo/raw/master/images/image-20220311215910641.png" srcset="/img/loading.gif" lazyload alt="image-20220311215910641"></p>
<p>4.服务器检查是否存在这个sessionid</p>
<ul>
<li>不存在：新建一个sessionid(重复步骤1-2流程)</li>
<li>存在：找到与sessionid相对应的文件，文件中的键为该sessionid，值为当前用户的信息。</li>
</ul>
<h4 id="Session的安装配置与设置获取"><a href="#Session的安装配置与设置获取" class="headerlink" title="Session的安装配置与设置获取"></a>Session的安装配置与设置获取</h4><p>获取请求对象的session属性：<code>req.session</code></p>
<p>express-session：处理session数据的第三方中间件。</p>
<p>引入：<code>app.user(session(options))</code></p>
<table>
<thead>
<tr>
<th><strong>属性</strong></th>
<th><strong>含义</strong></th>
</tr>
</thead>
<tbody><tr>
<td>name</td>
<td>cookie的名字，默认为connect.sid</td>
</tr>
<tr>
<td>store</td>
<td>session存储实例</td>
</tr>
<tr>
<td>secret</td>
<td>对session  cookie签名，防止被篡改</td>
</tr>
<tr>
<td>cookie</td>
<td>session  cookie设置，默认为{  path: ‘/‘, httpOnly: true,secure:  false, maxAge:  null }</td>
</tr>
<tr>
<td>genid</td>
<td>生成新session ID的函数</td>
</tr>
<tr>
<td>rolling</td>
<td>在每次请求时强行设置cookie，这将重置cookie过期时间，默认为false</td>
</tr>
<tr>
<td>resave</td>
<td>强制保存session，默认为true，建议设为false</td>
</tr>
<tr>
<td>proxy</td>
<td>当设置了secure  cookies时，信任反向代理。当设定为true时，“x-forwarded-proto”的header信息将被使用；当设定为false时，所有headers将被忽略。当该属性没有被设定时，将使用Express的trust  proxy</td>
</tr>
<tr>
<td>saveUninitialized</td>
<td>强制将未初始化的session存储。当新建了一个session且未设定属性或值时，它就处于未初始化状态。在设定一个cookie前，这对于登陆验证、减轻服务端存储压力以及权限控制是有帮助的，默认为true</td>
</tr>
<tr>
<td>unset</td>
<td>控制req.session是否取消，可以使session保持存储状态但忽略修改或删除的请求，默认为keep</td>
</tr>
</tbody></table>
<p>案例：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">var</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;express&quot;</span>);<br><span class="hljs-keyword">var</span> router = express.Router();<br><span class="hljs-keyword">var</span> session = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;express-session&quot;</span>);<br><span class="hljs-comment">/* 配置中间件 */</span><br>router.use(<br>	session(&#123;<br>		secret: <span class="hljs-string">&quot;zhangjianlin&quot;</span>,<br>		resave: <span class="hljs-literal">false</span>,<br>		saveUninitialized: <span class="hljs-literal">true</span>,<br>		cookie:<br>			(<span class="hljs-string">&quot;name&quot;</span>,<br>			<span class="hljs-string">&quot;value&quot;</span>,<br>			&#123;<br>				maxAge: <span class="hljs-number">5</span> * <span class="hljs-number">60</span> * <span class="hljs-number">1000</span>,<br>				secure: <span class="hljs-literal">false</span>,<br>			&#125;),<br>	&#125;)<br>);<br>router.use(<span class="hljs-string">&quot;/login3&quot;</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;<br>	<span class="hljs-comment">// 设置session参数值</span><br>	req.session.userinfo = <span class="hljs-string">&quot;july&quot;</span>;<br>	<span class="hljs-built_in">console</span>.log(req.session);<br>	res.send(<span class="hljs-string">&quot;登录成功！&quot;</span>);<br>&#125;);<br>router.use(<span class="hljs-string">&quot;/&quot;</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;<br>	<span class="hljs-comment">// 获取session</span><br>	<span class="hljs-built_in">console</span>.log(req.session);<br>	<span class="hljs-keyword">if</span> (req.session.userinfo)<br>		res.send(<span class="hljs-string">&quot;Hello &quot;</span> + req.session.userinfo + <span class="hljs-string">&quot;, welcome!&quot;</span>);<br>	<span class="hljs-keyword">else</span> res.send(<span class="hljs-string">&quot;未登录&quot;</span>);<br>&#125;);<br><br><span class="hljs-built_in">module</span>.exports = router;<br></code></pre></td></tr></table></figure>

<p>用户注销：<code>req.session.destroy();</code></p>
<h3 id="6-7postman-apipost"><a href="#6-7postman-apipost" class="headerlink" title="6.7postman/apipost"></a>6.7postman/apipost</h3><p><img src="https://gitee.com/zhangjialin_zhulan/myimagerepo/raw/master/images/image-20220311233751710.png" srcset="/img/loading.gif" lazyload alt="image-20220311233751710"></p>
<p>预执行语句，语法使用Javascript</p>
<p><img src="https://gitee.com/zhangjialin_zhulan/myimagerepo/raw/master/images/image-20220311233817824.png" srcset="/img/loading.gif" lazyload alt="image-20220311233817824"></p>
<h3 id="6-8实训"><a href="#6-8实训" class="headerlink" title="6.8实训"></a>6.8实训</h3><h4 id="搭建项目框架"><a href="#搭建项目框架" class="headerlink" title="搭建项目框架"></a>搭建项目框架</h4><h4 id="中间件访问静态文件"><a href="#中间件访问静态文件" class="headerlink" title="中间件访问静态文件"></a>中间件访问静态文件</h4><h3 id="6-9-扩展知识"><a href="#6-9-扩展知识" class="headerlink" title="6.9 扩展知识"></a>6.9 扩展知识</h3><h4 id="Promise异步编程"><a href="#Promise异步编程" class="headerlink" title="Promise异步编程"></a>Promise异步编程</h4><h4 id="token、jwt"><a href="#token、jwt" class="headerlink" title="token、jwt"></a>token、jwt</h4><p>因为http是无状态的，所以要反复验证用户信息，为了优化用户体验保持用户登录状态，所以诞生了cookie。</p>
<p>用户首次请求服务器，服务器返回cookie，浏览器将cookie持久化，浏览器每次访问浏览器都会带上cookie，cookie有效期到后，浏览器会自动删除Cookie。</p>
<p>将用户名和密码保存在cookie中，很不安全，因为cookie中的信息可能泄露，就产生了session会话。浏览器访问服务器就是会话的开始，服务器会对每个用户会话设定时间(结束会话时间)以及唯一的sessionID，保存在数据库中，sessionID也会返回给浏览器，浏览器将它保存在cookie中，这里相当于将保存在cookie中的账号密码加密了。此时就算sessionID被黑客得到也没有问题，因为信息被加密，而且服务器在发送cookie前会对SessionID进行签名，那么黑客修改了sessionID，那么服务器将不能识别该sessionID。用户注销后，删除服务器中的sessionID()。</p>
<p>由于用户群体基数庞大，如果服务器依旧使用基于cookie的session，当某个时间有大量用户访问服务器时，服务器将可能面临存储大量SessionID；当有多台服务器，一台服务器存储了sessionID，又将面临需要分享SessionID给其他服务器，所以这台服务器很可能超载，就需要分配一些用户到其他服务器，这就是分布式session，还可以将所有sessionID存到单独数据库中，所有服务器都可以访问，但是服务器崩溃就会影响服务器获取sessionID，以上前提下，产生了JSON WEB TOKEN。</p>
<p>对于jwt，服务器需要保存jwt签名的密文，不需要保存jwt（原来要保存很多个sessionID，现在只需要保存一个简单的签名），接着将jwt发送给浏览器，让浏览器以cookie或者Storge形式进行存储；后续用户每次需要将该jwt发送至服务器，用户就不需要再输入账号密码。</p>
<p>jwt深挖：</p>
<ul>
<li>组成：<code>header.payload.signature</code>，三部分<ul>
<li>header：加密算法</li>
<li>payload：特定数据，例如有效期</li>
<li>signature：签名密文</li>
</ul>
</li>
</ul>
<p><img src="https://gitee.com/zhangjialin_zhulan/myimagerepo/raw/master/images/image-20220313230207687.png" srcset="/img/loading.gif" lazyload alt="image-20220313230207687"></p>
<p>注意：jwt的三个部分相关联，修改任意一个部分，都会出错，所以具有一定安全性。</p>
<p>服务器对浏览器发送的jwt解密的过程只需要signature就能进行。</p>
<p>案例：</p>
<p><code>tokenTest.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> &#123; getToken, setToken &#125; = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;../utils/token&quot;</span>);<br><br><span class="hljs-keyword">const</span> token = setToken(<span class="hljs-string">&quot;zhangjialin&quot;</span>, <span class="hljs-string">&quot;123456789&quot;</span>);<br><br>token.then(<span class="hljs-function">(<span class="hljs-params">value</span>) =&gt;</span> &#123;<br>	<span class="hljs-built_in">console</span>.log(<span class="hljs-keyword">typeof</span> value);<br>	<span class="hljs-built_in">console</span>.log(getToken(value));<br>&#125;);<br></code></pre></td></tr></table></figure>

<p><code>token.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> &#123; append &#125; = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;express/lib/response&quot;</span>);<br><span class="hljs-keyword">const</span> jwt = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;jsonwebtoken&quot;</span>);<br><span class="hljs-keyword">var</span> jwtScrect = <span class="hljs-string">&quot;ComprehensiveCurriculumDesign&quot;</span>; <span class="hljs-comment">//签名</span><br><br><span class="hljs-comment">/* 模块用于设置token，获取token */</span><br><span class="hljs-comment">//登录接口 生成token的方法</span><br><span class="hljs-built_in">exports</span>.setToken = <span class="hljs-keyword">async</span> (user_name, password) =&gt; &#123;<br>	<span class="hljs-keyword">try</span> &#123;<br>		<span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> &#123;<br>			<span class="hljs-comment">//expiresln 设置token过期的时间</span><br>			<span class="hljs-keyword">const</span> token = jwt.sign(<br>				&#123; user_name, password &#125;,<br>				jwtScrect,<br>				&#123;<br>					expiresIn: <span class="hljs-string">&quot;24h&quot;</span>,<br>				&#125;,<br>				(err, token) =&gt; &#123;<br>					<span class="hljs-keyword">if</span> (err) reject();<br>					<span class="hljs-built_in">console</span>.log(<span class="hljs-string">&quot;token:&quot;</span>, token);<br>					resolve(token);<br>				&#125;<br>			);<br>		&#125;);<br>	&#125; <span class="hljs-keyword">catch</span> (err_1) &#123;<br>		<span class="hljs-built_in">console</span>.log(err_1);<br>	&#125;<br>&#125;;<br><br><span class="hljs-comment">//各个接口需要验证token的方法</span><br><span class="hljs-built_in">exports</span>.getToken = <span class="hljs-keyword">async</span> (token) =&gt; &#123;<br>	<span class="hljs-keyword">try</span> &#123;<br>		<span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> &#123;<br>			<span class="hljs-keyword">if</span> (!token) &#123;<br>				<span class="hljs-built_in">console</span>.log(<span class="hljs-string">&quot;token是空的&quot;</span>);<br>				reject(&#123;<br>					error: <span class="hljs-string">&quot;token 是空的&quot;</span>,<br>				&#125;);<br>			&#125; <span class="hljs-keyword">else</span> &#123;<br>				<span class="hljs-keyword">var</span> info = jwt.verify(token, jwtScrect);<br>				<span class="hljs-built_in">console</span>.log(info);<br>				resolve(info); <span class="hljs-comment">//解析返回的值（sign 传入的值）</span><br>			&#125;<br>		&#125;);<br>	&#125; <span class="hljs-keyword">catch</span> (err) &#123;<br>		<span class="hljs-built_in">console</span>.log(err);<br>	&#125;<br>&#125;;<br></code></pre></td></tr></table></figure>

<p>所用核心包：</p>
<ul>
<li><code>jsonwebtoken</code>：主要使用<code>sign()</code>方法生成token，使用<code>verify()</code>方法验证token</li>
<li><code>express-jwt</code>：验证jwt是否过期，规定哪些路由接口不需要验证token</li>
</ul>
<h2 id="第七章-模板引擎"><a href="#第七章-模板引擎" class="headerlink" title="第七章 模板引擎"></a>第七章 模板引擎</h2><h3 id="7-1-pug模板引擎"><a href="#7-1-pug模板引擎" class="headerlink" title="7.1 pug模板引擎"></a>7.1 pug模板引擎</h3><h4 id="pug集成模板简介"><a href="#pug集成模板简介" class="headerlink" title="pug集成模板简介"></a>pug集成模板简介</h4><p>pub模板：Express默认的模板引擎，较早版本中称为jade模板，pug是jade更名后的叫法，可以认为pub是jage的升级更新。</p>
<ul>
<li>特点：<ul>
<li>pug集成模板与HTML标签一致</li>
<li>pug不需要关闭标签</li>
<li>用缩进表示标签直接嵌套关系</li>
</ul>
</li>
</ul>
<h4 id="pug文件编译"><a href="#pug文件编译" class="headerlink" title="pug文件编译"></a>pug文件编译</h4><p>流程：安装-编译</p>
<p>全局安装pug：<code>npm install pug-cli -g</code></p>
<p>查看版本：<code>pug --version</code></p>
<ul>
<li><p>生成一个压缩后的<code>.html</code>文件：</p>
<p><code>pug fileName.pug</code></p>
</li>
<li><p>生成一个没压缩的<code>.html</code>文件：</p>
<p><code>pug fileName.pug -P</code> </p>
</li>
<li><p>实时监听.pug文件，文件改时自动生成一个没压缩的<code>.html</code>文件：</p>
<p><code>pug fileName.pug -P -w</code></p>
</li>
<li><p>编译<code>.pug</code>文件后写入destination目录中，并实时监听：</p>
<p><code>pug fileName.pug -P -w -o destination</code></p>
</li>
</ul>
<h4 id="pug语法"><a href="#pug语法" class="headerlink" title="pug语法"></a>pug语法</h4><h5 id="文档声明"><a href="#文档声明" class="headerlink" title="文档声明"></a>文档声明</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs xml">doctype html 等价于<br><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">html</span>&gt;</span>  <br></code></pre></td></tr></table></figure>

<h5 id="标签"><a href="#标签" class="headerlink" title="标签"></a>标签</h5><h6 id="标签语法"><a href="#标签语法" class="headerlink" title="标签语法"></a>标签语法</h6><ul>
<li><p>默认情况下，在每行文本的开头书写HTML标签名称</p>
</li>
<li><p>使用缩进表示标签之间的嵌套关系，构建一个HTML代码的树状结构</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-tag">ul</span><br>	<span class="hljs-selector-tag">li</span> Item <span class="hljs-selector-tag">A</span><br>	<span class="hljs-selector-tag">li</span> Item <span class="hljs-selector-tag">B</span><br>	<span class="hljs-selector-tag">li</span> Item C<br>等价于<br>&lt;<span class="hljs-selector-tag">ul</span>&gt;<br>    &lt;<span class="hljs-selector-tag">li</span>&gt;Item <span class="hljs-selector-tag">A</span>&lt;<span class="hljs-selector-tag">li</span>/&gt;<br>    &lt;<span class="hljs-selector-tag">li</span>&gt;Item <span class="hljs-selector-tag">B</span>&lt;<span class="hljs-selector-tag">li</span>/&gt;<br>    &lt;<span class="hljs-selector-tag">li</span>&gt;Item C&lt;<span class="hljs-selector-tag">li</span>/&gt;<br>&lt;/<span class="hljs-selector-tag">ul</span>&gt;<br></code></pre></td></tr></table></figure>
</li>
<li><p>pug可以识别哪些元素是自闭合的：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-tag">img</span> 与 &lt;<span class="hljs-selector-tag">img</span>/&gt;<br></code></pre></td></tr></table></figure>
</li>
<li><p>为了节省空间，pug为嵌套标签提供了一种内联式语法</p>
<figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs dts"><span class="hljs-symbol">a:</span>img 等价于<br><span class="hljs-params">&lt;a&gt;</span><span class="hljs-params">&lt;img/&gt;</span><span class="hljs-params">&lt;/a&gt;</span><br></code></pre></td></tr></table></figure>

</li>
</ul>
<h6 id="标签属性"><a href="#标签属性" class="headerlink" title="标签属性"></a>标签属性</h6><ul>
<li><p>属性</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs pug">a(href&#x3D;&#39;https:&#x2F;&#x2F;miketaylor.cn&#39;) 个人小站<br><br>a(class&#x3D;&#39;button&#39; href&#x3D;&#39;https:&#x2F;&#x2F;miketaylor.cn&#39;)个人小站<br><br>a(class&#x3D;&#39;button&#39;,href&#x3D;&#39;https:&#x2F;&#x2F;miketaylor.cn&#39;) 个人小站<br></code></pre></td></tr></table></figure>

<p>一般用逗号或空格隔开，不过不用也可以被识别</p>
<p>编译后</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&#x27;https://miketaylor.cn&#x27;</span>&gt;</span>个人小站<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&#x27;button&#x27;</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&#x27;https://miketaylor.cn&#x27;</span>&gt;</span>个人小站<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&#x27;button&#x27;</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&#x27;https://miketaylor.cn&#x27;</span>&gt;</span>个人小站<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br></code></pre></td></tr></table></figure>
</li>
<li><p>运行时JavaScript属性</p>
<p>运行JS的属性-pug</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pug">-var authenticated &#x3D; true body(class&#x3D;&#39;authenticated&#39;?&#39;authed&#39;:&#39;anon&#39;)<br></code></pre></td></tr></table></figure>

<p>运行时JS的属性-HTML</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">body</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;authed&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br></code></pre></td></tr></table></figure>

<ul>
<li>三元表达式<code>&quot;authenticated ? &#39;authed&#39; : &#39;anon&#39;&quot;</code><ul>
<li>变量<code>authenticated</code>为true，则<code>class=authed</code></li>
<li>变量<code>authenticated</code>为false，则<code>class=anon</code></li>
</ul>
</li>
</ul>
</li>
<li><p>多行属性</p>
<p><code>pug</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs pug">input(<br>	type&#x3D;&#39;checkbox&#39;<br>	name&#x3D;&#39;agreement&#39;<br>	checked<br>)<br></code></pre></td></tr></table></figure>

<p><code>HTML</code></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&#x27;checkbox&#x27;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&#x27;agreement&#x27;</span> <span class="hljs-attr">checked</span>=<span class="hljs-string">&#x27;checked&#x27;</span> /&gt;</span><br></code></pre></td></tr></table></figure>
</li>
<li><p>布尔属性</p>
<p><code>pug</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs pug">input(type&#x3D;&#39;checkbox&#39; checked)<br>input(type&#x3D;&#39;checkbox&#39; checked&#x3D;true)<br>input(type&#x3D;&#39;checkbox&#39; checked&#x3D;false)<br></code></pre></td></tr></table></figure>

<p><code>HTML</code></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;checkbox&quot;</span> <span class="hljs-attr">checked</span>=<span class="hljs-string">&quot;checked&quot;</span> /&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;checkbox&quot;</span> <span class="hljs-attr">checked</span>=<span class="hljs-string">&quot;checked&quot;</span> /&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;checkbox&quot;</span> /&gt;</span><br></code></pre></td></tr></table></figure>
</li>
<li><p>样式属性</p>
<p><code>pug</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pug">a(style&#x3D;&#123;color: &#39;red&#39;,background:&#39;blue&#39;&#125;)<br></code></pre></td></tr></table></figure>

<p><code>HTML</code></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;color: red,background: blue&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br></code></pre></td></tr></table></figure>

<p>样式属性可以是一个字符串，也可以是一个对象。</p>
</li>
<li><p>类属性</p>
<p><code>pug</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs pug">-var classes&#x3D;[&#39;foo&#39;, &#39;bar&#39;, &#39;baz&#39;]<br><br>a.button<br><br>a(class&#x3D;classes)<br><br>&#x2F;&#x2F;- class属性也可以在合并的数组中重复使用<br>a.bang(class&#x3D;classes class&#x3D;[&#39;bing&#39;])<br><br>&#x2F;&#x2F;- 如果省略标签名称，默认为div标签<br>.content<br></code></pre></td></tr></table></figure>

<p><code>HTML</code></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;button&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;foo bar baz&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;bang foo bar baz bing&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;content&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br></code></pre></td></tr></table></figure>

<p>类属性可以是一个字符串，也可以是一个包含多个类名的数组。</p>
</li>
<li><p>id属性</p>
<p><code>pug</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs pug">a#main-link<br>#content<br></code></pre></td></tr></table></figure>

<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;main-link&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;content&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br></code></pre></td></tr></table></figure>

<p>id属性可以使用<code>#idname</code>来定义，跟类属性一样，如果省略标签名，默认为<code>&lt;div&gt;</code>标签</p>
</li>
</ul>
<p>编译前</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs pug">doctype html<br>html<br>    head<br>        title&#x3D;&quot;属性学习&quot;<br>        meta(charset&#x3D;&quot;UTF-8&quot;)<br>    body<br>        &#x2F;&#x2F;- 标签语法 <br>        ul<br>            li Item A<br>            li Item B<br>            li Item C<br>            <br>        &#x2F;&#x2F;-属性<br>        a(href&#x3D;&quot;&#39;https:&#x2F;&#x2F;miketaylorjuly123456.cn&quot; class&#x3D;&quot;button&quot;) 小站<br>        a(href&#x3D;&quot;&#39;https:&#x2F;&#x2F;miketaylorjuly123456.cn&quot;,class&#x3D;&quot;button&quot;) 小站<br><br>        &#x2F;&#x2F;-JavaScript属性<br>        -var authenticated &#x3D; true<br>        body(class&#x3D;&#39;authenticated&#39;?&#39;authed&#39;:&#39;anon&#39;)<br><br>        &#x2F;&#x2F;-多行属性<br>        input(<br>            type&#x3D;&#39;checkbox&#39;<br>            name&#x3D;&#39;agreement&#39;<br>            checked<br>        )<br>        <br>        &#x2F;&#x2F;-布尔属性<br>        input(type&#x3D;&#39;checkbox&#39; checked)<br>        input(type&#x3D;&#39;checkbox&#39; checked&#x3D;&#39;true&#39;)<br>        input(type&#x3D;&#39;checkbox&#39; checked&#x3D;&#39;false&#39;)<br><br>        &#x2F;&#x2F;-样式属性<br>        a(style&#x3D;&#123;color:&#39;blue&#39;,background:&#39;#8080ff&#39;&#125;) 链接<br><br>        &#x2F;&#x2F;- 类属性<br>        -var classes&#x3D;[&#39;foo&#39;, &#39;bar&#39;, &#39;baz&#39;]<br>        a.button<br>        a(class&#x3D;classes)<br><br>        &#x2F;&#x2F;- class属性也可以在合并的数组中重复使用<br>        a.bang(class&#x3D;classes class&#x3D;[&#39;bing&#39;])<br><br>        &#x2F;&#x2F;- 如果省略标签名称，默认div<br>        .content <br><br>        &#x2F;&#x2F;- id属性<br>        a#main-link<br>        #content<br></code></pre></td></tr></table></figure>

<p>编译<code>pug attributes.pug -p -w -o ./</code></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>属性学习<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>Item A<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>Item B<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>Item C<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;button&quot;</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;&#x27;https://miketaylorjuly123456.cn&quot;</span>&gt;</span>小站<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;button&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;&#x27;https://miketaylorjuly123456.cn&quot;</span>&gt;</span>小站<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">body</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;authed&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;checkbox&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;agreement&quot;</span> <span class="hljs-attr">checked</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;checkbox&quot;</span> <span class="hljs-attr">checked</span>&gt;</span>&lt;input<br>        type=&quot;checkbox&quot; checked=&quot;true&quot;&gt;<span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;checkbox&quot;</span> <span class="hljs-attr">checked</span>=<span class="hljs-string">&quot;false&quot;</span>&gt;</span>&lt;a<br>        style=&quot;color:blue;background:#8080ff;&quot;&gt;链接<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;button&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;foo bar baz&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>&lt;a<br>        class=&quot;bang foo bar baz bing&quot;&gt;<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;content&quot;</span>&gt;</span> <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;main-link&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;content&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure>

<h6 id="标签文本"><a href="#标签文本" class="headerlink" title="标签文本"></a>标签文本</h6><ul>
<li><p>行内文本</p>
<p>添加一段行内的纯文本，最简单的方法：标签，加空格，后面为标签的文本内容</p>
</li>
<li><p>动态输出文本</p>
</li>
<li><p>输出属性值</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs pug">doctype html<br>html<br>    head<br>        meta(charset&#x3D;&quot;UTF-8&quot;)<br>        title&#x3D;&quot;标签文本&quot;<br>    body<br>        &#x2F;&#x2F;- 行内文本<br>        p 这是一段纯洁的&lt;em&gt;文本&lt;&#x2F;em&gt;内容<br><br>        &#x2F;&#x2F;- 动态输出文本<br>        - var obj &#x3D; &#123;name: &#39;zjl&#39;&#125;<br>        p #&#123;obj.name&#125; is learning!<br><br>        &#x2F;&#x2F;- 输出属性值<br>        - url &#x3D; &quot;https:&#x2F;&#x2F;miketaylorjuly123.cn&quot;<br>        a(href&#x3D;url) 个人小站<br><br>        &#x2F;&#x2F;- 多行文本<br>        p<br>            | hello pug<br>            | hello node<br>            | hello world<br><br>        p.<br>            hello pug<br>            hello node <br>            hello world <br>            <br>        &#x2F;&#x2F;- 含有HTML代码的文本<br>        p.<br>            hello &lt;b&gt;pug&lt;&#x2F;b&gt;<br>            hello &lt;span&gt;node&lt;&#x2F;span&gt;<br>            hello world<br></code></pre></td></tr></table></figure>

<p>编译：<code>pug text.pug -p -w -o ./</code></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>标签文本<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>这是一段纯洁的<span class="hljs-tag">&lt;<span class="hljs-name">em</span>&gt;</span>文本<span class="hljs-tag">&lt;/<span class="hljs-name">em</span>&gt;</span>内容<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>zjl is learning!<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;https://miketaylorjuly123.cn&quot;</span>&gt;</span>个人小站<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>hello pug<br>        hello node<br>        hello world<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>hello pug<br>        hello node<br>        hello world<br>    <span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>hello <span class="hljs-tag">&lt;<span class="hljs-name">b</span>&gt;</span>pug<span class="hljs-tag">&lt;/<span class="hljs-name">b</span>&gt;</span><br>        hello <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>node<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br>        hello world<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure>

<h5 id="注释"><a href="#注释" class="headerlink" title="注释"></a>注释</h5><p>注释可以在编译时输出或不输出。</p>
<ul>
<li>输出的注释和JavaScript的单行注释类似，使用<code>//</code>符号生成独立一行的HTML</li>
<li>不需要注释只需要加使用<code>//-</code>，这些注释仅仅出现在pug模板中，不会出现在渲染后的HTML中</li>
</ul>
<p><code>注释-pug</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs pug">&#x2F;&#x2F; 一些内容<br>p foo<br>p bar<br><br>&#x2F;&#x2F;- 这行不会显示在结果中<br>p foo<br>p bar<br></code></pre></td></tr></table></figure>

<p><code>编译结果-HTML</code></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-comment">&lt;!--一些内容--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>foo<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>bar<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>foo<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>bar<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br></code></pre></td></tr></table></figure>

<h3 id="7-2-ejs模板"><a href="#7-2-ejs模板" class="headerlink" title="7.2 ejs模板"></a>7.2 ejs模板</h3><h4 id="ejs标签含义"><a href="#ejs标签含义" class="headerlink" title="ejs标签含义"></a>ejs标签含义</h4><p>ejs模板</p>
<ul>
<li>支持直接在标签体内书写简单、直白的js代码</li>
<li>通过js代码生成html页面</li>
</ul>
<p>ejs模板引擎中标签主要形式</p>
<ul>
<li><code>&lt;%</code>：脚本标签，用于流程控制输出</li>
<li><code>%&gt;</code>：一般结束标签</li>
<li><code>&lt;%_</code>：删除前面的空格符</li>
<li><code>&lt;%=</code>：输出数据到模板，输出的是转义HTML标签</li>
<li><code>&lt;%-</code>：输出非转义的数据到模板</li>
<li><code>&lt;%#</code>：注释标签，不执行，不输出内容</li>
<li><code>&lt;%%</code>：输出字符串<code>&lt;%</code></li>
<li><code>-%&gt;</code>：删除紧随其后的换行符</li>
<li><code>_%&gt;</code>：将结束标签后面的空格符删除</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs ejs">&lt;%if(user)&#123;%&gt;<br>	&lt;h2&gt;&lt;%&#x3D; user.name%&gt;&lt;&#x2F;h2&gt;<br>&lt;%&#125;%&gt;<br></code></pre></td></tr></table></figure>

<h4 id="ejs中的包含include"><a href="#ejs中的包含include" class="headerlink" title="ejs中的包含include"></a>ejs中的包含include</h4><p>include命令：将相对于模板路径包含进来。</p>
<p>案例：有<code>./views/user.ejs</code>和<code>./views/user.show.ejs</code>两个模板</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs ejs">&lt;ul&gt;<br>    &lt;% users.forEach(function(user))&#123; %&gt;<br>    &lt;%- include(&#39;user&#x2F;show&#39;,&#123;user: user&#125;); %&gt;<br>    &lt;% &#125;);%&gt;<br>&lt;&#x2F;ul&gt;<br></code></pre></td></tr></table></figure>

<h4 id="实操"><a href="#实操" class="headerlink" title="实操"></a>实操</h4><p>安装：<code>npm install ejs</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">var</span> ejs = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;ejs&quot;</span>);<br><br><span class="hljs-keyword">var</span> people = [<span class="hljs-string">&quot;geddy&quot;</span>, <span class="hljs-string">&quot;neil&quot;</span>, <span class="hljs-string">&quot;alex&quot;</span>];<br><span class="hljs-keyword">var</span> html = ejs.render(<span class="hljs-string">&quot;&lt;%= people.join(&#x27;,&#x27;)%&gt;&quot;</span>, &#123; people &#125;);<br><span class="hljs-built_in">console</span>.log(html);<br></code></pre></td></tr></table></figure>

<figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs crmsh"><span class="hljs-keyword">node</span> <span class="hljs-title">index</span>.js<br></code></pre></td></tr></table></figure>

<h3 id="7-3-在Express框架中集成模板引擎"><a href="#7-3-在Express框架中集成模板引擎" class="headerlink" title="7.3 在Express框架中集成模板引擎"></a>7.3 在Express框架中集成模板引擎</h3><h4 id="pug集成"><a href="#pug集成" class="headerlink" title="pug集成"></a>pug集成</h4><ul>
<li><p>搭建项目环境，安装依赖</p>
<figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver">express <span class="hljs-built_in">folder</span><br>cd <span class="hljs-built_in">folder</span><br>npm install<br></code></pre></td></tr></table></figure>
</li>
<li><p>安装第三方中间件</p>
<figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ada">npm install pug <span class="hljs-comment">--save</span><br></code></pre></td></tr></table></figure>
</li>
<li><p>编码运行</p>
</li>
<li><p>常见报错：</p>
<figure class="highlight subunit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs subunit"><span class="hljs-keyword">Error: </span>Failed to lookup view &quot;error&quot; in views directory<br></code></pre></td></tr></table></figure>

<p>你当前渲染的pug有错误</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs pug">doctype html<br>html<br>    head<br>        meta(charset&#x3D;&#39;utf-8&#39;)<br>        title &#x3D; &quot;商品页面（pug）&quot;<br>    body<br>        ul.goods<br>            each val in goods<br>                li <br>                    img(src&#x3D;val.img alt&#x3D;&quot;找不到图片！&quot;)<br>                    .title #&#123;val.title&#125;<br>                    .price #[span(style&#x3D;&quot;color:red;&quot;) #&#123;val.price&#125;] 元<br></code></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// view engine setup</span><br>app.set(<span class="hljs-string">&quot;views&quot;</span>, path.join(__dirname, <span class="hljs-string">&quot;views&quot;</span>));<br>app.set(<span class="hljs-string">&quot;view engine&quot;</span>, <span class="hljs-string">&quot;pug&quot;</span>);<br><span class="hljs-comment">// 数据略</span><br>app.get(<span class="hljs-string">&quot;/pug&quot;</span>, <span class="hljs-function">(<span class="hljs-params">req, res, next</span>) =&gt;</span> &#123;<br>	res.render(<span class="hljs-string">&quot;goods.pug&quot;</span>, &#123; goods &#125;);<br>&#125;);<br></code></pre></td></tr></table></figure>

<h4 id="ejs集成"><a href="#ejs集成" class="headerlink" title="ejs集成"></a>ejs集成</h4><ul>
<li><p>指定视图为ejs</p>
<p><code>express -view=ejs expressAppName</code></p>
<p>指定视图后，在安装依赖包时会自动下载第三方中间件</p>
</li>
<li><p>设置视图引擎</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 设置模板文件路径</span><br>app.set(<span class="hljs-string">&#x27;views&#x27;</span>, path.join(__dirname, <span class="hljs-string">&#x27;views&#x27;</span>));<br><br><span class="hljs-comment">// 设置视图模板的默认后缀为ejs，不用每次都输入文件的后缀名</span><br><br>app.set(<span class="hljs-string">&#x27;view engine&#x27;</span>, <span class="hljs-string">&#x27;ejs&#x27;</span>);<br></code></pre></td></tr></table></figure>

</li>
</ul>
<p><code>views/formu.ejs</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs ejs">&lt;!DOCTYPE html&gt;<br>&lt;html&gt;<br><br>&lt;head&gt;<br>    &lt;title&gt;<br>        &lt;%&#x3D; title %&gt;<br>    &lt;&#x2F;title&gt;<br>    &lt;link rel&#x3D;&#39;stylesheet&#39; href&#x3D;&#39;&#x2F;stylesheets&#x2F;style.css&#39; &#x2F;&gt;<br>&lt;&#x2F;head&gt;<br><br>&lt;body&gt;<br>    &lt;h1&gt;<br>        &lt;%&#x3D; title %&gt;<br>    &lt;&#x2F;h1&gt;<br>    &lt;p&gt;Welcome to &lt;%&#x3D; title %&gt;<br>    &lt;&#x2F;p&gt;<br><br>    &lt;% if(items)&#123;%&gt;<br>        &lt;% items.forEach((val)&#x3D;&gt;&#123; %&gt;<br>            &lt;ul&gt;<br>                &lt;li&gt;<br>                    &lt;%&#x3D;val.name%&gt;<br>                &lt;&#x2F;li&gt;<br>                &lt;li&gt;<br>                    &lt;%&#x3D;val.message%&gt;<br>                &lt;&#x2F;li&gt;<br>            &lt;&#x2F;ul&gt;<br>            &lt;% &#125;)&#125; %&gt;<br>&lt;&#x2F;body&gt;<br><br>&lt;&#x2F;html&gt;<br></code></pre></td></tr></table></figure>

<p><code>router/formu.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">let</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;express&quot;</span>);<br><span class="hljs-keyword">let</span> router = express.Router();<br><br><span class="hljs-keyword">var</span> items = [<br>	&#123; <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;张加林&quot;</span>, <span class="hljs-attr">message</span>: <span class="hljs-string">&quot;loveme&quot;</span> &#125;,<br>	&#123; <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;略略略&quot;</span>, <span class="hljs-attr">message</span>: <span class="hljs-string">&quot;这么刘啊！&quot;</span> &#125;,<br>];<br>router.get(<span class="hljs-string">&quot;/formu&quot;</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;<br>	res.render(<span class="hljs-string">&quot;formu&quot;</span>, &#123; <span class="hljs-attr">title</span>: <span class="hljs-string">&quot;论坛&quot;</span>, <span class="hljs-attr">items</span>: items &#125;);<br>&#125;);<br><br><span class="hljs-built_in">module</span>.exports = router;<br></code></pre></td></tr></table></figure>

<p>app.js中引入路由即可！</p>
<p>思考以下ejs代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs ejs">&lt;ul class&#x3D;&quot;goods&quot;&gt;<br>    &lt;% data.forEach(function(item)&#123;%&gt;<br>    &lt;li&gt;<br>        &lt;img src&#x3D;&lt;%&#x3D;item.img%&gt; alt&#x3D;&lt;%&#x3D;item.title%&gt;&gt;<br>        &lt;div class&#x3D;&quot;title&quot;&gt;&lt;%&#x3D;item.title%&gt;&lt;&#x2F;div&gt;<br>        &lt;div class&#x3D;&quot;price&quot;&gt;&lt;span&gt;&lt;%&#x3D;item.price%&gt;&lt;&#x2F;span&gt;元&lt;&#x2F;div&gt;<br>    &lt;&#x2F;li&gt;<br>    &lt;% &#125;) %&gt;<br>&lt;&#x2F;ul&gt;<br></code></pre></td></tr></table></figure>



<h3 id="7-4-扩展知识"><a href="#7-4-扩展知识" class="headerlink" title="7.4 扩展知识"></a>7.4 扩展知识</h3><h4 id="windows上使用第三方包升级Node"><a href="#windows上使用第三方包升级Node" class="headerlink" title="windows上使用第三方包升级Node"></a>windows上使用第三方包升级Node</h4><p><code>npm install nvmw -g</code>，一款针对windows的node版本管理工具</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs shell">nvmw install &lt;version&gt;<br><br>// 切换版本<br>nvmw use &lt;version&gt;<br><br>// 我的历史版本<br>v12.8.3<br><br>//当前最新<br>v16.4.0<br></code></pre></td></tr></table></figure>

<p>切换命令执行成功，但是就是node版本不变，可能是配置了环境变量（显示是system version），貌似需要改环境变量。</p>
<h2 id="第八章-数据库"><a href="#第八章-数据库" class="headerlink" title="第八章 数据库"></a>第八章 数据库</h2><h3 id="8-1-mysql"><a href="#8-1-mysql" class="headerlink" title="8.1 mysql"></a>8.1 mysql</h3><p>mysql是多线程数据库，每一个应用会话连接到数据库时，会创建一个用户线程，调用对应的数据库连接对象connection完成sql的操作。</p>
<p>安装中间件：<code>npm install mysql</code></p>
<p>使用数据库连接池：</p>
<p><code>db.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 连接数据库文件</span><br><span class="hljs-comment"> * */</span><br><span class="hljs-built_in">module</span>.exports = &#123;<br>	mysql: &#123;<br>		host: <span class="hljs-string">&quot;localhost&quot;</span>, <span class="hljs-comment">// 主机</span><br>		user: <span class="hljs-string">&quot;root&quot;</span>, <span class="hljs-comment">// 用户名</span><br>		password: <span class="hljs-string">&quot;zhulan&quot;</span>,<br>		database: <span class="hljs-string">&quot;sumodemo&quot;</span>,<br>		port: <span class="hljs-string">&quot;3306&quot;</span>, <span class="hljs-comment">// mysql链接端口</span><br>		connectTimeout: <span class="hljs-number">5000</span>, <span class="hljs-comment">//连接超时</span><br>		multipleStatements: <span class="hljs-literal">false</span>, <span class="hljs-comment">//是否允许一个query中包含多条sql语句</span><br>		connectionLimit: <span class="hljs-number">5</span>, <span class="hljs-comment">// 数据库连接池大小</span><br>		timezone: <span class="hljs-string">&quot;08:00&quot;</span>,<br>	&#125;,<br>&#125;;<br><br></code></pre></td></tr></table></figure>

<p>创建连接初始化</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">let</span> mysql = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;mysql&quot;</span>);<br><span class="hljs-keyword">let</span> config = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;./db.js&quot;</span>);<br><br><span class="hljs-keyword">let</span> pool = mysql.createPool(config.mysql);<br><br>pool.getConnection(<span class="hljs-function">(<span class="hljs-params">err, connection</span>) =&gt;</span> &#123;<br>	<span class="hljs-keyword">if</span> (err) <span class="hljs-keyword">return</span> <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&quot;数据库连接失败&quot;</span> + err);<br>	<span class="hljs-keyword">return</span> <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&quot;数据库连接成功&quot;</span>, connection.threadId);<br>&#125;);<br><br><span class="hljs-built_in">module</span>.exports = pool;<br></code></pre></td></tr></table></figure>

<p>执行sql语句</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs js">mysqlPool.query(commentSql.historyComments, <span class="hljs-function">(<span class="hljs-params">err, results</span>) =&gt;</span> &#123;<br>    <span class="hljs-keyword">if</span> (err)<br>        res.status(<span class="hljs-number">500</span>).json(&#123;<br>            err: err.message,<br>        &#125;);<br>    <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-built_in">console</span>.log(results);<br>        res.status(<span class="hljs-number">200</span>).json(results.reverse());<br>    &#125;<br>&#125;);<br></code></pre></td></tr></table></figure>

<h3 id="8-2-MongoDB"><a href="#8-2-MongoDB" class="headerlink" title="8.2 MongoDB"></a>8.2 MongoDB</h3><p><a href="https://db-engines.com/en/ranking">DB-Engines Ranking - popularity ranking of database management systems</a></p>
<p>安装</p>
<p>配置</p>
<ul>
<li><p>设置环境变量</p>
</li>
<li><p>创建数据库文件夹db &amp; log</p>
</li>
<li><p>设置数据库保存位置</p>
</li>
<li><p>将mongodb安装为windows服务，自动启动mongodb服务</p>
</li>
</ul>
<p>启动</p>
<p>cmd窗口下：mongo</p>
<h3 id="8-3-mongoDB基本操作"><a href="#8-3-mongoDB基本操作" class="headerlink" title="8.3 mongoDB基本操作"></a>8.3 mongoDB基本操作</h3><h3 id="8-4-mongoose数据库操作"><a href="#8-4-mongoose数据库操作" class="headerlink" title="8.4 mongoose数据库操作"></a>8.4 mongoose数据库操作</h3><h4 id="mongoose简介"><a href="#mongoose简介" class="headerlink" title="mongoose简介"></a>mongoose简介</h4><p>node.js依赖mongoose模块对MongoDB进行操作</p>
<h2 id="第九章-Koa框架"><a href="#第九章-Koa框架" class="headerlink" title="第九章 Koa框架"></a>第九章 Koa框架</h2><h3 id="9-1-koa框架简介"><a href="#9-1-koa框架简介" class="headerlink" title="9.1 koa框架简介"></a>9.1 koa框架简介</h3><p>下一代Node.js WEB框架</p>
<h4 id="koa与express的区别"><a href="#koa与express的区别" class="headerlink" title="koa与express的区别"></a>koa与express的区别</h4><ul>
<li><p>Express是第一代最流行的Web框架，作为两个框架中最早诞生者，经过长时间的发展完善，Express非常为成熟，资料丰富。</p>
</li>
<li><p>Koa是下一代的Node.js的Web框架，由Express团队设计，旨在提供一个更小型、更富有表现力、更可靠的Web应用和API的开发框架。</p>
</li>
<li><p>Express的团队基于ES6的Generator编写。</p>
<p>免除重复繁琐的回调函数嵌套，极大地提升错误处理效率。</p>
<p>不断追随ECMAScript规范，解决Express痛点，从一代Generator函数到二代Async/Await，备受青睐。</p>
<p>Koa轻量简洁、表达力强、自由度高，容易定制。</p>
</li>
</ul>
<h4 id="koa框架的简单应用"><a href="#koa框架的简单应用" class="headerlink" title="koa框架的简单应用"></a>koa框架的简单应用</h4><p>Koa框架所有功能通过中间件实现，目前有1.x和2.0两个版本。</p>
<p><img src="https://gitee.com/zhangjialin_zhulan/myimagerepo/raw/master/images/image-20220320180338632.png" srcset="/img/loading.gif" lazyload alt="image-20220320180338632"></p>
<ul>
<li>koa支持context传递数据，采用洋葱模型进行顺序执行，出去反向执行。</li>
<li>express本身无洋葱模型，需要引入插件；不支持context</li>
</ul>
<h5 id="koa核心概念"><a href="#koa核心概念" class="headerlink" title="koa核心概念"></a>koa核心概念</h5><p><img src="https://gitee.com/zhangjialin_zhulan/myimagerepo/raw/master/images/image-20220320180556154.png" srcset="/img/loading.gif" lazyload alt="image-20220320180556154"></p>
<ul>
<li><p>koa最主要的应用是实现http协议的处理，有四个核心概念：</p>
<ul>
<li><p>Application：主程序</p>
<p>koa的全局应用对象，有且仅有一个，在应用启动时被创建。</p>
</li>
<li><p>Context：请求上下文</p>
<p>请求级别的对象，每次请求生成一个context实例，通常简写为<code>ctx</code>。</p>
</li>
<li><p>Request：请求</p>
<p>请求级别的对象，提供大量请求相关的方法以供使用。</p>
</li>
<li><p>Response：相应</p>
<p>请求级别的对象，提供大量相应相关的方法。</p>
</li>
</ul>
</li>
</ul>
<h5 id="express与koa语法对比"><a href="#express与koa语法对比" class="headerlink" title="express与koa语法对比"></a>express与koa语法对比</h5><table>
<thead>
<tr>
<th><strong>功能</strong></th>
<th><strong>Express</strong></th>
<th><strong>Koa</strong></th>
</tr>
</thead>
<tbody><tr>
<td>初始化</td>
<td>const app = express()</td>
<td>const app = new koa()</td>
</tr>
<tr>
<td>实例化路由</td>
<td>const router = express.Router()</td>
<td>const router = Router()</td>
</tr>
<tr>
<td>app级别中间件</td>
<td>app.use</td>
<td>app.use</td>
</tr>
<tr>
<td>路由级别中间件</td>
<td>router.get</td>
<td>router.get</td>
</tr>
<tr>
<td>路由中间件挂载</td>
<td>app.use(‘/‘,router)</td>
<td>app.use(router.routes())</td>
</tr>
<tr>
<td>监听端口</td>
<td>app.listen(3000)</td>
<td>app.listen(3000)</td>
</tr>
</tbody></table>
<h5 id="中间件"><a href="#中间件" class="headerlink" title="中间件"></a>中间件</h5><p><img src="https://gitee.com/zhangjialin_zhulan/myimagerepo/raw/master/images/image-20220320182045720.png" srcset="/img/loading.gif" lazyload alt="image-20220320182045720"></p>
<ul>
<li><p>异步</p>
<p>koa2完全使用Promise并配合async来实现异步</p>
</li>
<li><p>中间件</p>
<p>每个async函数称为中间件，默认接收两个参数：Context对象和next函数。</p>
</li>
<li><p>next()函数</p>
<p>只要调用next()函数就可以将执行权转交给下一个中间件。</p>
</li>
<li><p>堆栈展开</p>
<p><strong>当在下游没有更多中间件执行后，堆栈将展开并且每个中间件恢复执行其上游行为。</strong></p>
</li>
</ul>
<p>案例</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> koa = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;koa&quot;</span>);<br><span class="hljs-keyword">const</span> app = <span class="hljs-keyword">new</span> koa();<br><br><span class="hljs-keyword">const</span> M1 = <span class="hljs-keyword">async</span> (ctx, next) =&gt; &#123;<br>	ctx.type = <span class="hljs-string">&quot;text/html&quot;</span>;<br>	<span class="hljs-keyword">await</span> next();<br>	ctx.body = ctx.body + <span class="hljs-string">&quot;m1&quot;</span>;<br>&#125;;<br><span class="hljs-keyword">const</span> M2 = <span class="hljs-keyword">async</span> (ctx, next) =&gt; &#123;<br>	ctx.body = <span class="hljs-string">&quot;Hi, &quot;</span>;<br>	<span class="hljs-keyword">await</span> next();<br>	ctx.body = ctx.body + <span class="hljs-string">&quot;m2&quot;</span>;<br>&#125;;<br><span class="hljs-keyword">const</span> M3 = <span class="hljs-keyword">async</span> (ctx, next) =&gt; &#123;<br>	ctx.body = ctx.body + <span class="hljs-string">&quot;class!&quot;</span>;<br>	<span class="hljs-keyword">await</span> next();<br>	ctx.body = ctx.body + <span class="hljs-string">&quot;m3&quot;</span>;<br>&#125;;<br><br>app.use(M1);<br>app.use(M2);<br>app.use(M3);<br>app.listen(<span class="hljs-number">3000</span>);<br><br></code></pre></td></tr></table></figure>

<p>输出：</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">Hi</span>, class!m<span class="hljs-number">3</span>m<span class="hljs-number">2</span>m<span class="hljs-number">1</span><br></code></pre></td></tr></table></figure>

<h3 id="9-2-应用程序和上下文"><a href="#9-2-应用程序和上下文" class="headerlink" title="9.2 应用程序和上下文"></a>9.2 应用程序和上下文</h3><h4 id="语法糖syntactic-sugar"><a href="#语法糖syntactic-sugar" class="headerlink" title="语法糖syntactic sugar"></a>语法糖syntactic sugar</h4><p>英国计算机科学家彼得·约翰·兰达（Peter J. Landin）计算机语言中添加的某种语法，更方便程序员使用。</p>
<p>优点：对语言的功能并没有影响，更方便程序员使用，增加程序的可读性，从而减少程序代码出错的机会。</p>
<p>koa中的语法糖：async/await是专门为异步操作设计的基于Generator函数的语法糖。</p>
<h4 id="Http服务"><a href="#Http服务" class="headerlink" title="Http服务"></a>Http服务</h4><p>Koa将Node.js中的request和response对象都封装到了上下文(Context)中，每次请求都会创建一个ctx。</p>
<h4 id="上下文Context"><a href="#上下文Context" class="headerlink" title="上下文Context"></a>上下文Context</h4><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs json">&#123;<br>  request: &#123;<br>    method: &#x27;GET&#x27;,<br>    url: &#x27;/&#x27;,<br>    header: &#123;<br>      host: &#x27;localhost:3000&#x27;,<br>      connection: &#x27;keep-alive&#x27;,<br>      &#x27;sec-ch-ua&#x27;: &#x27;&quot; Not A;Brand&quot;;v=&quot;99&quot;, &quot;Chromium&quot;;v=&quot;99&quot;, &quot;Microsoft Edge&quot;;v=&quot;99&quot;&#x27;,<br>      &#x27;sec-ch-ua-mobile&#x27;: &#x27;?0&#x27;,<br>      &#x27;sec-ch-ua-platform&#x27;: &#x27;&quot;Windows&quot;&#x27;,<br>      &#x27;upgrade-insecure-requests&#x27;: &#x27;1&#x27;,<br>      &#x27;user-agent&#x27;: &#x27;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/99.0.4844.74 Safari/537.36 Edg/99.0.1150.46&#x27;,<br>      accept: &#x27;text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9&#x27;,<br>      &#x27;sec-fetch-site&#x27;: &#x27;none&#x27;,<br>      &#x27;sec-fetch-mode&#x27;: &#x27;navigate&#x27;,<br>      &#x27;sec-fetch-user&#x27;: &#x27;?1&#x27;,<br>      &#x27;sec-fetch-dest&#x27;: &#x27;document&#x27;,<br>      &#x27;accept-encoding&#x27;: &#x27;gzip, deflate, br&#x27;,<br>      &#x27;accept-language&#x27;: &#x27;zh-CN,zh;q=0.9,en;q=0.8,en-GB;q=0.7,en-US;q=0.6&#x27;,<br>      cookie: &#x27;Hm_lvt_e71cddb60357a788e6ed79bca37db76d=1646641982,1647689532&#x27;<br>    &#125;<br>  &#125;,<br>  response: &#123;<br>    status: 404,<br>    message: &#x27;Not Found&#x27;,<br>    header: [Object: null prototype] &#123;<br>      &#x27;content-type&#x27;: &#x27;text/html; charset=utf-8&#x27;<br>    &#125;<br>  &#125;,<br>  app: &#123; subdomainOffset: 2, proxy: false, env: &#x27;development&#x27; &#125;,<br>  originalUrl: &#x27;/&#x27;,<br>  req: &#x27;&lt;original node req&gt;&#x27;,<br>  res: &#x27;&lt;original node res&gt;&#x27;,<br>  socket: &#x27;&lt;original node socket&gt;&#x27;<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="9-3-koa路由"><a href="#9-3-koa路由" class="headerlink" title="9.3 koa路由"></a>9.3 koa路由</h3><p>路由中间件与动态路由：路由（Route）根据监听前端发来的URL进行判断，通过识别请求的方法（GET、POST、PUT等）和请求的具体路径（path），来执行相应的代码，进行不同的处理。</p>
<p>koa-router路由中间件引入与使用：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 安装 npm install koa-router -S</span><br><span class="hljs-comment">// 加载</span><br><span class="hljs-keyword">const</span> router = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;koa-router&#x27;</span>);<br><br><span class="hljs-comment">//识别请求，设置请求路径，匹配逻辑</span><br>router.get|post|put|<span class="hljs-keyword">delete</span>(<span class="hljs-string">&#x27;/&#x27;</span>,<span class="hljs-keyword">async</span>(context, next)=&gt;&#123;&#125;);<br></code></pre></td></tr></table></figure>

<p>案例</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> koa = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;koa&quot;</span>);<br><span class="hljs-keyword">const</span> Router = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;koa-router&quot;</span>);<br><span class="hljs-keyword">const</span> router = <span class="hljs-keyword">new</span> Router();<br><span class="hljs-keyword">const</span> app = <span class="hljs-keyword">new</span> koa();<br><br>router.get(<span class="hljs-string">&quot;/&quot;</span>, <span class="hljs-keyword">async</span> (ctx, next) =&gt; &#123;<br>	ctx.body = <span class="hljs-string">&quot;主页&quot;</span>;<br>&#125;);<br><br>router.get(<span class="hljs-string">&quot;/news&quot;</span>, <span class="hljs-keyword">async</span> (ctx, next) =&gt; &#123;<br>	ctx.body = <span class="hljs-string">&quot;新闻&quot;</span>;<br>&#125;);<br><br>router.get(<span class="hljs-string">&quot;/author/:name&quot;</span>, <span class="hljs-keyword">async</span> (ctx, next) =&gt; &#123;<br>	<span class="hljs-keyword">const</span> name = ctx.params.name;<br>	ctx.body = <span class="hljs-string">&quot;作者为：&quot;</span> + name;<br>&#125;);<br><br>app.use(router.routes());<br>app.use(router.allowedMethods);<br><br>app.listen(<span class="hljs-number">3000</span>, <span class="hljs-function">() =&gt;</span> &#123;<br>	<span class="hljs-built_in">console</span>.log(<span class="hljs-string">&quot;服务已启动~~~&quot;</span>);<br>&#125;);<br></code></pre></td></tr></table></figure>

<h3 id="9-4-静态访问资源"><a href="#9-4-静态访问资源" class="headerlink" title="9.4 静态访问资源"></a>9.4 静态访问资源</h3><h4 id="静态资源"><a href="#静态资源" class="headerlink" title="静态资源"></a>静态资源</h4><p>静态资源：指不需要程序处理、不需要查数据库直接就能够显示的页面资源。多次访问，源代码不变，访问效率高。（比如：html、js、css、json、图片等）</p>
<p>动态资源：指需要程序处理或者从数据库中读数据，能够根据不同的条件在页面显示不同的数据。</p>
<p>动静分离：将静态资源与后台应用分开部署，提高用户访问静态代码的速度，降低对后台应用访问负担。</p>
<p>读取文件：对于一张图片而言，对于URL <code>http://127.0.0.1/0.jpg</code>，那么服务器端需要通过读取文件的方式，客户端才能请求到图片资源，如果网页中含有多张图片，这样读取很麻烦。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">if</span>(req.url==<span class="hljs-string">&quot;/0.jpg&quot;</span>)&#123;<br>  fs.readFile(<span class="hljs-string">&quot;./0.jpg&quot;</span>,<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err,data</span>)</span>&#123;<br>res.end(data);<br>&#125;)<br></code></pre></td></tr></table></figure>

<h4 id="koa-static模块"><a href="#koa-static模块" class="headerlink" title="koa-static模块"></a>koa-static模块</h4><p>封装了网站静态资源的请求，可以用来搭建静态资源服务器，实现复杂路由加载静态资源，省去需要从本地目录读取文件的很多步骤。</p>
<p>安装：<code>npm install koa-static</code></p>
<p>加载：<code>const server = require(&#39;koa-static&#39;);</code></p>
<p>设置静态文件：<code>app.use(server(path.join(__dirname),&#39;./public&#39;));</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> Koa = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;koa&quot;</span>);<br><span class="hljs-keyword">const</span> app = <span class="hljs-keyword">new</span> Koa();<br><span class="hljs-keyword">const</span> server = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;koa-static&quot;</span>);<br><span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;path&quot;</span>);<br><br><span class="hljs-comment">// 设置dist文件夹为静态资源文件夹 ./dist/x1.png</span><br>app.use(server(path.join(__dirname, <span class="hljs-string">&quot;./dist&quot;</span>)));<br><br><span class="hljs-comment">// http://localhost:3000/x1.png请求</span><br>app.listen(<span class="hljs-number">3000</span>);<br></code></pre></td></tr></table></figure>

<h3 id="9-5-补充"><a href="#9-5-补充" class="headerlink" title="9.5 补充"></a>9.5 补充</h3><h4 id="params参数和query参数"><a href="#params参数和query参数" class="headerlink" title="params参数和query参数"></a>params参数和query参数</h4><h5 id="VueRouter"><a href="#VueRouter" class="headerlink" title="VueRouter"></a>VueRouter</h5><p>传参是前端经常需要用的一个操作，很多场景都会需要用到上个页面的参数，比如传个id获取个详情信息，今天咱们就来看看Vue中是怎么实现这种传递参数得</p>
<p>在Vue中提供了两种方法来进行路由传参：query 和 params ，下面来看看他们两个得区别在哪里</p>
<p>query语法：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-built_in">this</span>.$router.push(&#123;<span class="hljs-attr">path</span>:<span class="hljs-string">&quot;地址&quot;</span>,<span class="hljs-attr">query</span>:&#123;<span class="hljs-attr">id</span>:<span class="hljs-string">&quot;123&quot;</span>&#125;&#125;); <span class="hljs-comment">// 这是传递参数</span><br><span class="hljs-built_in">this</span>.$route.query.id； <span class="hljs-comment">// 这是接受参数</span><br></code></pre></td></tr></table></figure>

<p>params语法：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-built_in">this</span>.$router.push(&#123;<span class="hljs-attr">name</span>:<span class="hljs-string">&quot;地址&quot;</span>,<span class="hljs-attr">params</span>:&#123;<span class="hljs-attr">id</span>:<span class="hljs-string">&quot;123&quot;</span>&#125;&#125;); <span class="hljs-comment">// 这是传递参数</span><br><span class="hljs-built_in">this</span>.$route.params.id; <span class="hljs-comment">// 这是接受参数</span><br></code></pre></td></tr></table></figure>

<p>以上就是这两种方法得语法，那大家也能从中看出一点区别：</p>
<p>1.首先就是写法得不同，query 的写法是 用 path 来编写传参地址，而 params 得写法是用 name 来编写传参地址，你可以看一下编写路由时候得相关属性，你也可以输出一下 路由对象信息 看一下。</p>
<p>2.接收方法不同， 一个用 query 来接收， 一个用 params 接收 ，总结就是谁发得谁去接收。</p>
<p>3.query 在刷新页面得时候参数不会消失，而 params 刷新页面得时候会参数消失，可以考虑本地存储解决。</p>
<p>4.query 传得参数都是显示在url 地址栏当中，而 params 传参不会显示在地址栏。这里说一下 route 是路由对象信息 而 router 是路由对象的实例，区分一下。</p>
<h5 id="Node"><a href="#Node" class="headerlink" title="Node"></a>Node</h5><p>在后端中，要接受前端的<code>axios</code>请求，于是我们又会接触到了query、params。</p>
<p>什么样的<code>axios</code>请求对应什么样的接受方式？<br>还有不止是<code>req.query</code>,<code>req.params</code>,还多了<code>req.body</code></p>
<p>假设前端现在用axios向后端发送一个请求，发送id值请求后端的数据。</p>
<ul>
<li><p>req.query</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js">axios.get(<span class="hljs-string">`/api/?id=1234`</span>)<br></code></pre></td></tr></table></figure>

<p>或者</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js">axios.get(<span class="hljs-string">`/api`</span>，&#123; <span class="hljs-attr">params</span>:&#123;<span class="hljs-attr">id</span>:<span class="hljs-string">&#x27;1234&#x27;</span> &#125;)<br></code></pre></td></tr></table></figure>

<p>在前端里面，<code>router</code>怎么发送的就怎么收</p>
<ul>
<li><code>query</code>发送的就用<code>this.$route.query</code>接收</li>
<li><code>params</code>发送的就用<code>this.$route.params</code>接收</li>
</ul>
<p>但在这里，虽然第二种方式里面有<code>params</code>，但这两种我们都要用<code>req.query.id</code>来获取里面的<code>id</code>值</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs js">router.get(<span class="hljs-string">&#x27;/api&#x27;</span>,<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">req,res</span>)</span>&#123;<br><span class="hljs-built_in">console</span>.log(req.query.id)<br>.......<br>&#125;);<br></code></pre></td></tr></table></figure>
</li>
<li><p>req.params</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 后端</span><br>router.get(<span class="hljs-string">&#x27;/api/:id&#x27;</span>,<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">req,res</span>)</span>&#123;<br>    <span class="hljs-built_in">console</span>.log(req.params.id);<br>    .......<br>&#125;);<br><span class="hljs-comment">// 多个params参数</span><br>router.get(<span class="hljs-string">&#x27;/api/:id-:age&#x27;</span>,<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">req,res</span>)</span>&#123;<br>    <span class="hljs-built_in">console</span>.log(req.params.id);<br>    <span class="hljs-built_in">console</span>.log(req.params.age);<br>    .......<br>    &#125;)<br><br><span class="hljs-comment">// 前端axios</span><br>axios.get(<span class="hljs-string">`/api/1234`</span>);<br><br><span class="hljs-comment">// 多个params参数</span><br>axios.get(<span class="hljs-string">`/api/1234-12`</span>);<br></code></pre></td></tr></table></figure>
</li>
<li><p>req.body</p>
<p>上面两个都是处理<code>get</code>请求的，而<code>req.body</code>就是用来处理<code>post</code>请求的。(需要安装<code>body-parser</code>中间件）</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 请求</span><br>axios.post(<span class="hljs-string">`/api`</span>,&#123; <span class="hljs-attr">id</span>:<span class="hljs-string">&#x27;1234&#x27;</span> &#125;);<br><br><span class="hljs-comment">// 路由</span><br>router.get(<span class="hljs-string">&#x27;/api&#x27;</span>,<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">req,res</span>)</span>&#123;<br><span class="hljs-built_in">console</span>.log(req.body.id)<br>.......<br>&#125;)<br></code></pre></td></tr></table></figure>

</li>
</ul>
<h4 id="访问存放在dist中的静态页面"><a href="#访问存放在dist中的静态页面" class="headerlink" title="访问存放在dist中的静态页面"></a>访问存放在dist中的静态页面</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 允许返回本地静态资源</span><br>app.use(express.static(<span class="hljs-string">&quot;public&quot;</span>));<br><br>app.use(express.static(path.join(__dirname, <span class="hljs-string">&quot;./dist&quot;</span>))); <span class="hljs-comment">// 允许访问dist资源</span><br></code></pre></td></tr></table></figure>

<p>注意：在浏览器输入<code>http://localhost:port</code>，node服务器会自动加载静态资源，默认访问index.html文件！</p>
<h2 id="第十章-打包部署发布"><a href="#第十章-打包部署发布" class="headerlink" title="第十章 打包部署发布"></a>第十章 打包部署发布</h2><h3 id="10-1-webpack压缩打包"><a href="#10-1-webpack压缩打包" class="headerlink" title="10.1 webpack压缩打包"></a>10.1 webpack压缩打包</h3><p><a href="https://webpack.docschina.org/concepts/">概念 | webpack 中文文档 (docschina.org)</a></p>
<p><strong>webpack</strong> 是一个用于现代 JavaScript 应用程序的 <strong>静态模块打包工具</strong>，将各种存在依赖关系的模块打包成静态可用资源。</p>
<p>会递归地构建一个依赖关系图，其中包含应用程序所需地所有模块，然后将所有模块打包成一个或多个bundle文件。</p>
<h4 id="安装webpack"><a href="#安装webpack" class="headerlink" title="安装webpack"></a>安装webpack</h4><p>全局安装<code>npm i -g webpack</code></p>
<p>说明：如果使用的是webpack 4+，那么还需要安装CLI</p>
<p><code>npm i -g webpack-cli</code></p>
<p>局部安装去除<code>-g</code>即可</p>
<p>查看全局安装版本：<code>webpack -v</code></p>
<p>查看局部安装版本：<code>npx webpack -v</code>/<code>npm info webpack</code></p>
<h4 id="使用webpack打包"><a href="#使用webpack打包" class="headerlink" title="使用webpack打包"></a>使用webpack打包</h4><ul>
<li><p>创建<code>module.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-built_in">module</span>.exports = (<br>	sayHello: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>&#123;<br>    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&quot;hello world!&quot;</span>)<br>&#125;<br>)<br></code></pre></td></tr></table></figure>
</li>
<li><p>创建<code>main.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">var</span> mymodule = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;./module.js&#x27;</span>);<br>mymodule.sayHello();<br></code></pre></td></tr></table></figure>
</li>
<li><p>创建<code>webpack.config.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-built_in">module</span>.exports = &#123;<br>    entry: __dirname + <span class="hljs-string">&quot;/main.js&quot;</span>,<br>    output: &#123;<br>     path: __dirname, + <span class="hljs-string">&quot;/public&quot;</span><br>     filename: <span class="hljs-string">&quot;bundle.js&quot;</span>   <br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
</li>
<li><p>自动生成public文件夹，文件夹有：</p>
<ul>
<li><code>bundle.js</code></li>
<li><code>index.html</code></li>
<li><code>web.config</code></li>
</ul>
</li>
</ul>
<h3 id="10-2-服务器部署与发布"><a href="#10-2-服务器部署与发布" class="headerlink" title="10.2 服务器部署与发布"></a>10.2 服务器部署与发布</h3>
            </div>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                
                  <div class="post-meta">
                    <i class="iconfont icon-tags"></i>
                    
                      <a class="hover-with-bg" href="/tags/NodeJs/">NodeJs</a>
                    
                  </div>
                
              </div>
              
                <p class="note note-warning">
                  
                    灯火阑珊
                  
                </p>
              
              
                <div class="post-prevnext">
                  <article class="post-prev col-6">
                    
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2022/03/03/leetcode%E5%88%B7%E9%A2%98/">
                        <span class="hidden-mobile">Leetcode刷题日记</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
              <!-- Comments -->
              <article class="comments" id="comments" lazyload>
                
                  
                
                
  <script type="text/javascript">
    Fluid.utils.loadComments('#comments', function() {
      var light = 'github-light';
      var dark = 'github-dark-orange';
      var schema = document.documentElement.getAttribute('data-user-color-scheme');
      if (schema === 'dark') {
        schema = dark;
      } else {
        schema = light;
      }
      window.UtterancesThemeLight = light;
      window.UtterancesThemeDark = dark;
      var s = document.createElement('script');
      s.setAttribute('src', 'https://utteranc.es/client.js');
      s.setAttribute('repo', 'zhangjialin996/comments');
      s.setAttribute('issue-term', 'pathname');
      
      s.setAttribute('label', 'utterances');
      
      s.setAttribute('theme', schema);
      s.setAttribute('crossorigin', 'anonymous');
      document.getElementById('comments').appendChild(s);
    })
  </script>
  <noscript>Please enable JavaScript to view the comments</noscript>


              </article>
            
          </article>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p>
  <div class="toc-body" id="toc-body"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->


    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
    

    
  </main>

  <footer class="text-center mt-5 py-3">
  <div class="footer-content">
     <i class="iconfont icon-love" style="color: #8080ff"></i> <i class="iconfont icon-love" style="color: red"></i> <i class="iconfont icon-love" style="color: #8080ff"></i> 
  </div>
  
  <div class="statistics">
    
    

    
      
        <!-- 不蒜子统计PV -->
        <span id="busuanzi_container_site_pv" style="display: none">
            总访问量 
            <span id="busuanzi_value_site_pv"></span>
             次
          </span>
      
      
        <!-- 不蒜子统计UV -->
        <span id="busuanzi_container_site_uv" style="display: none">
            总访客数 
            <span id="busuanzi_value_site_uv"></span>
             人
          </span>
      
    
  </div>


  
  <!-- 备案信息 -->
  <div class="beian">
    <span>
      <a href="http://beian.miit.gov.cn/" target="_blank" rel="nofollow noopener">
        
      </a>
    </span>
    
  </div>


  
</footer>


  <!-- SCRIPTS -->
  
  <script  src="https://cdn.jsdelivr.net/npm/nprogress@0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress@0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js" ></script>
<script  src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>

<!-- Plugins -->


  
    <script  src="/js/img-lazyload.js" ></script>
  



  



  <script  src="https://cdn.jsdelivr.net/npm/tocbot@4/dist/tocbot.min.js" ></script>



  <script  src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3/dist/jquery.fancybox.min.js" ></script>



  <script  src="https://cdn.jsdelivr.net/npm/anchor-js@4/anchor.min.js" ></script>



  <script defer src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js" ></script>



  <script  src="/js/local-search.js" ></script>



  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>




  <script  src="https://cdn.jsdelivr.net/npm/typed.js@2/lib/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var title = document.getElementById('subtitle').title;
      
      typing(title)
      
    })(window, document);
  </script>












  
    <!-- Baidu Analytics -->
    <script defer>
      var _hmt = _hmt || [];
      (function () {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?e71cddb60357a788e6ed79bca37db76d";
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hm, s);
      })();
    </script>
  

  

  

  

  

  





<!-- 主题的启动项 保持在最底部 -->
<script  src="/js/boot.js" ></script>


</body>
</html>



<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/insert1.jfif">
  <link rel="icon" href="/img/insert2.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="description" content="监控原理和实现方案">
  <meta name="author" content="Mike Taylor">
  <meta name="keywords" content="我的博客">
  <meta name="description" content="监控原理和实现方案">
<meta property="og:type" content="article">
<meta property="og:title" content="视频监控解决方案">
<meta property="og:url" content="https://github.com/zhangjialin996/zhangjialin996.github.io/2021/09/08/%E8%A7%86%E9%A2%91%E7%9B%91%E6%8E%A7%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/index.html">
<meta property="og:site_name" content="Mike Taylor">
<meta property="og:description" content="监控原理和实现方案">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://gitee.com/zhangjialin_zhulan/myimagerepo/raw/master/images/image-20210908145426391.png">
<meta property="og:image" content="https://gitee.com/zhangjialin_zhulan/myimagerepo/raw/master/images/image-20210908145511213.png">
<meta property="og:image" content="https://gitee.com/zhangjialin_zhulan/myimagerepo/raw/master/images/image-20210908145651429.png">
<meta property="og:image" content="https://gitee.com/zhangjialin_zhulan/myimagerepo/raw/master/images/image-20210908145719395.png">
<meta property="og:image" content="https://gitee.com/zhangjialin_zhulan/myimagerepo/raw/master/images/image-20210908150025249.png">
<meta property="og:image" content="https://gitee.com/zhangjialin_zhulan/myimagerepo/raw/master/images/image-20210908150119639.png">
<meta property="og:image" content="https://gitee.com/zhangjialin_zhulan/myimagerepo/raw/master/images/image-20210908150731252.png">
<meta property="og:image" content="https://gitee.com/zhangjialin_zhulan/myimagerepo/raw/master/images/image-20210908150923388.png">
<meta property="og:image" content="https://gitee.com/zhangjialin_zhulan/myimagerepo/raw/master/images/image-20210908151037923.png">
<meta property="og:image" content="https://gitee.com/zhangjialin_zhulan/myimagerepo/raw/master/images/image-20210908151651153.png">
<meta property="og:image" content="https://gitee.com/zhangjialin_zhulan/myimagerepo/raw/master/images/image-20210908151748426.png">
<meta property="og:image" content="https://gitee.com/zhangjialin_zhulan/myimagerepo/raw/master/images/image-20210908152032330.png">
<meta property="og:image" content="https://gitee.com/zhangjialin_zhulan/myimagerepo/raw/master/images/image-20210908152417461.png">
<meta property="og:image" content="https://gitee.com/zhangjialin_zhulan/myimagerepo/raw/master/images/image-20210908152515775.png">
<meta property="og:image" content="https://gitee.com/zhangjialin_zhulan/myimagerepo/raw/master/images/image-20210908153419010.png">
<meta property="og:image" content="https://gitee.com/zhangjialin_zhulan/myimagerepo/raw/master/images/image-20210908153734411.png">
<meta property="og:image" content="https://gitee.com/zhangjialin_zhulan/myimagerepo/raw/master/images/image-20210908153820915.png">
<meta property="og:image" content="https://gitee.com/zhangjialin_zhulan/myimagerepo/raw/master/images/image-20210908154025600.png">
<meta property="og:image" content="https://gitee.com/zhangjialin_zhulan/myimagerepo/raw/master/images/image-20210908154445166.png">
<meta property="og:image" content="https://gitee.com/zhangjialin_zhulan/myimagerepo/raw/master/images/image-20210908154458806.png">
<meta property="og:image" content="https://gitee.com/zhangjialin_zhulan/myimagerepo/raw/master/images/image-20210908154601996.png">
<meta property="og:image" content="https://gitee.com/zhangjialin_zhulan/myimagerepo/raw/master/images/image-20210908154739812.png">
<meta property="og:image" content="https://gitee.com/zhangjialin_zhulan/myimagerepo/raw/master/images/image-20210908154841097.png">
<meta property="og:image" content="https://gitee.com/zhangjialin_zhulan/myimagerepo/raw/master/images/image-20210908155447043.png">
<meta property="og:image" content="https://gitee.com/zhangjialin_zhulan/myimagerepo/raw/master/images/image-20210908155735903.png">
<meta property="og:image" content="https://gitee.com/zhangjialin_zhulan/myimagerepo/raw/master/images/image-20210908155902115.png">
<meta property="og:image" content="https://gitee.com/zhangjialin_zhulan/myimagerepo/raw/master/images/image-20210908160058632.png">
<meta property="og:image" content="https://gitee.com/zhangjialin_zhulan/myimagerepo/raw/master/images/image-20210908162450171.png">
<meta property="og:image" content="https://pic2.zhimg.com/v2-0e8b2f1fa2e286c594e188ca5669c911_r.jpg">
<meta property="og:image" content="https://img2020.cnblogs.com/blog/1674468/202008/1674468-20200828093332075-684684698.jpg">
<meta property="og:image" content="https://img2020.cnblogs.com/blog/1674468/202008/1674468-20200828093346447-104288711.jpg">
<meta property="og:image" content="https://pic3.zhimg.com/80/v2-c1c8cbd7e87f3cc7cb016a713fdb5162_720w.jpg">
<meta property="og:image" content="https://gitee.com/zhangjialin_zhulan/myimagerepo/raw/master/images/image-20210917163400377.png">
<meta property="og:image" content="https://gitee.com/zhangjialin_zhulan/myimagerepo/raw/master/images/image-20210917204156466.png">
<meta property="og:image" content="https://gitee.com/zhangjialin_zhulan/myimagerepo/raw/master/images/image-20210918110515696.png">
<meta property="article:published_time" content="2021-09-08T06:40:03.071Z">
<meta property="article:modified_time" content="2021-09-20T12:24:36.134Z">
<meta property="article:author" content="Mike Taylor">
<meta property="article:tag" content="视频监控">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://gitee.com/zhangjialin_zhulan/myimagerepo/raw/master/images/image-20210908145426391.png">
  
  <title>视频监控解决方案 - Mike Taylor</title>

  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css@4/github-markdown.min.css" />
  <link  rel="stylesheet" href="/lib/hint/hint.min.css" />

  
    
    
      
      <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@10/styles/github-gist.min.css" />
    
  

  
    <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3/dist/jquery.fancybox.min.css" />
  



<!-- 主题依赖的图标库，不要自行修改 -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_kmeydafke9r.css">


<link  rel="stylesheet" href="/css/main.css" />

<!-- 自定义样式保持在最底部 -->


  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    var CONFIG = {"hostname":"github.com","root":"/","version":"1.8.11","typing":{"enable":true,"typeSpeed":100,"cursorChar":"|","loop":false},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"right","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"copy_btn":true,"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":true,"baidu":"e71cddb60357a788e6ed79bca37db76d","google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname"}},"search_path":"/local-search.xml"};
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>

    <!--自定义看板娘-->
    <script src="https://cdn.jsdelivr.net/npm/jquery/dist/jquery.min.js"></script>
    <script src="/live2d-widget/autoload.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome/css/font-awesome.min.css"/>
</head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>Mike Taylor&#39;s</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                首页
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                归档
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                分类
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                标签
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                关于
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/links/">
                <i class="iconfont icon-link-fill"></i>
                友链
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              &nbsp;<i class="iconfont icon-search"></i>&nbsp;
            </a>
          </li>
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="banner" id="banner" parallax=true
         style="background: url('/img/p12.png') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="page-header text-center fade-in-up">
            <span class="h2" id="subtitle" title="视频监控解决方案">
              
            </span>

            
              <div class="mt-3">
  
  
    <span class="post-meta">
      <i class="iconfont icon-date-fill" aria-hidden="true"></i>
      <time datetime="2021-09-08 14:40" pubdate>
        2021年9月8日 下午
      </time>
    </span>
  
</div>

<div class="mt-1">
  
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      5.7k 字
    </span>
  

  
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      28 分钟
    </span>
  

  
  
    
      <!-- 不蒜子统计文章PV -->
      <span id="busuanzi_container_page_pv" style="display: none">
        <i class="iconfont icon-eye" aria-hidden="true"></i>
        <span id="busuanzi_value_page_pv"></span> 次
      </span>
    
  
</div>

            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div class="py-5" id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">视频监控解决方案</h1>
            
            <div class="markdown-body">
              <p>bilibili UP：达尔闻</p>
<h1 id="视频监控"><a href="#视频监控" class="headerlink" title="视频监控"></a>视频监控</h1><h2 id="1-视频监控方案介绍"><a href="#1-视频监控方案介绍" class="headerlink" title="1 视频监控方案介绍"></a>1 视频监控方案介绍</h2><p><img src="https://gitee.com/zhangjialin_zhulan/myimagerepo/raw/master/images/image-20210908145426391.png" srcset="/img/loading.gif" lazyload alt="image-20210908145426391"></p>
<p><img src="https://gitee.com/zhangjialin_zhulan/myimagerepo/raw/master/images/image-20210908145511213.png" srcset="/img/loading.gif" lazyload alt="image-20210908145511213"></p>
<p>mjpg-stream安装在linux系统上</p>
<p><img src="https://gitee.com/zhangjialin_zhulan/myimagerepo/raw/master/images/image-20210908145651429.png" srcset="/img/loading.gif" lazyload alt="image-20210908145651429"></p>
<p><img src="https://gitee.com/zhangjialin_zhulan/myimagerepo/raw/master/images/image-20210908145719395.png" srcset="/img/loading.gif" lazyload alt="image-20210908145719395"></p>
<p><img src="https://gitee.com/zhangjialin_zhulan/myimagerepo/raw/master/images/image-20210908150025249.png" srcset="/img/loading.gif" lazyload alt="image-20210908150025249"></p>
<p><img src="https://gitee.com/zhangjialin_zhulan/myimagerepo/raw/master/images/image-20210908150119639.png" srcset="/img/loading.gif" lazyload alt="image-20210908150119639"></p>
<table>
<thead>
<tr>
<th>协议</th>
<th>HTTP-FLV</th>
<th>RTMP</th>
<th>HLS</th>
<th>DASH</th>
<th>RTSP</th>
</tr>
</thead>
<tbody><tr>
<td>传输方式</td>
<td>HTTP流</td>
<td>TCP流</td>
<td>TCP流</td>
<td>HTTP流</td>
<td>TCP/UDP</td>
</tr>
<tr>
<td>封装格式</td>
<td>FLV</td>
<td>FLV Tag</td>
<td>TS文件</td>
<td>mp4\3gp\webm</td>
<td>mov/asf/wms</td>
</tr>
<tr>
<td>延时</td>
<td>低</td>
<td>低</td>
<td>高</td>
<td>高</td>
<td>低</td>
</tr>
<tr>
<td>数据分段</td>
<td>连续流</td>
<td>连续流</td>
<td>切片文件</td>
<td>切片文件</td>
<td>连续流</td>
</tr>
<tr>
<td>HTML5播放</td>
<td>使用flv.js</td>
<td>不支持</td>
<td>使用hls.js</td>
<td>可播放mp4、webm</td>
<td>支持</td>
</tr>
</tbody></table>
<p><img src="https://gitee.com/zhangjialin_zhulan/myimagerepo/raw/master/images/image-20210908150731252.png" srcset="/img/loading.gif" lazyload alt="image-20210908150731252"></p>
<p><img src="https://gitee.com/zhangjialin_zhulan/myimagerepo/raw/master/images/image-20210908150923388.png" srcset="/img/loading.gif" lazyload alt="image-20210908150923388"></p>
<p><img src="https://gitee.com/zhangjialin_zhulan/myimagerepo/raw/master/images/image-20210908151037923.png" srcset="/img/loading.gif" lazyload alt="image-20210908151037923"></p>
<ul>
<li>推流端：ffmpeg<ul>
<li>rtmp</li>
</ul>
</li>
<li>服务器：nginx<ul>
<li>http</li>
</ul>
</li>
<li>拉流端：浏览器/VLC播放器</li>
</ul>
<p>推流端 + 服务器部署在同一主机 =&gt; 局域网本地视频监控</p>
<h2 id="2-MJEPG-streamer实现"><a href="#2-MJEPG-streamer实现" class="headerlink" title="2 MJEPG-streamer实现"></a>2 MJEPG-streamer实现</h2><p><img src="https://gitee.com/zhangjialin_zhulan/myimagerepo/raw/master/images/image-20210908151651153.png" srcset="/img/loading.gif" lazyload alt="image-20210908151651153"></p>
<p><img src="https://gitee.com/zhangjialin_zhulan/myimagerepo/raw/master/images/image-20210908151748426.png" srcset="/img/loading.gif" lazyload alt="image-20210908151748426"></p>
<p><img src="https://gitee.com/zhangjialin_zhulan/myimagerepo/raw/master/images/image-20210908152032330.png" srcset="/img/loading.gif" lazyload alt="image-20210908152032330"></p>
<p><img src="https://gitee.com/zhangjialin_zhulan/myimagerepo/raw/master/images/image-20210908152417461.png" srcset="/img/loading.gif" lazyload alt="image-20210908152417461"></p>
<p><img src="https://gitee.com/zhangjialin_zhulan/myimagerepo/raw/master/images/image-20210908152515775.png" srcset="/img/loading.gif" lazyload alt="image-20210908152515775"></p>
<p><img src="https://gitee.com/zhangjialin_zhulan/myimagerepo/raw/master/images/image-20210908153419010.png" srcset="/img/loading.gif" lazyload alt="image-20210908153419010"></p>
<h2 id="3-FFmpeg"><a href="#3-FFmpeg" class="headerlink" title="3 FFmpeg"></a>3 FFmpeg</h2><p><img src="https://gitee.com/zhangjialin_zhulan/myimagerepo/raw/master/images/image-20210908153734411.png" srcset="/img/loading.gif" lazyload alt="image-20210908153734411"></p>
<p><img src="https://gitee.com/zhangjialin_zhulan/myimagerepo/raw/master/images/image-20210908153820915.png" srcset="/img/loading.gif" lazyload alt="image-20210908153820915"></p>
<p><img src="https://gitee.com/zhangjialin_zhulan/myimagerepo/raw/master/images/image-20210908154025600.png" srcset="/img/loading.gif" lazyload alt="image-20210908154025600"></p>
<p><img src="https://gitee.com/zhangjialin_zhulan/myimagerepo/raw/master/images/image-20210908154445166.png" srcset="/img/loading.gif" lazyload alt="image-20210908154445166"></p>
<p><img src="https://gitee.com/zhangjialin_zhulan/myimagerepo/raw/master/images/image-20210908154458806.png" srcset="/img/loading.gif" lazyload alt="image-20210908154458806"></p>
<p><img src="https://gitee.com/zhangjialin_zhulan/myimagerepo/raw/master/images/image-20210908154601996.png" srcset="/img/loading.gif" lazyload alt="image-20210908154601996"></p>
<p><img src="https://gitee.com/zhangjialin_zhulan/myimagerepo/raw/master/images/image-20210908154739812.png" srcset="/img/loading.gif" lazyload alt="image-20210908154739812"></p>
<p><img src="https://gitee.com/zhangjialin_zhulan/myimagerepo/raw/master/images/image-20210908154841097.png" srcset="/img/loading.gif" lazyload alt="image-20210908154841097"></p>
<h2 id="4-Nginx"><a href="#4-Nginx" class="headerlink" title="4 Nginx"></a>4 Nginx</h2><p><img src="https://gitee.com/zhangjialin_zhulan/myimagerepo/raw/master/images/image-20210908155447043.png" srcset="/img/loading.gif" lazyload alt="image-20210908155447043"></p>
<p><img src="https://gitee.com/zhangjialin_zhulan/myimagerepo/raw/master/images/image-20210908155735903.png" srcset="/img/loading.gif" lazyload alt="image-20210908155735903"></p>
<p><img src="https://gitee.com/zhangjialin_zhulan/myimagerepo/raw/master/images/image-20210908155902115.png" srcset="/img/loading.gif" lazyload alt="image-20210908155902115"></p>
<p><img src="https://gitee.com/zhangjialin_zhulan/myimagerepo/raw/master/images/image-20210908160058632.png" srcset="/img/loading.gif" lazyload alt="image-20210908160058632"></p>
<p>安装参考bilibili UP主：三湿地</p>
<p><img src="https://gitee.com/zhangjialin_zhulan/myimagerepo/raw/master/images/image-20210908162450171.png" srcset="/img/loading.gif" lazyload alt="image-20210908162450171"></p>
<p><img src="https://pic2.zhimg.com/v2-0e8b2f1fa2e286c594e188ca5669c911_r.jpg" srcset="/img/loading.gif" lazyload alt="preview"></p>
<p><img src="https://img2020.cnblogs.com/blog/1674468/202008/1674468-20200828093332075-684684698.jpg" srcset="/img/loading.gif" lazyload alt="img"></p>
<p><img src="https://img2020.cnblogs.com/blog/1674468/202008/1674468-20200828093346447-104288711.jpg" srcset="/img/loading.gif" lazyload alt="img"></p>
<p><img src="https://pic3.zhimg.com/80/v2-c1c8cbd7e87f3cc7cb016a713fdb5162_720w.jpg" srcset="/img/loading.gif" lazyload alt="img"></p>
<h1 id="视频基础"><a href="#视频基础" class="headerlink" title="视频基础"></a>视频基础</h1><ul>
<li><p>YUV格式分为两大类<code>planar</code>和<code>packed</code></p>
<ul>
<li>对于<code>planar</code>的YUV格式，先连续存储所有像素点的Y，紧接着存储所有像素点的U，随后是所有像素点的V</li>
<li>对于<code>packed</code>的YUV格式，每个像素点的YUV是连续交替存储的</li>
<li>Libyuvku：Google开源的实现各种YUV与RGB之间相互转化、旋转、缩放的库</li>
<li>YUV存在多种格式，比如YUV420p，YUV420sp等，不同的YUV数据格式在存储时的排序是不一样的，在开发过程中必须非常注意，否则画面会显示不正常，比如花屏、绿屏等<ul>
<li>YUV 4：4：4采样，每个Y对应一组UV分量</li>
<li>YUV 4：2：2采样，每两个Y对应一组UV分量</li>
<li>YUV4：2：0采样，每4个Y共用一组UV分量</li>
</ul>
</li>
</ul>
</li>
<li><p>数字图像格式转换，以H264直播为例：</p>
<p><img src="https://gitee.com/zhangjialin_zhulan/myimagerepo/raw/master/images/image-20210917163400377.png" srcset="/img/loading.gif" lazyload alt="image-20210917163400377"></p>
</li>
<li><p>视频基础</p>
<ul>
<li>视频码率：kb/s，是指视频文件在单位时间内使用的数据流量，也叫码流率，码率越大，说明单位时间内取样率越大，数据流精度越高</li>
<li>视频帧率：fps，通常说一个视频的25帧，指的是这个视频帧率，即1秒会显示25帧。帧率越高，给人的视觉就越流畅</li>
<li>视频分辨率：分辨率就是我们常说的640*480分辨率、1920*1080分辨率，分辨率影响视频图像的大小</li>
</ul>
</li>
<li><p>I P B帧的概念</p>
<ul>
<li>I帧（Intra caoded frames）：I帧不需要参考其他画面而生成，解码时仅靠自己就重构完整图像<ul>
<li>I帧图像采用帧内编码方式</li>
<li>I帧所占数据的信息量比较大</li>
<li>I帧图像是周期性出现在图像序列中的，出现频率可由编码器选择</li>
<li>I帧是P帧和B帧的参考帧（其质量直接影响到同组中以后各帧的质量）</li>
<li>I帧是帧组GOP的基础帧（第一帧），在一组中只有一个I帧</li>
<li>I帧不需要考虑运动矢量  </li>
</ul>
</li>
<li>P帧：根据本帧与相邻的前一帧（I帧或P帧）的不同点来压缩本帧数据，同时利用了空间和时间上的相关性。<ul>
<li>P帧属于前向预测的帧间编码，它需要参考前面最靠近它的I帧或P帧来解码（多个参考的时候，遇到过11个参考帧）</li>
</ul>
</li>
<li>B帧：B帧图像采用双向时间预测，可以大大提高压缩倍数</li>
</ul>
</li>
<li><p>常见视频压缩算法</p>
<ul>
<li>MPEG阵营<ul>
<li>MPEG2</li>
<li>H264</li>
<li><strong>H265</strong></li>
</ul>
</li>
<li>中国阵营<ul>
<li>AVS</li>
</ul>
</li>
<li>Google阵营<ul>
<li>VP8</li>
<li><strong>VP9</strong></li>
</ul>
</li>
</ul>
</li>
</ul>
<h1 id="音频"><a href="#音频" class="headerlink" title="音频"></a>音频</h1><p>采样定理：2倍，所以CD音质&gt;40khz(ADC器件)</p>
<p>没有经过压缩的音频数据我们叫PCM数据</p>
<ul>
<li><p>采样频率：每秒钟采样的点的个数</p>
</li>
<li><p>采样的精度（采样深度）：每个“样本点”的常用大小为8bit，16bit，24bit</p>
</li>
<li><p>通道数：单声道、双声道、四声道、5.1声道</p>
<ul>
<li>7.1声道  —— 8个声道</li>
<li>5.1声道 —— 6个声道</li>
<li>2.1声道 —— 3个声道</li>
</ul>
</li>
<li><p>比特率：每秒传输的bit数，单位为（bps）</p>
<p>间接衡量声音质量的一个标准</p>
<p>没有压缩的音频数据的比特率 = 采样频率*采样精度*通道数</p>
</li>
<li><p>码率：压缩后的音频数据的比特率</p>
<ul>
<li>常见的码率：<ul>
<li>96kbps：FM质量</li>
<li>128 - 160kbps：一般质量音频</li>
<li>192kbps：CD质量</li>
<li>256 - 320Kbps：高质量音频</li>
</ul>
</li>
<li>码率越大，压缩效率越低，音质越好，压缩后数据越大。 </li>
<li>码率 = 音频文件大小 / 时长</li>
</ul>
</li>
<li><p>音频的帧的概念没有视频帧那么清晰，几乎所有的视频编码格式都可以简单的认为一帧就是编码后的一张图像</p>
<ul>
<li>帧长：可以指每帧采样数播放的时间，mp3 48k，1152个采样点，每帧则为24ms；aac（16khz - &gt; 2048 / 48khz - &gt; 1024）则是每帧是1024个采样点。攒够一帧数据才送去做编码</li>
<li>也可以指压缩后每帧数据长度，所以讲到帧的时候要注意他适用的场合</li>
<li>每帧持续时间（秒） = 每帧采样点数 / 采样频率（HZ）</li>
</ul>
</li>
<li><p>存储方式</p>
<ul>
<li>交错模式：数字音频信号存储的方式。数据以连续帧的方式存放，即首先记录帧1的左声道样本和右声道样本，再开始帧2的记录（LRLRLRLRLR…… / LRCLRCLRCLRC……）</li>
<li>非交错模式：首先记录的是一个周期内所有帧的左声道样本，再记录所有右声道样本（LLLLLL……RRRRRR……）</li>
</ul>
</li>
<li><p>常用音频格式：</p>
<ul>
<li>MP3</li>
<li>AAC</li>
<li>OPUS webrtc</li>
<li>AC3和EAC3杜比公司的方案</li>
</ul>
</li>
</ul>
<h1 id="封装格式基础"><a href="#封装格式基础" class="headerlink" title="封装格式基础"></a>封装格式基础</h1><p>封装格式（也叫容器）就是将已经编码压缩好的视频流、音频流及字幕按照一定的方案放到一个文件中，便于播放软件播放。</p>
<p>一般来说，视频文件的后缀名就是它的封装格式。</p>
<p>封装格式不同，后缀名也就不一样。</p>
<ul>
<li><p>FLV（适合直播）和MP4（适合本地播放、多路音轨切换）的区别：</p>
<p><img src="https://gitee.com/zhangjialin_zhulan/myimagerepo/raw/master/images/image-20210917204156466.png" srcset="/img/loading.gif" lazyload alt="image-20210917204156466"></p>
</li>
</ul>
<h1 id="音频同步基础"><a href="#音频同步基础" class="headerlink" title="音频同步基础"></a>音频同步基础</h1><p>DTS(Decoding Time Stamp)：即解码时间戳，这个时间戳的意义在于告诉播放器应该在什么时候解码这一帧的数据</p>
<p>PTS(Presentation Time Stamp)：即显示时间戳，这个时间戳用来告诉播放器该在什么时候显示这一帧的数据 </p>
<ul>
<li>音视频同步方式：<ul>
<li>同步视频到音频 A （人对声音更加敏感）</li>
<li>同步音频到视频 B </li>
<li>同步音频和视频到外部时钟 C </li>
<li>A &gt; B &gt; C</li>
</ul>
</li>
</ul>
<h1 id="开源项目"><a href="#开源项目" class="headerlink" title="开源项目"></a>开源项目</h1><p>ffmpeg</p>
<p>ijkplay （手机端）</p>
<p>QMPlayer ( PC端 )</p>
<p>ZLMediaKit(跨平台)</p>
<p>EasyDarwin</p>
<p>SRS（协程写的）</p>
<p>nginx - rtmp - module</p>
<h1 id="常用工具"><a href="#常用工具" class="headerlink" title="常用工具"></a>常用工具</h1><p>MediaInfo ：视频信息查看工具</p>
<p>VLC ：视频流播放工具</p>
<p>wireshark ： 网络抓包工具</p>
<p>cooledit pro2 ： 音频编辑工具，PCM播放工具</p>
<p>Elecard StreamEye Tools：分析视频帧的工具（需要破解）</p>
<p>音视频算法工程师</p>
<p>流媒体开发服务器工程师</p>
<p>开源TeamTalk</p>
<h1 id="FFMPEG学习"><a href="#FFMPEG学习" class="headerlink" title="FFMPEG学习"></a>FFMPEG学习</h1><h2 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h2><h3 id="容器"><a href="#容器" class="headerlink" title="容器"></a>容器</h3><p>视频文件本身其实是一个容器（container），里面包括了视频和音频，也可能有字幕等其他内容。</p>
<ul>
<li>常见的容器格式有以下几种，一般来说，视频文件的后缀名反映了它的容器格式：<ul>
<li>MP4</li>
<li>MKV</li>
<li>WebM</li>
<li>AVI</li>
</ul>
</li>
</ul>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-regexp">//</span> 查看FFmpeg支持的容器<br>ffmpeg -formats<br></code></pre></td></tr></table></figure>

<h3 id="编码格式"><a href="#编码格式" class="headerlink" title="编码格式"></a>编码格式</h3><p>视频和音频都需要经过编码，才能保存成文件。不同的编码格式（CODEC），有不同的压缩率，会导致文件大小和清晰度的差异。</p>
<ul>
<li><p>常用的视频编码格式如下：</p>
<ul>
<li> H.262</li>
<li>H.264</li>
<li>H.265</li>
</ul>
</li>
<li><p>上面的编码格式都是有版权的，但是可以免费使用。此外，还有几种无版权的视频编码格式：</p>
<ul>
<li>VP8</li>
<li>VP9</li>
<li>AV1</li>
</ul>
</li>
<li><p>常用的音频编码格式</p>
<ul>
<li>MP3</li>
<li>ACC</li>
</ul>
</li>
</ul>
<p>上面所有这些都是有损的编码格式，编码后会损失一些细节，以换取压缩后较小的文件体积，无损的编码格式压缩出来的文件体积较大，这里就不介绍了。</p>
<p>下面的命令可以查看 FFmpeg 支持的编码格式，视频编码和音频编码都在内：</p>
<figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">ffmpeg -codecs</span><br></code></pre></td></tr></table></figure>

<h3 id="编码器"><a href="#编码器" class="headerlink" title="编码器"></a>编码器</h3><p>编码器（encoders）是实现某种编码格式的库文件。只有安装了某种格式的编码器，才能实现该格式视频/音频的编码和解码。</p>
<ul>
<li>以下是一些 FFmpeg 内置的视频编码器：<ul>
<li>libx264：最流行的开源 H.264 编码器</li>
<li>NVENC：基于 NVIDIA GPU 的 H.264 编码器</li>
<li>libx265：开源的 HEVC 编码器</li>
<li>libvpx：谷歌的 VP8 和 VP9 编码器</li>
<li>libaom：AV1 编码器</li>
</ul>
</li>
<li>音频编码器：<ul>
<li>libfdk-aac</li>
<li>aac</li>
</ul>
</li>
</ul>
<p>下面的命令可以查看 FFmpeg 已安装的编码器：</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-regexp">//</span> 下面的命令可以查看 FFmpeg 已安装的编码器<br>ffmpeg -encoders<br></code></pre></td></tr></table></figure>

<h2 id="FFMPEG的使用格式"><a href="#FFMPEG的使用格式" class="headerlink" title="FFMPEG的使用格式"></a>FFMPEG的使用格式</h2><figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs dust"><span class="xml">// Fmpeg 的命令行参数非常多，可以分成五个部分</span><br><span class="xml">ffmpeg </span><span class="hljs-template-variable">&#123;1&#125;</span><span class="xml"> </span><span class="hljs-template-variable">&#123;2&#125;</span><span class="xml"> -i </span><span class="hljs-template-variable">&#123;3&#125;</span><span class="xml"> </span><span class="hljs-template-variable">&#123;4&#125;</span><span class="xml"> </span><span class="hljs-template-variable">&#123;5&#125;</span><br></code></pre></td></tr></table></figure>

<ul>
<li>上面命令中，五个部分的参数依次如下：<ol>
<li>全局参数</li>
<li>输入文件参数</li>
<li>输入文件</li>
<li>输出文件参数</li>
<li>输出文件</li>
</ol>
</li>
</ul>
<p>参数太多的时候，为了便于查看，ffmpeg 命令可以写成多行</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs css">ffmpeg \<br><span class="hljs-selector-attr">[全局参数]</span> \<br><span class="hljs-selector-attr">[输入文件参数]</span> \<br>-<span class="hljs-selector-tag">i</span> <span class="hljs-selector-attr">[输入文件]</span> \<br><span class="hljs-selector-attr">[输出文件参数]</span> \<br><span class="hljs-selector-attr">[输出文件]</span><br></code></pre></td></tr></table></figure>

<p>一个例子：</p>
<figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs livescript">ffmpeg <span class="hljs-string">\</span><br>-y <span class="hljs-string">\</span> <span class="hljs-comment"># 全局参数</span><br>-c:a libfdk_aac -c:v libx264 <span class="hljs-string">\</span> <span class="hljs-comment"># 输入文件参数</span><br>-i input.mp4 <span class="hljs-string">\</span> <span class="hljs-comment"># 输入文件</span><br>-c:v libvpx-vp9 -c:a libvorbis <span class="hljs-string">\</span> <span class="hljs-comment"># 输出文件参数</span><br>output.webm <span class="hljs-comment"># 输出文件</span><br></code></pre></td></tr></table></figure>

<p>​    上面的命令将 mp4 文件转成 webm 文件，这两个都是容器格式。输入的 mp4 文件的音频编码格式是 aac，视频编码格式是 H.264；输出的 webm 文件的视频编码格式是 VP9，音频格式是 Vorbis。</p>
<p>​    如果不指明编码格式，FFmpeg 会自己判断输入文件的编码。因此，上面的命令可以简单写成下面的样子：</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus">ffmpeg -<span class="hljs-selector-tag">i</span> <span class="hljs-selector-tag">input</span><span class="hljs-selector-class">.avi</span> output.mp4<br></code></pre></td></tr></table></figure>

<h2 id="常用命令行参数"><a href="#常用命令行参数" class="headerlink" title="常用命令行参数"></a>常用命令行参数</h2><p>FFmpeg 常用的命令行参数如下：</p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs diff"><span class="hljs-deletion">-c：指定编码器</span><br><span class="hljs-deletion">-c copy：直接复制，不经过重新编码（这样比较快）</span><br><span class="hljs-deletion">-c:v：指定视频编码器</span><br><span class="hljs-deletion">-c:a：指定音频编码器</span><br><span class="hljs-deletion">-i：指定输入文件</span><br><span class="hljs-deletion">-an：去除音频流</span><br><span class="hljs-deletion">-vn： 去除视频流</span><br><span class="hljs-deletion">-preset：指定输出的视频质量，会影响文件的生成速度，有以下几个可用的值 ultrafast, superfast, veryfast, faster, fast, medium, slow, slower, veryslow。</span><br><span class="hljs-deletion">-y：不经过确认，输出时直接覆盖同名文件。</span><br></code></pre></td></tr></table></figure>

<h2 id="常见用法"><a href="#常见用法" class="headerlink" title="常见用法"></a>常见用法</h2><p>下面介绍FFmpeg的几种常见用法</p>
<h3 id="查看文件信息"><a href="#查看文件信息" class="headerlink" title="查看文件信息"></a>查看文件信息</h3><p>查看视频文件的元信息，比如编码格式和比特率，可以只使用<code>-i</code>参数：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css">ffmpeg -<span class="hljs-selector-tag">i</span> <span class="hljs-selector-tag">input</span><span class="hljs-selector-class">.mp4</span><br></code></pre></td></tr></table></figure>

<p>上面命令会输出很多冗余信息，加上<code>-hide_banner</code>参数，可以只显示元信息。</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus">ffmpeg -<span class="hljs-selector-tag">i</span> <span class="hljs-selector-tag">input</span><span class="hljs-selector-class">.mp4</span> -hide_banner<br></code></pre></td></tr></table></figure>

<h3 id="转换编码格式"><a href="#转换编码格式" class="headerlink" title="转换编码格式"></a>转换编码格式</h3><p>转换编码格式（transcoding）指的是， 将视频文件从一种编码转成另一种编码。比如转成 H.264 编码，一般使用编码器<code>libx264</code>，所以只需指定输出文件的视频编码器即可。</p>
<figure class="highlight sas"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sas">ffmpeg -i [<span class="hljs-meta">input</span>.<span class="hljs-meta">file</span>] -c:v libx264 <span class="hljs-meta">output</span>.mp4<br></code></pre></td></tr></table></figure>

<p>下面是转成 H.265 编码的写法：</p>
<figure class="highlight sas"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sas">ffmpeg -i [<span class="hljs-meta">input</span>.<span class="hljs-meta">file</span>] -c:v libx265 <span class="hljs-meta">output</span>.mp4<br></code></pre></td></tr></table></figure>

<h3 id="转换容器格式"><a href="#转换容器格式" class="headerlink" title="转换容器格式"></a>转换容器格式</h3><p>转换容器格式（transmuxing）指的是，将视频文件从一种容器转到另一种容器。下面是 mp4 转 webm 的写法：</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus">ffmpeg -<span class="hljs-selector-tag">i</span> <span class="hljs-selector-tag">input</span><span class="hljs-selector-class">.mp4</span> -c copy output.webm<br></code></pre></td></tr></table></figure>

<p>上面例子中，只是转一下容器，内部的编码格式不变，所以使用<code>-c copy</code>指定直接拷贝，不经过转码，这样比较快。</p>
<h3 id="调整码率"><a href="#调整码率" class="headerlink" title="调整码率"></a>调整码率</h3><p>调整码率（transrating）指的是，改变编码的比特率，一般用来将视频文件的体积变小。下面的例子指定码率最小为964K，最大为3856K，缓冲区大小为 2000K。</p>
<figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs livescript">ffmpeg <span class="hljs-string">\</span><br>-i input.mp4 <span class="hljs-string">\</span><br>-minrate <span class="hljs-number">964</span>K -maxrate <span class="hljs-number">3856</span>K -bufsize <span class="hljs-number">2000</span>K <span class="hljs-string">\</span><br>output.mp4<br></code></pre></td></tr></table></figure>

<h3 id="改变分辨率（transsizing）"><a href="#改变分辨率（transsizing）" class="headerlink" title="改变分辨率（transsizing）"></a>改变分辨率（transsizing）</h3><p>下面是改变视频分辨率（transsizing）的例子，从 1080p 转为 480p：</p>
<figure class="highlight haml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs haml">ffmpeg \<br>-<span class="ruby">i input.mp4 \</span><br><span class="ruby">-vf scale=<span class="hljs-number">480</span><span class="hljs-symbol">:-</span><span class="hljs-number">1</span> \</span><br><span class="ruby">output.mp4</span><br></code></pre></td></tr></table></figure>

<h3 id="提取音频"><a href="#提取音频" class="headerlink" title="提取音频"></a>提取音频</h3><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs stylus">ffmpeg \<br>-<span class="hljs-selector-tag">i</span> <span class="hljs-selector-tag">input</span><span class="hljs-selector-class">.mp4</span> \<br>-vn -c:<span class="hljs-selector-tag">a</span> copy \<br>output.aac<br></code></pre></td></tr></table></figure>

<p>上面例子中，<code>-vn</code>表示去掉视频，<code>-c:a copy</code>表示不改变音频编码，直接拷贝。</p>
<h3 id="添加音轨"><a href="#添加音轨" class="headerlink" title="添加音轨"></a>添加音轨</h3><p>添加音轨（muxing）指的是，将外部音频加入视频，比如添加背景音乐或旁白。</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs stylus">ffmpeg \<br>-<span class="hljs-selector-tag">i</span> <span class="hljs-selector-tag">input</span><span class="hljs-selector-class">.aac</span> -<span class="hljs-selector-tag">i</span> <span class="hljs-selector-tag">input</span><span class="hljs-selector-class">.mp4</span> \<br>output.mp4<br></code></pre></td></tr></table></figure>

<p>上面例子中，有音频和视频两个输入文件，FFmpeg 会将它们合成为一个文件。</p>
<h3 id="截图"><a href="#截图" class="headerlink" title="截图"></a>截图</h3><p>下面的例子是从指定时间开始，连续对1秒钟的视频进行截图：</p>
<figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs livescript">ffmpeg <span class="hljs-string">\</span><br>-y <span class="hljs-string">\</span><br>-i input.mp4 <span class="hljs-string">\</span><br>-ss <span class="hljs-number">00</span>:<span class="hljs-number">01</span>:<span class="hljs-number">24</span> -t <span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">01</span> <span class="hljs-string">\</span><br>output_%<span class="hljs-number">3d</span>.jpg<br></code></pre></td></tr></table></figure>

<p>如果只需要截一张图，可以指定只截取一帧：</p>
<figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs livescript">ffmpeg <span class="hljs-string">\</span><br>-ss <span class="hljs-number">01</span>:<span class="hljs-number">23</span>:<span class="hljs-number">45</span> <span class="hljs-string">\</span><br>-i input <span class="hljs-string">\</span><br>-vframes <span class="hljs-number">1</span> -q:v <span class="hljs-number">2</span> <span class="hljs-string">\</span><br>output.jpg<br></code></pre></td></tr></table></figure>

<p>上面例子中，<code>-vframes 1</code>指定只截取一帧，<code>-q:v 2</code>表示输出的图片质量，一般是1到5之间（1 为质量最高）。</p>
<h3 id="裁剪"><a href="#裁剪" class="headerlink" title="裁剪"></a>裁剪</h3><p>裁剪（cutting）指的是，截取原始视频里面的一个片段，输出为一个新视频。可以指定开始时间（start）和持续时间（duration），也可以指定结束时间（end）。</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs css">ffmpeg -ss <span class="hljs-selector-attr">[start]</span> -<span class="hljs-selector-tag">i</span> <span class="hljs-selector-attr">[input]</span> -t <span class="hljs-selector-attr">[duration]</span> -c copy <span class="hljs-selector-attr">[output]</span><br>ffmpeg -ss <span class="hljs-selector-attr">[start]</span> -<span class="hljs-selector-tag">i</span> <span class="hljs-selector-attr">[input]</span> -<span class="hljs-selector-tag">to</span> <span class="hljs-selector-attr">[end]</span> -c copy <span class="hljs-selector-attr">[output]</span><br></code></pre></td></tr></table></figure>

<p>实际例子：</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">ffmpeg</span> -ss <span class="hljs-number">00</span>:<span class="hljs-number">01</span>:<span class="hljs-number">50</span> -i<span class="hljs-meta"> [input] -t 10.5 -c copy [output]</span><br><span class="hljs-attribute">ffmpeg</span> -ss <span class="hljs-number">2</span>.<span class="hljs-number">5</span> -i<span class="hljs-meta"> [input] -to 10 -c copy [output]</span><br></code></pre></td></tr></table></figure>

<p>上面例子中，<code>-c copy</code>表示不改变音频和视频的编码格式，直接拷贝，这样会快很多。</p>
<h3 id="为音频添加封面"><a href="#为音频添加封面" class="headerlink" title="为音频添加封面"></a>为音频添加封面</h3><p>有些视频网站只允许上传视频文件。如果要上传音频文件，必须为音频添加封面，将其转为视频，然后上传。</p>
<p>下面命令可以将音频文件，转为带封面的视频文件。</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs stylus">ffmpeg \<br>-loop <span class="hljs-number">1</span> \<br>-<span class="hljs-selector-tag">i</span> cover<span class="hljs-selector-class">.jpg</span> -<span class="hljs-selector-tag">i</span> <span class="hljs-selector-tag">input</span><span class="hljs-selector-class">.mp3</span> \<br>-c:v libx264 -c:<span class="hljs-selector-tag">a</span> aac -<span class="hljs-selector-tag">b</span>:<span class="hljs-selector-tag">a</span> <span class="hljs-number">192</span>k -shortest \<br>output.mp4<br></code></pre></td></tr></table></figure>

<p>面命令中，有两个输入文件，一个是封面图片<code>cover.jpg</code>，另一个是音频文件<code>input.mp3</code>。<code>-loop 1</code>参数表示图片无限循环，<code>-shortest</code>参数表示音频文件结束，输出视频就结束。</p>
<p><img src="https://gitee.com/zhangjialin_zhulan/myimagerepo/raw/master/images/image-20210918110515696.png" srcset="/img/loading.gif" lazyload alt="image-20210918110515696"></p>

            </div>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                
                  <div class="post-meta">
                    <i class="iconfont icon-tags"></i>
                    
                      <a class="hover-with-bg" href="/tags/%E8%A7%86%E9%A2%91%E7%9B%91%E6%8E%A7/">视频监控</a>
                    
                  </div>
                
              </div>
              
                <p class="note note-warning">
                  
                    灯火阑珊
                  
                </p>
              
              
                <div class="post-prevnext">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2021/09/30/JavaScript%E5%9F%BA%E7%A1%80+%E9%AB%98%E7%BA%A7/">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">JavaScript基础 + 高级</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2021/08/01/Vue%E5%85%A8%E5%AE%B6%E6%A1%B6/">
                        <span class="hidden-mobile">Vue全家桶</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
              <!-- Comments -->
              <article class="comments" id="comments" lazyload>
                
                  
                
                
  <script type="text/javascript">
    Fluid.utils.loadComments('#comments', function() {
      var light = 'github-light';
      var dark = 'github-dark-orange';
      var schema = document.documentElement.getAttribute('data-user-color-scheme');
      if (schema === 'dark') {
        schema = dark;
      } else {
        schema = light;
      }
      window.UtterancesThemeLight = light;
      window.UtterancesThemeDark = dark;
      var s = document.createElement('script');
      s.setAttribute('src', 'https://utteranc.es/client.js');
      s.setAttribute('repo', 'zhangjialin996/comments');
      s.setAttribute('issue-term', 'pathname');
      
      s.setAttribute('label', 'utterances');
      
      s.setAttribute('theme', schema);
      s.setAttribute('crossorigin', 'anonymous');
      document.getElementById('comments').appendChild(s);
    })
  </script>
  <noscript>Please enable JavaScript to view the comments</noscript>


              </article>
            
          </article>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p>
  <div class="toc-body" id="toc-body"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->

  <div class="col-lg-7 mx-auto nopadding-x-md">
    <div class="container custom post-custom mx-auto">
      <img src="https://octodex.github.com/images/jetpacktocat.png" srcset="/img/loading.gif" lazyload class="rounded mx-auto d-block mt-5" style="width:150px; height:150px;">
    </div>
  </div>


    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
    

    
  </main>

  <footer class="text-center mt-5 py-3">
  <div class="footer-content">
     <i class="iconfont icon-love" style="color: #8080ff"></i> <i class="iconfont icon-love" style="color: red"></i> <i class="iconfont icon-love" style="color: #8080ff"></i> 
  </div>
  
  <div class="statistics">
    
    

    
      
        <!-- 不蒜子统计PV -->
        <span id="busuanzi_container_site_pv" style="display: none">
            总访问量 
            <span id="busuanzi_value_site_pv"></span>
             次
          </span>
      
      
        <!-- 不蒜子统计UV -->
        <span id="busuanzi_container_site_uv" style="display: none">
            总访客数 
            <span id="busuanzi_value_site_uv"></span>
             人
          </span>
      
    
  </div>


  
  <!-- 备案信息 -->
  <div class="beian">
    <span>
      <a href="http://beian.miit.gov.cn/" target="_blank" rel="nofollow noopener">
        
      </a>
    </span>
    
  </div>


  
</footer>


  <!-- SCRIPTS -->
  
  <script  src="https://cdn.jsdelivr.net/npm/nprogress@0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress@0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js" ></script>
<script  src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>

<!-- Plugins -->


  
    <script  src="/js/img-lazyload.js" ></script>
  



  



  <script  src="https://cdn.jsdelivr.net/npm/tocbot@4/dist/tocbot.min.js" ></script>



  <script  src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3/dist/jquery.fancybox.min.js" ></script>



  <script  src="https://cdn.jsdelivr.net/npm/anchor-js@4/anchor.min.js" ></script>



  <script defer src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js" ></script>



  <script  src="/js/local-search.js" ></script>



  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>




  <script  src="https://cdn.jsdelivr.net/npm/typed.js@2/lib/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var title = document.getElementById('subtitle').title;
      
      typing(title)
      
    })(window, document);
  </script>












  
    <!-- Baidu Analytics -->
    <script defer>
      var _hmt = _hmt || [];
      (function () {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?e71cddb60357a788e6ed79bca37db76d";
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hm, s);
      })();
    </script>
  

  

  

  

  

  





<!-- 主题的启动项 保持在最底部 -->
<script  src="/js/boot.js" ></script>


</body>
</html>
